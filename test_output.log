============================= test session starts ==============================
platform darwin -- Python 3.13.9, pytest-9.0.2, pluggy-1.6.0 -- /Users/aristath/arduino-trader/venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/aristath/arduino-trader
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 2778 items

tests/integration/planning/test_modular_components.py::TestOpportunityCalculatorRegistry::test_all_calculators_registered PASSED [  0%]
tests/integration/planning/test_modular_components.py::TestOpportunityCalculatorRegistry::test_opportunity_buys_calculator ERROR [  0%]
tests/integration/planning/test_modular_components.py::TestOpportunityCalculatorRegistry::test_profit_taking_calculator ERROR [  0%]
tests/integration/planning/test_modular_components.py::TestPatternGeneratorRegistry::test_all_patterns_registered PASSED [  0%]
tests/integration/planning/test_modular_components.py::TestPatternGeneratorRegistry::test_direct_buy_pattern FAILED [  0%]
tests/integration/planning/test_modular_components.py::TestPatternGeneratorRegistry::test_single_best_pattern FAILED [  0%]
tests/integration/planning/test_modular_components.py::TestSequenceGeneratorRegistry::test_all_generators_registered PASSED [  0%]
tests/integration/planning/test_modular_components.py::TestSequenceGeneratorRegistry::test_partial_execution_generator FAILED [  0%]
tests/integration/planning/test_modular_components.py::TestSequenceFilterRegistry::test_all_filters_registered PASSED [  0%]
tests/integration/planning/test_modular_components.py::TestSequenceFilterRegistry::test_diversity_filter PASSED [  0%]
tests/integration/planning/test_modular_components.py::test_end_to_end_module_pipeline FAILED [  0%]
tests/integration/planning/test_modular_planner_parity.py::test_modular_planner_basic_execution ERROR [  0%]
tests/integration/planning/test_modular_planner_parity.py::test_modular_adapter_execution ERROR [  0%]
tests/integration/planning/test_modular_planner_parity.py::test_modular_vs_monolithic_identical_output SKIPPED [  0%]
tests/integration/planning/test_modular_planner_parity.py::test_modular_planner_empty_portfolio ERROR [  0%]
tests/integration/planning/test_modular_planner_parity.py::test_modular_planner_no_cash ERROR [  0%]
tests/integration/planning/test_planner_config_api.py::test_create_planner_config FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_create_planner_invalid_toml FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_list_planners FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_get_planner_by_id FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_get_nonexistent_planner FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_update_planner FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_update_planner_name_only FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_update_planner_invalid_toml FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_delete_planner FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_validate_toml_valid FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_validate_toml_invalid FAILED [  0%]
tests/integration/planning/test_planner_config_api.py::test_get_planner_history FAILED [  1%]
tests/integration/planning/test_planner_config_api.py::test_apply_planner_without_bucket FAILED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_register_and_get PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_get_nonexistent_returns_none PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_prevents_duplicate_registration PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_list_names PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_get_all PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_get_all_returns_copy PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestRegistry::test_registry_repr PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestGlobalRegistries::test_opportunity_calculator_registry_populated PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestGlobalRegistries::test_pattern_generator_registry_populated PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestGlobalRegistries::test_sequence_generator_registry_populated PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestGlobalRegistries::test_filter_registry_populated PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModularPlannerFactory::test_factory_loads_default_config PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModularPlannerFactory::test_factory_loads_conservative_config PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModularPlannerFactory::test_factory_loads_aggressive_config PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModularPlannerFactory::test_factory_fails_fast_on_missing_module PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModularPlannerFactory::test_factory_from_config_file_helper PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModularPlannerFactory::test_factory_get_methods PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModuleIntegration::test_loaded_calculator_has_correct_interface PASSED [  1%]
tests/integration/planning/test_registry_and_factory.py::TestModuleIntegration::test_module_repr_methods PASSED [  1%]
tests/integration/satellites/test_trade_integration.py::test_buy_trade_updates_bucket_balance PASSED [  1%]
tests/integration/satellites/test_trade_integration.py::test_sell_trade_increases_bucket_balance PASSED [  1%]
tests/integration/satellites/test_trade_integration.py::test_research_mode_trade_doesnt_affect_balance PASSED [  1%]
tests/integration/satellites/test_trade_integration.py::test_satellite_trade_updates_satellite_bucket PASSED [  1%]
tests/integration/satellites/test_trade_integration.py::test_trade_bucket_id_stored_correctly PASSED [  1%]
tests/integration/test_concurrent_jobs.py::test_file_lock_prevents_concurrent_execution PASSED [  1%]
tests/integration/test_concurrent_jobs.py::test_file_lock_timeout PASSED [  1%]
tests/integration/test_concurrent_jobs.py::test_concurrent_position_updates_with_lock PASSED [  2%]
tests/integration/test_concurrent_jobs.py::test_concurrent_trade_execution_atomicity PASSED [  2%]
tests/integration/test_error_recovery.py::test_trade_execution_rollback_on_database_error PASSED [  2%]
tests/integration/test_error_recovery.py::test_trade_execution_handles_external_failure PASSED [  2%]
tests/integration/test_error_recovery.py::test_position_sync_recovery_after_partial_failure PASSED [  2%]
tests/integration/test_error_recovery.py::test_price_fetch_retry_logic PASSED [  2%]
tests/integration/test_error_recovery.py::test_price_fetch_fails_after_max_retries PASSED [  2%]
tests/integration/test_error_recovery.py::test_allocation_target_upsert PASSED [  2%]
tests/integration/test_external_api_failures.py::test_yahoo_finance_api_failure_handling PASSED [  2%]
tests/integration/test_external_api_failures.py::test_yahoo_finance_timeout_handling PASSED [  2%]
tests/integration/test_external_api_failures.py::test_tradernet_api_connection_failure PASSED [  2%]
tests/integration/test_external_api_failures.py::test_tradernet_api_request_failure PASSED [  2%]
tests/integration/test_external_api_failures.py::test_rebalancing_service_handles_price_fetch_failure PASSED [  2%]
tests/integration/test_external_api_failures.py::test_exchange_rate_cache_fallback PASSED [  2%]
tests/integration/test_external_api_failures.py::test_exchange_rate_cache_thread_safety PASSED [  2%]
tests/integration/test_external_api_failures.py::test_portfolio_sync_handles_api_failure PASSED [  2%]
tests/integration/test_planner_performance.py::test_planner_completes_in_reasonable_time PASSED [  2%]
tests/integration/test_planner_performance.py::test_planner_handles_empty_portfolio PASSED [  2%]
tests/integration/test_regime_cash_reserve.py::test_bull_market_uses_bull_cash_reserve PASSED [  2%]
tests/integration/test_regime_cash_reserve.py::test_bear_market_uses_bear_cash_reserve PASSED [  2%]
tests/integration/test_regime_cash_reserve.py::test_sideways_market_uses_sideways_cash_reserve PASSED [  2%]
tests/integration/test_regime_cash_reserve.py::test_disabled_regime_detection_uses_default_cash_reserve PASSED [  2%]
tests/integration/test_repositories.py::test_stock_repository_create_and_get PASSED [  2%]
tests/integration/test_repositories.py::test_stock_repository_get_all_active PASSED [  2%]
tests/integration/test_repositories.py::test_position_repository_upsert PASSED [  2%]
tests/integration/test_repositories.py::test_portfolio_repository_create_and_get PASSED [  2%]
tests/integration/test_repositories.py::test_allocation_repository_upsert_and_get PASSED [  2%]
tests/integration/test_repositories.py::test_score_repository_upsert PASSED [  2%]
tests/integration/test_repositories.py::test_trade_repository_create PASSED [  3%]
tests/integration/test_schema_migration.py::test_schema_migration_v5_to_v6_adds_portfolio_target_columns PASSED [  3%]
tests/integration/test_schema_migration.py::test_new_installation_includes_portfolio_target_columns PASSED [  3%]
tests/integration/test_schema_migration.py::test_portfolio_target_columns_are_nullable PASSED [  3%]
tests/integration/test_transactions.py::test_trade_creation_and_retrieval PASSED [  3%]
tests/integration/test_transactions.py::test_transaction_commit_on_success PASSED [  3%]
tests/integration/test_transactions.py::test_multiple_repository_operations_in_transaction PASSED [  3%]
tests/integration/test_transactions.py::test_auto_commit_behavior PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetCurrentAllocation::test_returns_current_allocation PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetCurrentAllocation::test_includes_alerts PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetCurrentAllocation::test_handles_empty_allocations PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetAllocationDeviations::test_returns_deviations_with_status PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetAllocationDeviations::test_calculates_need_correctly PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetAllocationTargets::test_returns_country_and_industry_targets PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetAllocationTargets::test_handles_empty_targets PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetCountryGroups::test_returns_country_groups PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetCountryGroups::test_handles_empty_groups PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetIndustryGroups::test_returns_industry_groups PASSED [  3%]
tests/unit/api/test_allocation.py::TestGetIndustryGroups::test_handles_empty_groups PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroup::test_creates_or_updates_country_group PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroup::test_validates_group_name_required PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroup::test_filters_empty_countries PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroup::test_allows_empty_country_list PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroup::test_strips_whitespace_from_group_name PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroup::test_creates_or_updates_industry_group PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroup::test_validates_group_name_required PASSED [  3%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroup::test_filters_empty_industries PASSED [  3%]
tests/unit/api/test_allocation.py::TestDeleteCountryGroup::test_deletes_country_group PASSED [  3%]
tests/unit/api/test_allocation.py::TestDeleteIndustryGroup::test_deletes_industry_group PASSED [  4%]
tests/unit/api/test_allocation.py::TestGetAvailableCountries::test_returns_available_countries PASSED [  4%]
tests/unit/api/test_allocation.py::TestGetAvailableCountries::test_handles_empty_list PASSED [  4%]
tests/unit/api/test_allocation.py::TestGetAvailableIndustries::test_returns_available_industries PASSED [  4%]
tests/unit/api/test_allocation.py::TestGetGroupAllocation::test_returns_group_allocations PASSED [  4%]
tests/unit/api/test_allocation.py::TestGetGroupAllocation::test_maps_to_other_when_no_group PASSED [  4%]
tests/unit/api/test_allocation.py::TestGetGroupAllocation::test_handles_zero_total_value PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroupTargets::test_updates_country_group_targets PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroupTargets::test_validates_empty_targets PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroupTargets::test_validates_groups_exist PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroupTargets::test_validates_weight_range PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateCountryGroupTargets::test_filters_zero_targets PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroupTargets::test_updates_industry_group_targets PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroupTargets::test_validates_empty_targets PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroupTargets::test_validates_groups_exist PASSED [  4%]
tests/unit/api/test_allocation.py::TestUpdateIndustryGroupTargets::test_validates_weight_range PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateFormat::test_accepts_valid_date_format PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateFormat::test_rejects_invalid_date_format PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateFormat::test_rejects_invalid_date_values PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateFormat::test_rejects_invalid_separator PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateFormat::test_rejects_partial_date PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateRange::test_accepts_valid_date_range PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateRange::test_accepts_none_values PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateRange::test_validates_start_date_format PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateRange::test_validates_end_date_format PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestValidateDateRange::test_rejects_reversed_date_range PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestFormatCashFlowResponse::test_formats_single_cash_flow PASSED [  4%]
tests/unit/api/test_cash_flows.py::TestFormatCashFlowResponse::test_formats_multiple_cash_flows PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFormatCashFlowResponse::test_formats_empty_list PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFormatCashFlowResponse::test_handles_none_optional_fields PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFetchCashFlows::test_fetches_by_date_range PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFetchCashFlows::test_fetches_by_transaction_type PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFetchCashFlows::test_fetches_all_with_limit PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFetchCashFlows::test_date_range_takes_precedence_over_type PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestFetchCashFlows::test_date_range_requires_both_dates PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_returns_all_cash_flows PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_applies_limit PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_filters_by_transaction_type PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_filters_by_date_range PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_validates_date_format PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_validates_date_range_order PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_handles_empty_results PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_handles_repository_error PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlows::test_preserves_http_exceptions PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_syncs_transactions_successfully PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_handles_no_transactions PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_handles_none_transactions PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_handles_partial_sync PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_handles_api_connection_error PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_handles_api_fetch_error PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestSyncCashFlows::test_handles_repository_sync_error PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_returns_summary_with_all_types PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_handles_multiple_same_type PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_handles_none_transaction_type PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_handles_empty_cash_flows PASSED [  5%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_case_insensitive_deposit_matching PASSED [  6%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_case_insensitive_withdrawal_matching PASSED [  6%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_rounds_amounts_to_two_decimals PASSED [  6%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_handles_repository_error PASSED [  6%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_net_cash_flow_calculation PASSED [  6%]
tests/unit/api/test_cash_flows.py::TestGetCashFlowsSummary::test_handles_mixed_transaction_types PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_1m_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_3m_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_6m_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_1y_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_5y_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_10y_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_all_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_invalid_range PASSED [  6%]
tests/unit/api/test_charts.py::TestParseDateRange::test_parse_empty_string PASSED [  6%]
tests/unit/api/test_charts.py::TestShouldFetchData::test_should_fetch_when_no_cached_data PASSED [  6%]
tests/unit/api/test_charts.py::TestShouldFetchData::test_should_not_fetch_when_data_covers_range PASSED [  6%]
tests/unit/api/test_charts.py::TestShouldFetchData::test_should_fetch_when_cached_data_starts_after_range PASSED [  6%]
tests/unit/api/test_charts.py::TestShouldFetchData::test_should_not_fetch_when_no_start_date_and_has_data PASSED [  6%]
tests/unit/api/test_charts.py::TestCombineAndFilterData::test_combines_cached_and_fetched_data PASSED [  6%]
tests/unit/api/test_charts.py::TestCombineAndFilterData::test_removes_duplicates_keeping_latest PASSED [  6%]
tests/unit/api/test_charts.py::TestCombineAndFilterData::test_sorts_by_date PASSED [  6%]
tests/unit/api/test_charts.py::TestCombineAndFilterData::test_filters_by_start_date PASSED [  6%]
tests/unit/api/test_charts.py::TestCombineAndFilterData::test_handles_empty_inputs PASSED [  6%]
tests/unit/api/test_charts.py::TestCombineAndFilterData::test_filters_all_data_outside_range PASSED [  6%]
tests/unit/api/test_charts.py::TestGetCachedStockPrices::test_retrieves_prices_with_date_filter PASSED [  6%]
tests/unit/api/test_charts.py::TestGetCachedStockPrices::test_retrieves_all_prices_when_no_date_filter PASSED [  6%]
tests/unit/api/test_charts.py::TestStoreStockPrices::test_stores_tradernet_ohlc_data PASSED [  6%]
tests/unit/api/test_charts.py::TestStoreStockPrices::test_stores_yahoo_historical_data PASSED [  7%]
tests/unit/api/test_charts.py::TestStoreStockPrices::test_skips_invalid_price_data PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromTradernet::test_fetches_and_stores_data PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromTradernet::test_returns_empty_when_not_connected PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromTradernet::test_returns_empty_on_no_data PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromTradernet::test_handles_exception PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromYahoo::test_fetches_and_stores_data PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromYahoo::test_maps_range_to_yahoo_period PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromYahoo::test_uses_max_for_all_range PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromYahoo::test_returns_empty_on_no_data PASSED [  7%]
tests/unit/api/test_charts.py::TestFetchFromYahoo::test_handles_exception PASSED [  7%]
tests/unit/api/test_charts.py::TestSparklines::test_returns_sparklines_for_active_stocks PASSED [  7%]
tests/unit/api/test_charts.py::TestSparklines::test_uses_cache_when_available PASSED [  7%]
tests/unit/api/test_charts.py::TestStockChart::test_returns_chart_data_from_cache PASSED [  7%]
tests/unit/api/test_charts.py::TestStockChart::test_returns_empty_when_no_data PASSED [  7%]
tests/unit/api/test_charts.py::TestStockChart::test_raises_http_exception_on_database_error PASSED [  7%]
tests/unit/api/test_errors.py::TestErrorResponse::test_creates_standard_error_response PASSED [  7%]
tests/unit/api/test_errors.py::TestErrorResponse::test_allows_custom_status PASSED [  7%]
tests/unit/api/test_errors.py::TestErrorResponse::test_includes_additional_fields PASSED [  7%]
tests/unit/api/test_errors.py::TestErrorResponse::test_handles_empty_message PASSED [  7%]
tests/unit/api/test_errors.py::TestErrorResponse::test_handles_none_values_in_kwargs PASSED [  7%]
tests/unit/api/test_errors.py::TestErrorResponse::test_handles_nested_data_structures PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_creates_standard_success_response PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_includes_data_when_provided PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_includes_additional_fields PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_handles_none_data PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_handles_empty_data_structures PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_handles_nested_data_structures PASSED [  7%]
tests/unit/api/test_errors.py::TestSuccessResponse::test_kwargs_added_separately_from_data PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioPosition::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioPosition::test_validates_required_fields PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioPosition::test_accepts_zero_quantity PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioPosition::test_handles_negative_values PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioSummary::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioSummary::test_validates_required_fields PASSED [  8%]
tests/unit/api/test_models.py::TestCashBalance::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestCashBalance::test_accepts_negative_amount PASSED [  8%]
tests/unit/api/test_models.py::TestCashBreakdownResponse::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestCashBreakdownResponse::test_accepts_empty_balances PASSED [  8%]
tests/unit/api/test_models.py::TestDailyReturn::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestDailyReturn::test_accepts_negative_returns PASSED [  8%]
tests/unit/api/test_models.py::TestDailyReturn::test_serializes_with_alias PASSED [  8%]
tests/unit/api/test_models.py::TestMonthlyReturn::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestReturnsData::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestRiskMetrics::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestRiskMetrics::test_accepts_negative_ratios PASSED [  8%]
tests/unit/api/test_models.py::TestAttributionData::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestPeriodInfo::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestPeriodInfo::test_accepts_zero_days PASSED [  8%]
tests/unit/api/test_models.py::TestTurnoverInfo::test_valid_creation_with_turnover PASSED [  8%]
tests/unit/api/test_models.py::TestTurnoverInfo::test_valid_creation_without_turnover PASSED [  8%]
tests/unit/api/test_models.py::TestTurnoverInfo::test_validates_required_fields PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioAnalyticsResponse::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioAnalyticsResponse::test_accepts_optional_turnover PASSED [  8%]
tests/unit/api/test_models.py::TestPortfolioAnalyticsErrorResponse::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestStatusResponse::test_valid_creation PASSED [  8%]
tests/unit/api/test_models.py::TestStatusResponse::test_accepts_none_last_sync PASSED [  9%]
tests/unit/api/test_models.py::TestDatabaseSize::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestDatabaseSize::test_accepts_zero_size PASSED [  9%]
tests/unit/api/test_models.py::TestDatabaseStatsResponse::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestMarketStatus::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestMarketStatus::test_accepts_closed_market PASSED [  9%]
tests/unit/api/test_models.py::TestMarketsStatusResponse::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestDiskUsageResponse::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestJobStatus::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestJobStatus::test_accepts_none_next_run PASSED [  9%]
tests/unit/api/test_models.py::TestJobsStatusResponse::test_valid_creation PASSED [  9%]
tests/unit/api/test_models.py::TestJobsStatusResponse::test_accepts_empty_jobs_list PASSED [  9%]
tests/unit/api/test_optimizer.py::TestGetOptimizerStatus::test_returns_status_without_cache PASSED [  9%]
tests/unit/api/test_optimizer.py::TestGetOptimizerStatus::test_returns_status_with_cached_result PASSED [  9%]
tests/unit/api/test_optimizer.py::TestGetOptimizerStatus::test_calculates_min_trade_amount FAILED [  9%]
tests/unit/api/test_optimizer.py::TestRunOptimization::test_run_optimization_success PASSED [  9%]
tests/unit/api/test_optimizer.py::TestRunOptimization::test_run_optimization_no_stocks PASSED [  9%]
tests/unit/api/test_optimizer.py::TestRunOptimization::test_run_optimization_caches_result PASSED [  9%]
tests/unit/api/test_optimizer.py::TestRunOptimization::test_run_optimization_handles_tradernet_error PASSED [  9%]
tests/unit/api/test_optimizer.py::TestRunOptimization::test_run_optimization_passes_all_parameters PASSED [  9%]
tests/unit/api/test_optimizer.py::TestRunOptimization::test_run_optimization_calculates_portfolio_value PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_converts_result_with_top_changes PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_converts_result_with_sell_recommendation PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_converts_result_with_next_action PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_converts_result_with_sell_next_action PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_converts_result_no_weight_changes PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_converts_result_with_error PASSED [  9%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_limits_to_top_5_changes PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_includes_high_correlations PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestOptimizationResultToDict::test_includes_constraints_summary PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestUpdateOptimizationCache::test_updates_cache PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestUpdateOptimizationCache::test_updates_cache_timestamp PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestEdgeCases::test_handles_positions_without_prices PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestEdgeCases::test_handles_position_with_zero_quantity PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestEdgeCases::test_handles_none_achieved_return PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestEdgeCases::test_handles_large_change_value PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestOptimizerUsesAllocationRepo::test_uses_allocation_repo_for_country_targets PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestOptimizerUsesAllocationRepo::test_targets_not_divided_by_100_when_already_fractions PASSED [ 10%]
tests/unit/api/test_optimizer.py::TestOptimizerUsesAllocationRepo::test_uses_allocation_repo_and_converts_percentages PASSED [ 10%]
tests/unit/api/test_planner.py::TestRegenerateSequences::test_regenerates_sequences_successfully PASSED [ 10%]
tests/unit/api/test_planner.py::TestRegenerateSequences::test_generates_portfolio_hash PASSED [ 10%]
tests/unit/api/test_planner.py::TestRegenerateSequences::test_handles_tradernet_not_connected PASSED [ 10%]
tests/unit/api/test_planner.py::TestRegenerateSequences::test_handles_tradernet_errors_gracefully PASSED [ 10%]
tests/unit/api/test_planner.py::TestRegenerateSequences::test_deletes_sequences_and_best_result PASSED [ 10%]
tests/unit/api/test_planner.py::TestRegenerateSequences::test_handles_repository_errors PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_returns_status_when_no_sequences PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_returns_status_with_sequences PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_calculates_progress_percentage PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_detects_planning_active_with_scheduler_job PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_detects_planning_inactive_when_finished PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_handles_scheduler_not_available PASSED [ 10%]
tests/unit/api/test_planner.py::TestGetPlannerStatus::test_handles_errors_gracefully PASSED [ 10%]
tests/unit/api/test_planner.py::TestStreamPlannerStatus::test_streams_initial_status PASSED [ 10%]
tests/unit/api/test_planner.py::TestStreamPlannerStatus::test_streams_sse_format PASSED [ 10%]
tests/unit/api/test_planner.py::TestStreamPlannerStatus::test_handles_stream_errors PASSED [ 10%]
tests/unit/api/test_portfolio.py::TestGetPortfolio::test_returns_positions_with_stock_info PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolio::test_handles_position_without_stock PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolio::test_sorts_by_market_value PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolio::test_handles_empty_portfolio PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolio::test_handles_none_prices PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioSummary::test_returns_summary PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioSummary::test_handles_missing_geographies PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioHistory::test_returns_history PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioHistory::test_requests_90_days PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetTransactionHistory::test_returns_transaction_history PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetTransactionHistory::test_handles_api_error PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetCashBreakdown::test_returns_cash_breakdown PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetCashBreakdown::test_handles_no_connection PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetCashBreakdown::test_handles_api_error PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioAnalytics::test_returns_analytics PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioAnalytics::test_handles_insufficient_data PASSED [ 11%]
tests/unit/api/test_portfolio.py::TestGetPortfolioAnalytics::test_handles_analytics_error PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_returns_recommendation_sequence PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_returns_empty_when_no_recommendations PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_uses_recommendations_cache_key PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_returns_cached_data_when_available PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_caches_result_with_ttl PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_handles_multiple_steps PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_rounds_numeric_values PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_handles_service_exception PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_propagates_http_exception PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestGetRecommendations::test_generates_portfolio_aware_cache_key PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_executes_first_step_only PASSED [ 11%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_no_step_number_parameter PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_uses_recommendations_cache_key_for_execute PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_regenerates_cache_on_miss PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_raises_404_when_no_recommendations PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_validates_trade_before_execution PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_records_trade_after_execution PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_invalidates_caches_after_execution PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_raises_500_when_order_fails PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_handles_exception_during_execution PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteRecommendation::test_propagates_http_exception_from_safety_check PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteSingleStep::test_executes_step_successfully PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteSingleStep::test_blocks_when_pending_order_exists PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteSingleStep::test_handles_failed_order PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteSingleStep::test_handles_exception_during_execution PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestExecuteSingleStep::test_records_trade_after_successful_order PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestRegenerateRecommendationsCache::test_regenerates_cache_successfully PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestRegenerateRecommendationsCache::test_raises_404_when_no_recommendations PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestRegenerateRecommendationsCache::test_caches_regenerated_data PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestRemovedEndpoints::test_execute_all_endpoint_does_not_exist PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestRemovedEndpoints::test_strategies_endpoint_does_not_exist PASSED [ 12%]
tests/unit/api/test_recommendations.py::TestRemovedEndpoints::test_get_all_strategies_endpoint_does_not_exist PASSED [ 12%]
tests/unit/api/test_securities.py::TestGetStocks::test_get_stocks_returns_cached_data PASSED [ 12%]
tests/unit/api/test_securities.py::TestGetStocks::test_get_stocks_fetches_when_no_cache PASSED [ 12%]
tests/unit/api/test_securities.py::TestGetStock::test_get_stock_found PASSED [ 12%]
tests/unit/api/test_securities.py::TestGetStock::test_get_stock_not_found PASSED [ 12%]
tests/unit/api/test_securities.py::TestGetStock::test_get_stock_with_score PASSED [ 12%]
tests/unit/api/test_securities.py::TestGetStock::test_get_stock_with_position PASSED [ 12%]
tests/unit/api/test_securities.py::TestCreateStock::test_create_stock_already_exists PASSED [ 12%]
tests/unit/api/test_securities.py::TestCreateStock::test_create_stock_with_industry PASSED [ 13%]
tests/unit/api/test_securities.py::TestCreateStock::test_create_stock_detects_industry PASSED [ 13%]
tests/unit/api/test_securities.py::TestRefreshAllScores::test_refresh_all_scores_success PASSED [ 13%]
tests/unit/api/test_securities.py::TestRefreshAllScores::test_refresh_all_scores_detects_missing_industry PASSED [ 13%]
tests/unit/api/test_securities.py::TestRefreshAllScores::test_refresh_all_scores_error PASSED [ 13%]
tests/unit/api/test_securities.py::TestRefreshStockScore::test_refresh_stock_score_success PASSED [ 13%]
tests/unit/api/test_securities.py::TestRefreshStockScore::test_refresh_stock_score_not_found PASSED [ 13%]
tests/unit/api/test_securities.py::TestRefreshStockScore::test_refresh_stock_score_failed PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_success PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_not_found PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_no_updates PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_symbol_change PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_with_portfolio_targets PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_portfolio_target_validation_min_clamped PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_portfolio_target_validation_max_clamped PASSED [ 13%]
tests/unit/api/test_securities.py::TestUpdateStock::test_update_stock_portfolio_target_max_less_than_min PASSED [ 13%]
tests/unit/api/test_securities.py::TestGetStockResponse::test_get_stock_includes_portfolio_targets PASSED [ 13%]
tests/unit/api/test_securities.py::TestGetStocksResponse::test_get_stocks_includes_portfolio_targets PASSED [ 13%]
tests/unit/api/test_securities.py::TestDeleteStock::test_delete_stock_success PASSED [ 13%]
tests/unit/api/test_securities.py::TestDeleteStock::test_delete_stock_not_found PASSED [ 13%]
tests/unit/api/test_securities.py::TestValidateSymbolChange::test_validate_same_symbol PASSED [ 13%]
tests/unit/api/test_securities.py::TestValidateSymbolChange::test_validate_new_symbol_available PASSED [ 13%]
tests/unit/api/test_securities.py::TestValidateSymbolChange::test_validate_new_symbol_taken PASSED [ 13%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_string_update_with_value PASSED [ 13%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_string_update_with_transform PASSED [ 13%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_string_update_with_none PASSED [ 13%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_numeric_update_with_value PASSED [ 13%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_numeric_update_with_clamp PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_numeric_update_with_none PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_boolean_update_with_value PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_boolean_update_with_false PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_apply_boolean_update_with_none PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_build_update_dict PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_build_update_dict_with_new_symbol PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_format_stock_response_without_score PASSED [ 14%]
tests/unit/api/test_securities.py::TestHelperFunctions::test_format_stock_response_with_score PASSED [ 14%]
tests/unit/api/test_settings.py::TestSettingDefaults::test_has_min_hold_days FAILED [ 14%]
tests/unit/api/test_settings.py::TestSettingDefaults::test_has_trading_mode PASSED [ 14%]
tests/unit/api/test_settings.py::TestSettingDefaults::test_has_optimizer_settings PASSED [ 14%]
tests/unit/api/test_settings.py::TestSettingDefaults::test_has_transaction_cost_settings FAILED [ 14%]
tests/unit/api/test_settings.py::TestSettingDefaults::test_has_min_cash_reserve PASSED [ 14%]
tests/unit/api/test_settings.py::TestSettingDefaults::test_has_job_scheduling_settings PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSetting::test_returns_stored_value PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSetting::test_returns_none_when_not_set PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSetting::test_returns_default_when_not_set PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSettingsBatch::test_returns_requested_keys_from_cache PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSettingsBatch::test_fetches_from_db_when_not_cached PASSED [ 14%]
tests/unit/api/test_settings.py::TestSetSetting::test_sets_value_in_repo PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSettingValue::test_returns_db_value_as_float PASSED [ 14%]
tests/unit/api/test_settings.py::TestGetSettingValue::test_returns_default_when_not_in_db FAILED [ 14%]
tests/unit/api/test_settings.py::TestGetSettingValue::test_returns_zero_for_unknown_setting PASSED [ 14%]
tests/unit/api/test_settings.py::TestTradingMode::test_get_trading_mode_returns_live PASSED [ 14%]
tests/unit/api/test_settings.py::TestTradingMode::test_get_trading_mode_returns_research PASSED [ 14%]
tests/unit/api/test_settings.py::TestTradingMode::test_get_trading_mode_defaults_to_research PASSED [ 14%]
tests/unit/api/test_settings.py::TestTradingMode::test_get_trading_mode_rejects_invalid PASSED [ 14%]
tests/unit/api/test_settings.py::TestTradingMode::test_set_trading_mode_live PASSED [ 15%]
tests/unit/api/test_settings.py::TestTradingMode::test_set_trading_mode_rejects_invalid PASSED [ 15%]
tests/unit/api/test_settings.py::TestGetJobSettings::test_returns_all_job_settings PASSED [ 15%]
tests/unit/api/test_settings.py::TestGetJobSettings::test_uses_defaults_when_not_set PASSED [ 15%]
tests/unit/api/test_settings.py::TestGetAllSettingsEndpoint::test_returns_all_settings FAILED [ 15%]
tests/unit/api/test_settings.py::TestGetAllSettingsEndpoint::test_includes_trading_mode_as_string PASSED [ 15%]
tests/unit/api/test_settings.py::TestUpdateSettingEndpoint::test_updates_numeric_setting FAILED [ 15%]
tests/unit/api/test_settings.py::TestUpdateSettingEndpoint::test_rejects_unknown_setting PASSED [ 15%]
tests/unit/api/test_settings.py::TestUpdateSettingEndpoint::test_invalidates_recommendation_cache_for_optimizer_settings PASSED [ 15%]
tests/unit/api/test_settings.py::TestRestartEndpoints::test_restart_service PASSED [ 15%]
tests/unit/api/test_settings.py::TestRestartEndpoints::test_restart_service_handles_failure PASSED [ 15%]
tests/unit/api/test_settings.py::TestRestartEndpoints::test_restart_system PASSED [ 15%]
tests/unit/api/test_settings.py::TestCacheManagement::test_reset_cache PASSED [ 15%]
tests/unit/api/test_settings.py::TestCacheManagement::test_get_cache_stats PASSED [ 15%]
tests/unit/api/test_settings.py::TestRescheduleJobs::test_reschedule_jobs PASSED [ 15%]
tests/unit/api/test_settings.py::TestTradingModeEndpoints::test_get_trading_mode_endpoint PASSED [ 15%]
tests/unit/api/test_settings.py::TestTradingModeEndpoints::test_toggle_trading_mode_from_research_to_live PASSED [ 15%]
tests/unit/api/test_settings.py::TestTradingModeEndpoints::test_toggle_trading_mode_from_live_to_research PASSED [ 15%]
tests/unit/api/test_status.py::TestGetStatus::test_returns_healthy_status_with_data FAILED [ 15%]
tests/unit/api/test_status.py::TestGetStatus::test_handles_no_portfolio_snapshot PASSED [ 15%]
tests/unit/api/test_status.py::TestGetStatus::test_handles_no_positions PASSED [ 15%]
tests/unit/api/test_status.py::TestGetStatus::test_handles_invalid_date_format PASSED [ 15%]
tests/unit/api/test_status.py::TestGetStatus::test_handles_position_without_last_updated PASSED [ 15%]
tests/unit/api/test_status.py::TestGetStatus::test_finds_most_recent_position_update PASSED [ 15%]
tests/unit/api/test_status.py::TestSyncTriggers::test_portfolio_sync_success PASSED [ 15%]
tests/unit/api/test_status.py::TestSyncTriggers::test_portfolio_sync_handles_error PASSED [ 15%]
tests/unit/api/test_status.py::TestSyncTriggers::test_price_sync_success PASSED [ 15%]
tests/unit/api/test_status.py::TestSyncTriggers::test_price_sync_handles_error PASSED [ 15%]
tests/unit/api/test_status.py::TestSyncTriggers::test_historical_sync_success PASSED [ 16%]
tests/unit/api/test_status.py::TestSyncTriggers::test_daily_maintenance_success PASSED [ 16%]
tests/unit/api/test_status.py::TestTradernetStatus::test_connected_status PASSED [ 16%]
tests/unit/api/test_status.py::TestTradernetStatus::test_disconnected_when_client_none PASSED [ 16%]
tests/unit/api/test_status.py::TestTradernetStatus::test_disconnected_on_exception PASSED [ 16%]
tests/unit/api/test_status.py::TestJobStatus::test_returns_job_health_status PASSED [ 16%]
tests/unit/api/test_status.py::TestJobStatus::test_handles_error PASSED  [ 16%]
tests/unit/api/test_status.py::TestDatabaseStats::test_returns_database_stats PASSED [ 16%]
tests/unit/api/test_status.py::TestDatabaseStats::test_handles_error PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_calculate_data_dir_size_empty_dir PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_calculate_data_dir_size_with_files PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_calculate_data_dir_size_nonexistent PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_calculate_data_dir_size_nested_files PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_get_core_db_sizes PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_get_core_db_sizes_missing_dbs PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_get_history_db_info PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_get_history_db_info_no_history_dir PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_get_backup_info PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageHelpers::test_get_backup_info_no_backups PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageEndpoint::test_returns_disk_usage PASSED [ 16%]
tests/unit/api/test_status.py::TestDiskUsageEndpoint::test_handles_error PASSED [ 16%]
tests/unit/api/test_trades.py::TestTradeRequestValidation::test_validates_symbol PASSED [ 16%]
tests/unit/api/test_trades.py::TestTradeRequestValidation::test_validates_quantity_positive PASSED [ 16%]
tests/unit/api/test_trades.py::TestTradeRequestValidation::test_validates_quantity_max PASSED [ 16%]
tests/unit/api/test_trades.py::TestTradeRequestValidation::test_accepts_valid_request PASSED [ 16%]
tests/unit/api/test_trades.py::TestGetTrades::test_returns_trade_history PASSED [ 16%]
tests/unit/api/test_trades.py::TestExecuteTrade::test_raises_404_for_unknown_stock PASSED [ 16%]
tests/unit/api/test_trades.py::TestExecuteTrade::test_executes_trade_successfully PASSED [ 16%]
tests/unit/api/test_trades.py::TestExecuteTrade::test_raises_500_on_trade_failure PASSED [ 17%]
tests/unit/api/test_trades.py::TestGetAllocation::test_returns_allocation_data PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_detects_deposit_type PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_detects_refill_type PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_detects_transfer_in_type PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_ignores_withdrawal_type PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_ignores_dividend_type PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_handles_transaction_type_field PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestShouldProcessCashFlow::test_case_insensitive_matching PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestProcessDeposit::test_processes_deposit_with_satellites PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestProcessDeposit::test_returns_proper_structure PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestProcessDeposit::test_handles_missing_transaction_id PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestProcessDeposit::test_handles_missing_description PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestProcessDeposit::test_processes_usd_deposit PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestDepositProcessorEdgeCases::test_handles_zero_amount PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestDepositProcessorEdgeCases::test_handles_small_amount PASSED [ 17%]
tests/unit/cash_flows/test_deposit_processor.py::TestDepositProcessorEdgeCases::test_handles_large_amount PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_returns_zero_for_empty_returns PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_calculates_contributions_correctly PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_handles_empty_attribution PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_handles_non_finite_total_return PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_handles_non_finite_contributions PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_calculates_single_category_contribution PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_factors.py::TestGetFactorAttribution::test_calculates_negative_contributions PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_performance.py::TestAttributeReturnByCategory::test_attributes_return_by_country_and_industry PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_performance.py::TestAttributeReturnByCategory::test_handles_unknown_country PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_performance.py::TestAttributeReturnByCategory::test_handles_missing_industry PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_performance.py::TestCalculateAnnualizedAttribution::test_calculates_annualized_attribution_correctly PASSED [ 17%]
tests/unit/domain/analytics/test_attribution_performance.py::TestCalculateAnnualizedAttribution::test_handles_total_return_less_than_minus_one PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestCalculateAnnualizedAttribution::test_handles_empty_contributions PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestCalculateAnnualizedAttribution::test_handles_non_finite_values PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestGetPerformanceAttribution::test_returns_empty_for_empty_returns PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestGetPerformanceAttribution::test_returns_empty_for_empty_positions PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestGetPerformanceAttribution::test_calculates_attribution_correctly PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestGetPerformanceAttribution::test_skips_dates_with_no_positions PASSED [ 18%]
tests/unit/domain/analytics/test_attribution_performance.py::TestGetPerformanceAttribution::test_skips_zero_total_value PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestRegimeClassification::test_classifies_bull_market_correctly PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestRegimeClassification::test_classifies_bear_market_correctly PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestRegimeClassification::test_classifies_sideways_market_correctly PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestRegimeClassification::test_exactly_at_bull_threshold_classifies_bull PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestMACalculation::test_calculates_200_day_ma_correctly PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestMACalculation::test_handles_insufficient_data_gracefully PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestDistanceCalculation::test_calculates_distance_from_ma_correctly PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestDistanceCalculation::test_handles_zero_ma_gracefully PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime.py::TestErrorHandling::test_api_failure_returns_default_regime PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime_cache.py::TestRegimeCache::test_uses_cached_regime_when_available PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime_cache.py::TestRegimeCache::test_caches_regime_after_detection PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime_cache.py::TestRegimeCache::test_bypasses_cache_when_use_cache_false PASSED [ 18%]
tests/unit/domain/analytics/test_market_regime_cache.py::TestRegimeCache::test_handles_cache_failure_gracefully PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_calculates_metrics_for_valid_returns PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_returns_zero_metrics_for_empty_returns PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_returns_zero_metrics_for_single_value PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_handles_negative_returns PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_handles_risk_free_rate PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_handles_benchmark PASSED [ 18%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_handles_infinite_values_gracefully PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_handles_nan_values_gracefully PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_calmar_ratio_handles_zero_drawdown PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_portfolio.py::TestGetPortfolioMetrics::test_error_handling_returns_zero_metrics PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_calculates_daily_returns PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_handles_single_value PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_handles_empty_series PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_handles_zero_initial_value PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_preserves_datetime_index PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_handles_string_index_and_converts_to_datetime PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_handles_negative_values PASSED [ 19%]
tests/unit/domain/analytics/test_metrics_returns.py::TestCalculatePortfolioReturns::test_handles_constant_values PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_returns_none_for_insufficient_data PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_calculates_max_drawdown_from_peak PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_calculates_current_drawdown_from_latest_peak PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_returns_zero_drawdown_when_at_peak PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_handles_single_price_point PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_handles_declining_prices PASSED [ 19%]
tests/unit/domain/analytics/test_position_drawdown.py::TestGetPositionDrawdown::test_handles_recovery_after_drawdown PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_returns_cached_metrics_if_available PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_returns_zero_metrics_for_insufficient_data PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_returns_zero_metrics_for_single_price_point PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_calculates_metrics_correctly PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_handles_empty_returns_series PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_handles_non_finite_metrics PASSED [ 19%]
tests/unit/domain/analytics/test_position_risk.py::TestGetPositionRiskMetrics::test_handles_exceptions_gracefully PASSED [ 19%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_returns_series_with_initial_cash PASSED [ 19%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_deposit_transaction PASSED [ 19%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_withdrawal_transaction PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_dividend_transaction PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_buy_trade PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_sell_trade PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_trade_without_value_eur PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_multiple_transactions_on_same_date PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_filters_trades_outside_date_range PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_trade_with_datetime_string_executed_at PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_empty_cash_flows_and_trades PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_cash.py::TestReconstructCashBalance::test_handles_zero_initial_cash PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_returns_empty_dataframe_when_no_history PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_returns_dataframe_with_position_history PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_converts_date_to_datetime PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_handles_multiple_symbols PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_handles_zero_quantities PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_handles_negative_quantities PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_positions.py::TestReconstructHistoricalPositions::test_calls_trade_repo_with_correct_parameters PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_returns_series_with_initial_cash_only PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_calculates_portfolio_value_with_positions_and_prices PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_handles_forward_fill_missing_prices PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_handles_multiple_symbols PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_skips_zero_quantity_positions PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_handles_missing_price_data_gracefully PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_handles_exception_during_price_loading PASSED [ 20%]
tests/unit/domain/analytics/test_reconstruction_values.py::TestReconstructPortfolioValues::test_uses_last_known_price_when_no_historical_price PASSED [ 20%]
tests/unit/domain/events/test_domain_events.py::TestSecurityAddedEvent::test_creates_stock_added_event PASSED [ 20%]
tests/unit/domain/events/test_domain_events.py::TestSecurityAddedEvent::test_stock_added_event_properties PASSED [ 20%]
tests/unit/domain/events/test_domain_events.py::TestSecurityAddedEvent::test_stock_added_event_is_frozen PASSED [ 20%]
tests/unit/domain/events/test_domain_events.py::TestTradeExecutedEvent::test_creates_trade_executed_event PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestTradeExecutedEvent::test_trade_executed_event_properties PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestTradeExecutedEvent::test_trade_executed_event_is_frozen PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestPositionUpdatedEvent::test_creates_position_updated_event PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestPositionUpdatedEvent::test_position_updated_event_properties PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestPositionUpdatedEvent::test_position_updated_event_is_frozen PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestRecommendationCreatedEvent::test_creates_recommendation_created_event PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestRecommendationCreatedEvent::test_recommendation_created_event_properties PASSED [ 21%]
tests/unit/domain/events/test_domain_events.py::TestRecommendationCreatedEvent::test_recommendation_created_event_is_frozen PASSED [ 21%]
tests/unit/domain/factories/test_recommendation_factory.py::TestRecommendationFactory::test_create_buy_recommendation PASSED [ 21%]
tests/unit/domain/factories/test_recommendation_factory.py::TestRecommendationFactory::test_create_sell_recommendation PASSED [ 21%]
tests/unit/domain/factories/test_recommendation_factory.py::TestRecommendationFactory::test_create_buy_recommendation_calculates_score_change PASSED [ 21%]
tests/unit/domain/factories/test_recommendation_factory.py::TestRecommendationFactory::test_create_buy_recommendation_without_scores PASSED [ 21%]
tests/unit/domain/factories/test_recommendation_factory.py::TestRecommendationFactory::test_create_buy_recommendation_defaults PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_all_fields PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_minimal_required_fields PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_normalizes_symbol PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_empty_symbol PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_empty_name PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_missing_symbol PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_missing_name PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_currency_string PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_min_lot_validation PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_strips_whitespace PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_all_fields PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_defaults PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_normalizes_symbol PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_currency_string PASSED [ 21%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_currency_enum PASSED [ 22%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_min_lot_validation PASSED [ 22%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateWithIndustryDetection::test_create_stock_with_detected_industry PASSED [ 22%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateWithIndustryDetection::test_create_stock_with_industry_from_data PASSED [ 22%]
tests/unit/domain/factories/test_security_factory.py::TestSecurityFactoryCreateWithIndustryDetection::test_create_stock_prioritizes_detected_industry PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_all_fields PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_minimal_required_fields PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_normalizes_symbol PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_empty_symbol PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_empty_name PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_missing_symbol PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_raises_error_for_missing_name PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_currency_string PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_with_min_lot_validation PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromApiRequest::test_create_stock_strips_whitespace PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_all_fields PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_defaults PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_normalizes_symbol PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_currency_string PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_currency_enum PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateFromImport::test_create_stock_from_import_with_min_lot_validation PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateWithIndustryDetection::test_create_stock_with_detected_industry PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateWithIndustryDetection::test_create_stock_with_industry_from_data PASSED [ 22%]
tests/unit/domain/factories/test_security_factory_actual.py::TestSecurityFactoryCreateWithIndustryDetection::test_create_stock_prioritizes_detected_industry PASSED [ 22%]
tests/unit/domain/factories/test_trade_factory.py::TestTradeFactory::test_create_from_execution PASSED [ 22%]
tests/unit/domain/factories/test_trade_factory.py::TestTradeFactory::test_create_from_execution_calculates_eur_value PASSED [ 22%]
tests/unit/domain/factories/test_trade_factory.py::TestTradeFactory::test_create_from_execution_without_currency_rate PASSED [ 22%]
tests/unit/domain/factories/test_trade_factory.py::TestTradeFactory::test_create_from_sync PASSED [ 23%]
tests/unit/domain/factories/test_trade_factory.py::TestTradeFactory::test_create_from_sync_converts_strings PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_validates_symbol_not_empty PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_validates_name_not_empty PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_accepts_any_country PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_validates_min_lot_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_valid_creation PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_min_portfolio_target_accepts_valid_range PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_min_portfolio_target_rejects_negative PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_min_portfolio_target_rejects_over_20 PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_max_portfolio_target_accepts_valid_range PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_max_portfolio_target_rejects_negative PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_max_portfolio_target_rejects_over_30 PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_max_portfolio_target_greater_than_min PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_max_portfolio_target_less_than_min_raises_error PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_portfolio_targets_none_allowed PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_min_portfolio_target_without_max PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestStockValidation::test_stock_max_portfolio_target_without_min PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestPositionValidation::test_position_validates_quantity_non_negative PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestPositionValidation::test_position_validates_avg_price_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestPositionValidation::test_position_valid_creation PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestTradeValidation::test_trade_validates_quantity_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestTradeValidation::test_trade_validates_price_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestTradeValidation::test_trade_valid_creation PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestRecommendationValidation::test_recommendation_validates_quantity_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestRecommendationValidation::test_recommendation_validates_estimated_price_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestRecommendationValidation::test_recommendation_validates_estimated_value_positive PASSED [ 23%]
tests/unit/domain/models/test_domain_validation.py::TestRecommendationValidation::test_recommendation_valid_creation PASSED [ 23%]
tests/unit/domain/models/test_recommendation.py::TestRecommendation::test_create_buy_recommendation PASSED [ 24%]
tests/unit/domain/models/test_recommendation.py::TestRecommendation::test_create_sell_recommendation PASSED [ 24%]
tests/unit/domain/models/test_recommendation.py::TestRecommendation::test_recommendation_default_status PASSED [ 24%]
tests/unit/domain/models/test_recommendation.py::TestRecommendation::test_recommendation_status_transitions PASSED [ 24%]
tests/unit/domain/models/test_recommendation.py::TestRecommendation::test_recommendation_with_portfolio_scores PASSED [ 24%]
tests/unit/domain/models/test_recommendation.py::TestRecommendation::test_recommendation_calculates_score_change PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_empty_symbol PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_whitespace_symbol PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_empty_name PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_normalizes_symbol_to_uppercase PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_strips_symbol_whitespace PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_min_lot PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_min_portfolio_target_range PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_max_portfolio_target_range PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestSecurityValidation::test_stock_validates_max_greater_than_min PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_validates_empty_symbol PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_validates_negative_quantity PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_validates_zero_avg_price PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_validates_negative_avg_price PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_normalizes_symbol_to_uppercase PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_validates_currency_rate PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestPositionValidation::test_position_allows_zero_quantity PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestTradeValidation::test_trade_validates_empty_symbol PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestTradeValidation::test_trade_validates_zero_quantity PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestTradeValidation::test_trade_validates_negative_quantity PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestTradeValidation::test_trade_validates_zero_price PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestTradeValidation::test_trade_validates_negative_price PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestTradeValidation::test_trade_normalizes_symbol_to_uppercase PASSED [ 24%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_validates_empty_symbol PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_validates_empty_name PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_validates_zero_quantity PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_validates_zero_estimated_price PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_validates_zero_estimated_value PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_validates_empty_reason PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_normalizes_symbol_to_uppercase PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_calculates_score_change PASSED [ 25%]
tests/unit/domain/models/test_validation.py::TestRecommendationValidation::test_recommendation_score_change_none_when_scores_missing PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_identifies_quality_dip PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_skips_stock_not_allowed_to_buy PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_skips_stock_without_price PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_skips_low_quality_stock PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_skips_stock_not_owned PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_skips_stock_not_down_enough PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_uses_exchange_rate_service PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_priority_based_on_quality_and_dip PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_averaging_down.py::TestIdentifyAveragingDownOpportunities::test_includes_tags PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_identifies_overweight_country PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_skips_stock_not_allowed_to_sell PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_skips_zero_value_position PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_skips_unknown_stock PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_skips_country_not_in_allocations PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_skips_balanced_country PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_uses_exchange_rate_service PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_includes_tags PASSED [ 25%]
tests/unit/domain/planning/opportunities/test_rebalance_sells.py::TestIdentifyRebalanceSellOpportunities::test_priority_proportional_to_overweight PASSED [ 25%]
tests/unit/domain/planning/test_holistic_planner.py::TestCalculateWeightGaps::test_calculates_underweight_gap PASSED [ 25%]
tests/unit/domain/planning/test_holistic_planner.py::TestCalculateWeightGaps::test_calculates_overweight_gap PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestCalculateWeightGaps::test_includes_positions_not_in_target PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestCalculateWeightGaps::test_ignores_tiny_gaps PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestCalculateWeightGaps::test_sorts_by_absolute_gap_size PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestIsTradeWorthwhile::test_worthwhile_large_trade PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestIsTradeWorthwhile::test_not_worthwhile_small_trade PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestIsTradeWorthwhile::test_borderline_trade PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestProcessBuyOpportunity::test_adds_buy_opportunity PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestProcessBuyOpportunity::test_skips_if_allow_buy_false PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestProcessBuyOpportunity::test_skips_if_stock_is_none PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestProcessBuyOpportunity::test_respects_min_lot PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestProcessBuyOpportunity::test_categorizes_as_averaging_down PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestProcessBuyOpportunity::test_skips_zero_quantity PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestActionCandidate::test_creates_buy_candidate PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestActionCandidate::test_creates_sell_candidate PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestHolisticStep::test_creates_step_with_defaults PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestHolisticStep::test_creates_windfall_step PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestHolisticPlan::test_empty_plan_is_feasible PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestHolisticPlan::test_plan_with_improvement PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestGenerateActionSequences::test_direct_buys_with_available_cash PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestGenerateActionSequences::test_profit_taking_first PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestGenerateActionSequences::test_respects_cash_constraints PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestGenerateActionSequences::test_empty_opportunities_returns_empty PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestGenerateActionSequences::test_rebalance_sequence_includes_sells_and_buys PASSED [ 26%]
tests/unit/domain/planning/test_holistic_planner.py::TestGenerateActionSequences::test_averaging_down_funded_by_profit_taking PASSED [ 26%]
tests/unit/domain/planning/test_narrative.py::TestAddStrategySummary::test_windfall_and_averaging PASSED [ 26%]
tests/unit/domain/planning/test_narrative.py::TestAddStrategySummary::test_windfall_only PASSED [ 26%]
tests/unit/domain/planning/test_narrative.py::TestAddStrategySummary::test_averaging_only PASSED [ 26%]
tests/unit/domain/planning/test_narrative.py::TestAddStrategySummary::test_rebalance PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddStrategySummary::test_buys_only PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddStrategySummary::test_sells_only PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddStepSummary::test_includes_action_count PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddStepSummary::test_includes_sell_summary PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddStepSummary::test_includes_buy_summary PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddExpectedOutcome::test_positive_improvement PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddExpectedOutcome::test_negative_improvement PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestAddExpectedOutcome::test_zero_improvement PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateSellNarrative::test_windfall_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateSellNarrative::test_profit_taking_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateSellNarrative::test_rebalance_overweight_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateSellNarrative::test_includes_buy_opportunity_context PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateBuyNarrative::test_averaging_down_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateBuyNarrative::test_rebalance_underweight_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateBuyNarrative::test_quality_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateBuyNarrative::test_includes_dividend_yield PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateStepNarrative::test_generates_sell_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateStepNarrative::test_generates_buy_narrative PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGeneratePlanNarrative::test_empty_plan PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGeneratePlanNarrative::test_includes_all_components PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateTradeoffExplanation::test_no_explanation_for_positive_individual PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateTradeoffExplanation::test_no_explanation_when_sequence_worse PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestGenerateTradeoffExplanation::test_explains_tradeoff PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestFormatActionSummary::test_formats_sell PASSED [ 27%]
tests/unit/domain/planning/test_narrative.py::TestFormatActionSummary::test_formats_buy PASSED [ 27%]
tests/unit/domain/planning/test_planner_performance.py::test_metrics_prefetching_reduces_db_queries SKIPPED [ 27%]
tests/unit/domain/planning/test_planner_performance.py::test_parallel_evaluation_improves_performance SKIPPED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCreate::test_create_cash_flow_record PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCreate::test_create_cash_flow_with_params_json PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_get_by_transaction_id PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_get_by_transaction_id_not_found PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_exists_true PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_exists_false PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_get_all_with_limit PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_get_all_without_limit PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_get_by_date_range PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryQuery::test_get_by_type PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositorySyncFromAPI::test_sync_from_api_new_transactions PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositorySyncFromAPI::test_sync_from_api_skip_existing PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositorySyncFromAPI::test_sync_from_api_with_params PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositorySyncFromAPI::test_sync_from_api_skip_invalid_transactions PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositorySyncFromAPI::test_sync_from_api_handles_defaults PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryTotals::test_get_total_deposits PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryTotals::test_get_total_deposits_returns_zero_when_none PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryTotals::test_get_total_deposits_handles_case_variations PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryTotals::test_get_total_withdrawals PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryTotals::test_get_total_withdrawals_returns_zero_when_none PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_with_deposits PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_with_withdrawals PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_with_dividends PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_multiple_transactions_same_day PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_empty_result PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_with_initial_cash PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_handles_null_amounts PASSED [ 28%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryCashBalanceHistory::test_get_cash_balance_history_case_insensitive_types PASSED [ 29%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryRowConversion::test_row_to_cash_flow_basic PASSED [ 29%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryRowConversion::test_row_to_cash_flow_with_all_fields PASSED [ 29%]
tests/unit/domain/repositories/test_cash_flow_repository.py::TestCashFlowRepositoryRowConversion::test_row_to_cash_flow_with_nulls PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryCreate::test_create_dividend_record PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_get_by_id PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_get_by_id_not_found PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_get_by_cash_flow_id PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_exists_for_cash_flow_true PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_exists_for_cash_flow_false PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_get_by_symbol PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_get_all_with_limit PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryQuery::test_get_all_without_limit PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryPendingBonus::test_get_pending_bonuses PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryPendingBonus::test_get_pending_bonus_for_symbol PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryPendingBonus::test_get_pending_bonus_returns_zero_when_none PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryPendingBonus::test_set_pending_bonus PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryPendingBonus::test_clear_bonus PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryReinvestment::test_mark_reinvested PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryReinvestment::test_get_unreinvested_dividends PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryReinvestment::test_get_total_reinvested PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryReinvestment::test_get_total_reinvested_returns_zero_when_none PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryReinvestment::test_get_reinvestment_rate PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryReinvestment::test_get_reinvestment_rate_returns_zero_when_no_dividends PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryStatistics::test_get_total_dividends_by_symbol PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryRowConversion::test_row_to_dividend_basic PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryRowConversion::test_row_to_dividend_reinvested PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryRowConversion::test_row_to_dividend_with_bonus PASSED [ 29%]
tests/unit/domain/repositories/test_dividend_repository.py::TestDividendRepositoryRowConversion::test_row_to_dividend_cleared_bonus PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryInit::test_init_normalizes_symbol PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryInit::test_init_stores_symbol PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryInit::test_init_db_is_lazy_loaded PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryGetDb::test_get_db_initializes_database PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryGetDb::test_get_db_caches_database PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_daily_prices_with_default_limit PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_daily_prices_with_custom_limit PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_daily_prices_empty_result PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_daily_range PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_daily_range_empty PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_latest_price PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDailyPrices::test_get_latest_price_no_data PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryUpsertDaily::test_upsert_daily PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryUpsertDaily::test_upsert_daily_batch_empty PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryUpsertDaily::test_upsert_daily_batch_multiple PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryMonthlyPrices::test_get_monthly_prices_with_default_limit PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryMonthlyPrices::test_get_monthly_prices_with_custom_limit PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryMonthlyPrices::test_get_monthly_prices_empty PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryMonthlyPrices::test_upsert_monthly PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryAggregation::test_aggregate_to_monthly PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryAggregation::test_aggregate_to_monthly_no_data PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDeletion::test_delete_before PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDeletion::test_delete_before_no_data PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryDeletion::test_delete_before_null_count PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepository52Week::test_get_52_week_high PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepository52Week::test_get_52_week_high_no_data PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepository52Week::test_get_52_week_low PASSED [ 30%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepository52Week::test_get_52_week_low_no_data PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryIntegrity::test_integrity_check_success PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryIntegrity::test_integrity_check_failure PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryRowConversion::test_row_to_daily_basic PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryRowConversion::test_row_to_daily_with_none_source PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryRowConversion::test_row_to_monthly_basic PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryRowConversion::test_row_to_monthly_with_none_source PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryEdgeCases::test_get_daily_prices_with_zero_limit PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryEdgeCases::test_upsert_daily_with_minimal_data PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryEdgeCases::test_symbol_normalization_in_multiple_instances PASSED [ 31%]
tests/unit/domain/repositories/test_history_repository.py::TestHistoryRepositoryEdgeCases::test_get_daily_range_same_start_end_date PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindExisting::test_find_existing_returns_recommendation PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindExisting::test_find_existing_normalizes_symbol_case PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindExisting::test_find_existing_returns_none_when_not_found PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryCreateOrUpdate::test_create_new_recommendation PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryCreateOrUpdate::test_create_recommendation_uses_default_currency PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryCreateOrUpdate::test_update_existing_pending_recommendation PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryCreateOrUpdate::test_dismissed_recommendation_returns_none PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryCreateOrUpdate::test_executed_recommendation_updated_to_pending PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetByUuid::test_get_by_uuid_returns_recommendation PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetByUuid::test_get_by_uuid_returns_none_when_not_found PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetPending::test_get_pending_returns_recommendations PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetPending::test_get_pending_respects_limit PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetPending::test_get_pending_empty_list PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetPendingBySide::test_get_pending_by_side_buy PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetPendingBySide::test_get_pending_by_side_normalizes_case PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryGetPendingBySide::test_get_pending_by_side_respects_limit PASSED [ 31%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryMarkExecuted::test_mark_executed_with_provided_timestamp PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryMarkExecuted::test_mark_executed_with_default_timestamp PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryMarkDismissed::test_mark_dismissed_with_provided_timestamp PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryMarkDismissed::test_mark_dismissed_with_default_timestamp PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryIsDismissed::test_is_dismissed_returns_true PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryIsDismissed::test_is_dismissed_returns_false_for_pending PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryIsDismissed::test_is_dismissed_returns_false_when_not_found PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryIsDismissed::test_is_dismissed_normalizes_case PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindMatchingForExecution::test_find_matching_for_execution_returns_matches PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindMatchingForExecution::test_find_matching_for_execution_normalizes_case PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindMatchingForExecution::test_find_matching_for_execution_empty_list PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryFindMatchingForExecution::test_find_matching_for_execution_filters_by_portfolio_hash PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_create_recommendation_with_minimal_data PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_create_recommendation_with_all_optional_fields PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_multiple_recommendations_same_symbol_different_reasons PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_get_pending_ordered_by_updated_at_desc PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_get_pending_by_side_ordered_by_priority_and_updated_at PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_recommendation_with_zero_values PASSED [ 32%]
tests/unit/domain/repositories/test_recommendation_repository.py::TestRecommendationRepositoryEdgeCases::test_recommendation_with_negative_score_change PASSED [ 32%]
tests/unit/domain/repositories/test_repository_protocols.py::TestRepositoryProtocols::test_stock_repository_protocol PASSED [ 32%]
tests/unit/domain/repositories/test_repository_protocols.py::TestRepositoryProtocols::test_position_repository_protocol PASSED [ 32%]
tests/unit/domain/repositories/test_repository_protocols.py::TestRepositoryProtocols::test_trade_repository_protocol PASSED [ 32%]
tests/unit/domain/repositories/test_repository_protocols.py::TestRepositoryProtocols::test_settings_repository_protocol PASSED [ 32%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_creation_with_value_only PASSED [ 32%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_creation_with_all_fields PASSED [ 32%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_failure PASSED [ 32%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_with_sub_components PASSED [ 32%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_with_metadata PASSED [ 32%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_zero_value PASSED [ 33%]
tests/unit/domain/responses/test_calculation.py::TestCalculationResult::test_calculation_result_negative_value PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_creation PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_with_metadata PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_pagination PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_empty_items PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_total_auto_set_from_items PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_with_strings PASSED [ 33%]
tests/unit/domain/responses/test_list.py::TestListResult::test_list_result_with_dicts PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_creation_with_score_only PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_creation_with_all_fields PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_with_sub_scores PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_with_confidence PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_with_metadata PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_zero_score PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_max_score PASSED [ 33%]
tests/unit/domain/responses/test_score.py::TestScoreResult::test_score_result_low_score PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_success_result_creation PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_error_result_creation PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_success_result_with_none_data PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_error_result_validation_requires_error_message PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_is_success_returns_true_for_success PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_is_success_returns_false_for_error PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_is_error_returns_false_for_success PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_is_error_returns_true_for_error PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_service_result_with_integer_data PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_service_result_with_list_data PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_service_result_with_dict_data PASSED [ 33%]
tests/unit/domain/responses/test_service.py::TestServiceResult::test_service_result_with_metadata PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateRecentMomentum::test_returns_none_for_insufficient_data PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateRecentMomentum::test_calculates_positive_momentum PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateRecentMomentum::test_calculates_negative_momentum PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateRecentMomentum::test_handles_exactly_30_days PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateRecentMomentum::test_handles_zero_price PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateShortTermScore::test_calculates_score_with_prices PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateShortTermScore::test_handles_insufficient_data PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateShortTermScore::test_uses_pyfolio_drawdown_when_provided PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateShortTermScore::test_stores_momentum_metrics PASSED [ 34%]
tests/unit/domain/scoring/groups/test_short_term.py::TestCalculateShortTermScore::test_blends_momentum_correctly PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateGeoGapScore::test_returns_base_score_when_no_weight PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateGeoGapScore::test_increases_score_for_positive_weight PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateGeoGapScore::test_decreases_score_for_negative_weight PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateGeoGapScore::test_clamps_score_to_range PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateIndustryGapScore::test_returns_base_score_when_no_industry PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateIndustryGapScore::test_returns_base_score_when_empty_industry PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateIndustryGapScore::test_handles_single_industry PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateIndustryGapScore::test_handles_multiple_industries PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateAveragingDownScore::test_returns_base_when_no_position PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateAveragingDownScore::test_high_score_for_quality_opportunity PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateAveragingDownScore::test_low_score_for_low_quality PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestApplyCostBasisBonus::test_returns_original_when_no_price_data PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestApplyCostBasisBonus::test_boosts_score_when_below_cost_basis PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestApplyCostBasisBonus::test_no_boost_when_above_cost_basis PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestApplyConcentrationPenalty::test_returns_original_when_no_total_value PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestApplyConcentrationPenalty::test_applies_high_concentration_penalty PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestApplyConcentrationPenalty::test_no_penalty_for_small_position PASSED [ 34%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateDiversificationScore::test_returns_score_result PASSED [ 35%]
tests/unit/domain/scoring/test_diversification.py::TestCalculateDiversificationScore::test_includes_sub_scores PASSED [ 35%]
tests/unit/domain/scoring/test_diversification.py::TestCalculatePortfolioScore::test_returns_default_for_empty_portfolio PASSED [ 35%]
tests/unit/domain/scoring/test_diversification.py::TestCalculatePortfolioScore::test_calculates_components PASSED [ 35%]
tests/unit/domain/scoring/test_diversification.py::TestCalculatePortfolioScore::test_uses_cache_when_hash_provided PASSED [ 35%]
tests/unit/domain/scoring/test_diversification.py::TestCalculatePostTransactionScore::test_calculates_new_score_after_transaction PASSED [ 35%]
tests/unit/domain/scoring/test_diversification.py::TestCalculatePostTransactionScore::test_uses_cache_when_hash_provided PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_no_history_returns_false PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_single_value_returns_false PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_no_cut_in_growing_dividends PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_small_cut_below_threshold_returns_false PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_exactly_at_threshold_does_not_trigger PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_big_cut_detected_with_correct_timing PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_multiple_cuts_returns_first_cut PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_zero_previous_dividend_ignored PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_recent_cut_returns_years_since_one PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_massive_cut_detection PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestHasBigDividendCut::test_negative_dividends_handled PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_no_history_returns_none PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_single_value_returns_none PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_steady_growth_calculates_cagr PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_doubling_over_two_years PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_flat_dividends_returns_zero PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_declining_dividends_returns_negative_cagr PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_filters_out_leading_zeros PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_all_zeros_returns_none PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_zero_start_dividend_returns_none PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_negative_start_dividend_returns_none PASSED [ 35%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_handles_division_by_zero PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendGrowthRate::test_value_error_handled PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateCutPenalty::test_recent_cut_max_penalty PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateCutPenalty::test_medium_term_cut_partial_penalty PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateCutPenalty::test_old_cut_minimal_penalty PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateCutPenalty::test_no_cut_with_long_history_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateCutPenalty::test_no_cut_with_medium_history_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateCutPenalty::test_no_cut_with_short_history_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateGrowthBonus::test_high_growth_max_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateGrowthBonus::test_medium_growth_mid_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateGrowthBonus::test_stable_growth_small_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateGrowthBonus::test_zero_growth_small_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateGrowthBonus::test_negative_growth_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateGrowthBonus::test_none_growth_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_significantly_above_average_max_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_above_average_mid_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_below_average_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_none_yield_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_zero_yield_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_negative_yield_no_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_exactly_at_average_gets_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateYieldBonus::test_exactly_at_threshold_gets_max_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_perfect_dividend_stock_high_score PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_recent_cut_lowers_score PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_old_cut_partial_impact PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_flat_dividends_high_stability_score PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_declining_dividends_no_growth_bonus PASSED [ 36%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_high_yield_boosts_score PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_score_clamped_to_valid_range PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_default_portfolio_yield_used PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestCalculateDividendStabilityScore::test_none_current_yield_handled PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_returns_complete_analysis PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_sustainable_payout_high_stability PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_high_payout_low_stability PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_yield_assessment_significantly_above PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_yield_assessment_above_average PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_yield_assessment_below_average PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_yield_assessment_no_dividend PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_caches_stability_score PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_handles_none_payout_ratio PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendAnalysis::test_formats_percentages_correctly PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_no_dividend_stock PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_excellent_high_yield PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_good_above_average PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_stable_below_average PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_moderate_stability PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_caution_high_payout PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_warning_low_stability PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestGetDividendRecommendation::test_high_risk_very_low_stability PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_consistent_dividend_returns_true PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_no_yield_returns_false PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_negative_yield_returns_false PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_low_stability_returns_false PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_exactly_at_min_stability_returns_true PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_below_average_yield_but_stable_returns_true PASSED [ 37%]
tests/unit/domain/scoring/test_dividend_history.py::TestIsDividendConsistent::test_custom_min_stability PASSED [ 38%]
tests/unit/domain/scoring/test_dividend_history.py::TestDividendConstants::test_dividend_cut_threshold_value PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestDividendConsistencyFromPayout::test_optimal_payout_30_to_60 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestDividendConsistencyFromPayout::test_low_payout_below_30 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestDividendConsistencyFromPayout::test_high_payout_60_to_80 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestDividendConsistencyFromPayout::test_excessive_payout_above_80 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSortinoToScore::test_excellent_sortino_above_2 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSortinoToScore::test_good_sortino_1_5_to_2 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSortinoToScore::test_decent_sortino_1_to_1_5 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSortinoToScore::test_low_sortino_0_to_1 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSortinoToScore::test_negative_sortino PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertVolatilityToScore::test_low_volatility_below_15 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertVolatilityToScore::test_moderate_volatility_15_to_25 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertVolatilityToScore::test_high_volatility_25_to_40 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertVolatilityToScore::test_extreme_volatility_above_40 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertDrawdownToScore::test_small_drawdown_below_10 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertDrawdownToScore::test_moderate_drawdown_10_to_20 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertDrawdownToScore::test_significant_drawdown_20_to_30 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertDrawdownToScore::test_large_drawdown_30_to_50 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertDrawdownToScore::test_severe_drawdown_above_50 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSharpeToScore::test_excellent_sharpe_above_2 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSharpeToScore::test_good_sharpe_1_to_2 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSharpeToScore::test_decent_sharpe_0_5_to_1 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSharpeToScore::test_low_sharpe_0_to_0_5 PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestConvertSharpeToScore::test_negative_sharpe PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateTotalReturnScore::test_uses_metrics_dict PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateTotalReturnScore::test_handles_missing_metrics PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateLongTermPromise::test_uses_metrics_dict PASSED [ 38%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateLongTermPromise::test_defaults_to_0_5_when_no_data PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateStabilityScore::test_combines_all_components PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateStabilityScore::test_uses_metrics_dict PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculatePortfolioEndStateScore::test_returns_0_5_for_empty_portfolio PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculatePortfolioEndStateScore::test_calculates_weighted_scores PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculatePortfolioEndStateScore::test_skips_zero_value_positions PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculatePortfolioEndStateScore::test_includes_weight_contributions PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateTotalReturnScoreWithMetrics::test_uses_metrics_dict PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateTotalReturnScoreWithMetrics::test_handles_missing_metrics PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateLongTermPromiseWithMetrics::test_uses_metrics_dict PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateLongTermPromiseWithMetrics::test_handles_missing_metrics PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateStabilityScoreWithMetrics::test_uses_metrics_dict PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculateStabilityScoreWithMetrics::test_handles_missing_metrics PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculatePortfolioEndStateScoreWithMetricsCache::test_uses_metrics_cache PASSED [ 39%]
tests/unit/domain/scoring/test_end_state.py::TestCalculatePortfolioEndStateScoreWithMetricsCache::test_handles_missing_symbols_in_cache PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestScoreTotalReturn::test_optimal_return_gets_highest_score PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestScoreTotalReturn::test_zero_return_gets_minimum_score PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestScoreTotalReturn::test_negative_return_gets_minimum_score PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestScoreTotalReturn::test_moderate_return_gets_good_score PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestScoreTotalReturn::test_high_return_still_scores_well PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestScoreTotalReturn::test_very_high_return_gets_moderate_score PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateExcessGain::test_consistent_grower_has_low_excess PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateExcessGain::test_windfall_has_high_excess PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateExcessGain::test_underperformer_has_negative_excess PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateExcessGain::test_zero_years_held_returns_full_gain_as_excess PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateExcessGain::test_negative_cagr_handled_gracefully PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestShouldTakeProfits::test_windfall_doubler_sells_50_percent PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestShouldTakeProfits::test_consistent_doubler_sells_30_percent PASSED [ 39%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestShouldTakeProfits::test_high_windfall_sells_40_percent PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestShouldTakeProfits::test_medium_windfall_sells_20_percent PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestShouldTakeProfits::test_consistent_grower_at_ath_does_not_sell PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestShouldTakeProfits::test_underperformer_does_not_trigger_profit_taking PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestHasBigDividendCut::test_detects_big_cut PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestHasBigDividendCut::test_ignores_small_cut PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestHasBigDividendCut::test_tracks_years_since_cut PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestHasBigDividendCut::test_handles_short_history PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestHasBigDividendCut::test_handles_empty_history PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestHasBigDividendCut::test_handles_zero_dividend PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendGrowthRate::test_calculates_positive_growth PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendGrowthRate::test_calculates_negative_growth PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendGrowthRate::test_returns_none_for_short_history PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendGrowthRate::test_skips_leading_zeros PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendStabilityScore::test_no_cuts_and_growth_gets_high_score PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendStabilityScore::test_recent_cut_gets_low_score PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendStabilityScore::test_old_cut_has_less_penalty PASSED [ 40%]
tests/unit/domain/scoring/test_holistic_scoring.py::TestCalculateDividendStabilityScore::test_above_average_yield_gets_bonus PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestScoreWeights::test_weights_sum_to_one PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestScoreWeights::test_all_weights_positive PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestScoreWeights::test_has_all_required_groups PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_returns_calculated_stock_score PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_uses_default_weights_when_none_provided PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_accepts_custom_weights PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_normalizes_weights_to_sum_one PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_calculates_weighted_average_correctly PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_includes_group_scores PASSED [ 40%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_includes_sub_scores PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_calculates_volatility_with_sufficient_data PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_volatility_none_with_insufficient_data PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_passes_parameters_to_long_term_score PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_passes_parameters_to_short_term_score PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_passes_parameters_to_opportunity_score PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_passes_yahoo_symbol_to_opinion_score PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_diversification_score_with_portfolio_context PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_diversification_default_without_portfolio_context PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_diversification_default_without_geography PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_rounds_total_score_to_three_decimals PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_rounds_volatility_to_four_decimals PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScore::test_handles_zero_weight_sum PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScoreFromPrefetched::test_extracts_data_from_prefetched PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScoreFromPrefetched::test_passes_all_parameters_through PASSED [ 41%]
tests/unit/domain/scoring/test_security_scorer.py::TestCalculateStockScoreFromPrefetched::test_returns_same_result_as_direct_call PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestNormalizeSellWeights::test_returns_default_weights_when_none PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestNormalizeSellWeights::test_normalizes_custom_weights PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestNormalizeSellWeights::test_handles_zero_sum_weights PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestNormalizeSellWeights::test_fills_missing_weights_from_defaults PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateTotalSellScore::test_calculates_weighted_sum PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateTotalSellScore::test_all_zero_scores PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateTotalSellScore::test_all_max_scores PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_max_score_for_deep_drawdown PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_high_score_for_extended_deep_drawdown PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_medium_score_for_moderate_drawdown PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_low_score_for_short_drawdown PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_min_score_for_shallow_drawdown PASSED [ 41%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_minimal_for_no_drawdown PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateDrawdownScore::test_returns_neutral_on_exception PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateSellScore::test_returns_ineligible_when_sell_not_allowed PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateSellScore::test_returns_ineligible_for_big_loss PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateSellScore::test_returns_eligible_for_profitable_position PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateSellScore::test_uses_technical_data_for_instability PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestGetSellSettings::test_returns_settings_from_repo PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateAllSellScores::test_calculates_scores_for_all_positions PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateAllSellScores::test_handles_missing_fields PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateAllSellScores::test_uses_avg_price_when_current_price_missing PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateAllSellScores::test_uses_custom_weights PASSED [ 42%]
tests/unit/domain/scoring/test_sell.py::TestCalculateAllSellScores::test_uses_technical_data_map PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_consistent_grower_no_excess PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_windfall_spike_high_excess PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_zero_years_held_returns_full_gain PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_negative_years_held_returns_full_gain PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_invalid_cagr_returns_full_gain PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_negative_cagr_but_valid PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_underperforming_stock_negative_excess PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateExcessGain::test_fractional_years_held PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_high_excess_returns_score_1 PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_medium_excess_returns_mid_score PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_low_excess_returns_low_score PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_no_excess_returns_zero_score PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_insufficient_data_returns_zero PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_fetches_cagr_from_cache_when_not_provided PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_uses_10y_cagr_as_fallback PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestCalculateWindfallScore::test_uses_default_cagr_when_no_data PASSED [ 42%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_windfall_doubler_recommends_50_percent PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_consistent_doubler_recommends_30_percent PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_high_windfall_recommends_40_percent PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_medium_windfall_recommends_20_percent PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_low_excess_no_sell PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_performing_near_expectations PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestShouldTakeProfits::test_underperforming_stock PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_returns_complete_analysis PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_calculates_gain_correctly PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_handles_invalid_avg_price PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_calculates_years_held_from_date PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_uses_default_years_when_date_missing PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_handles_invalid_date_format PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestGetWindfallRecommendation::test_recommendation_includes_sell_info PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestWindfallThresholds::test_threshold_values_are_correct PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestWindfallThresholds::test_exactly_at_high_threshold PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestWindfallThresholds::test_exactly_at_medium_threshold PASSED [ 43%]
tests/unit/domain/scoring/test_windfall.py::TestWindfallThresholds::test_just_below_medium_threshold PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestIsOutsideRebalanceBand::test_returns_true_when_deviation_exceeds_explicit_band PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestIsOutsideRebalanceBand::test_returns_false_when_deviation_within_explicit_band PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestIsOutsideRebalanceBand::test_uses_high_priority_band_for_large_positions PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestIsOutsideRebalanceBand::test_uses_medium_band_for_medium_positions PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestIsOutsideRebalanceBand::test_uses_small_band_for_small_positions PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestIsOutsideRebalanceBand::test_uses_max_weight_as_proxy_when_position_size_not_provided PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestParseIndustries::test_parses_comma_separated_industries PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestParseIndustries::test_strips_whitespace PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestParseIndustries::test_returns_empty_list_for_none PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestParseIndustries::test_returns_empty_list_for_empty_string PASSED [ 43%]
tests/unit/domain/services/test_allocation_calculator.py::TestParseIndustries::test_handles_single_industry PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestParseIndustries::test_filters_empty_parts PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestCalculatePositionSize::test_calculates_size_with_volatility_weighting PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestCalculatePositionSize::test_uses_default_volatility_when_none PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestCalculatePositionSize::test_applies_min_size_constraint PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestCalculatePositionSize::test_adjusts_for_stock_score PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestGetMaxTrades::test_returns_zero_when_cash_below_min_trade_amount PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestGetMaxTrades::test_calculates_max_trades_from_cash PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestGetMaxTrades::test_respects_max_trades_per_cycle_setting PASSED [ 44%]
tests/unit/domain/services/test_allocation_calculator.py::TestGetMaxTrades::test_handles_exact_min_trade_amount PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceBasic::test_same_currency_returns_one PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceBasic::test_normalizes_currency_codes PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceCaching::test_uses_memory_cache PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceCaching::test_memory_cache_expires PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceCaching::test_uses_db_cache_when_memory_empty PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceCaching::test_db_cache_expires PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceConversion::test_convert_zero_amount PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceConversion::test_convert_uses_rate_correctly PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceConversion::test_convert_handles_invalid_rate PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceConversion::test_batch_convert_to_eur PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceFallback::test_fallback_rate_direct_lookup PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceFallback::test_fallback_rate_reverse_lookup PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceFallback::test_fallback_rate_via_eur PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceFallback::test_fallback_rate_unknown_currency PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceFallback::test_uses_fallback_when_api_fails PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceAPI::test_fetch_rate_from_api_success PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceAPI::test_fetch_rate_from_api_timeout PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceAPI::test_fetch_rate_from_api_error_status PASSED [ 44%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceAPI::test_fetch_rate_caches_all_rates PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceRefresh::test_refresh_rates_updates_cache PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceRefresh::test_refresh_rates_default_currencies PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceRefresh::test_refresh_rates_skips_eur PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceDBOperations::test_store_in_db_cache PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceDBOperations::test_store_in_db_cache_handles_error PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceDBOperations::test_get_from_db_cache_handles_error PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceTTL::test_default_ttl PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceTTL::test_custom_ttl PASSED [ 45%]
tests/unit/domain/services/test_exchange_rate_service.py::TestExchangeRateServiceTTL::test_ttl_affects_cache_expiry PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestParseIndustries::test_parses_single_industry PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestParseIndustries::test_parses_multiple_industries PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestParseIndustries::test_handles_leading_trailing_spaces PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestParseIndustries::test_handles_empty_string PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestParseIndustries::test_handles_none_input PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestParseIndustries::test_handles_string_with_only_spaces PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_calculates_priority_with_multiplier PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_rounds_combined_priority_to_4_decimal_places PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_preserves_optional_fields PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_handles_none_optional_fields PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_handles_zero_stock_score PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_handles_zero_multiplier PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriority::test_handles_maximum_values PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriorities::test_calculates_priorities_for_multiple_stocks PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriorities::test_sorts_by_combined_priority_descending PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriorities::test_handles_empty_input_list PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriorities::test_handles_single_input PASSED [ 45%]
tests/unit/domain/services/test_priority_calculator.py::TestCalculatePriorities::test_preserves_all_input_fields PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_returns_false_when_no_triggers PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_triggers_on_position_drift PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_triggers_on_cash_threshold_exceeded PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_no_trigger_when_cash_below_threshold FAILED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_handles_zero_portfolio_value PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_handles_zero_cash_balance PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_handles_missing_settings_repo FAILED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_handles_empty_positions_and_targets PASSED [ 46%]
tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_handles_positions_without_market_value PASSED [ 46%]
tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_get_settings_loads_from_repository FAILED [ 46%]
tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_get_settings_uses_defaults_when_empty FAILED [ 46%]
tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_get_settings_caches_result PASSED [ 46%]
tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_invalidate_cache PASSED [ 46%]
tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_update_setting_invalidates_cache PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestIsIsin::test_returns_true_for_valid_isin PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestIsIsin::test_returns_false_for_invalid_isin PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestIsIsin::test_is_case_insensitive PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestIsTradernetFormat::test_returns_true_for_tradernet_symbols PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestIsTradernetFormat::test_returns_false_for_non_tradernet_symbols PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestIsTradernetFormat::test_is_case_insensitive PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestDetectIdentifierType::test_detects_isin PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestDetectIdentifierType::test_detects_tradernet_format PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestDetectIdentifierType::test_detects_yahoo_format PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestTradernetToYahoo::test_strips_us_suffix PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestTradernetToYahoo::test_converts_greek_to_athens PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestTradernetToYahoo::test_passes_through_other_suffixes PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestTradernetToYahoo::test_is_case_insensitive PASSED [ 46%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_detect_type_delegates_to_function PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_isin_returns_directly PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_yahoo_returns_as_is PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_tradernet_with_cached_isin PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_tradernet_without_cached_isin_fetches_from_api PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_tradernet_falls_back_to_yahoo_conversion PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_and_cache_caches_isin PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_to_isin_returns_isin_directly PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_resolve_to_isin_resolves_tradernet_symbol PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_get_symbol_for_display_returns_symbol_for_isin PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_get_symbol_for_display_returns_input_if_not_found PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_get_symbol_for_display_returns_symbol_as_is PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_get_isin_for_symbol_returns_isin_from_repo PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_get_isin_for_symbol_returns_none_if_not_found PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_handles_tradernet_not_connected PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_handles_tradernet_api_error PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_handles_invalid_tradernet_response PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_strips_and_uppercases_identifier PASSED [ 47%]
tests/unit/domain/services/test_symbol_resolver.py::TestSymbolResolver::test_symbol_info_has_isin_property PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_portfolio_value PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_cash_balance PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_value_setting PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_recommendations PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_amounts_setting PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_returns_system_online_when_no_content PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_returns_ready_when_not_connected PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_exceptions_gracefully PASSED [ 47%]
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_none_snapshot PASSED [ 47%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateBuyQuantity::test_calculates_quantity_for_eur_stock PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateBuyQuantity::test_respects_min_lot_constraint PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateBuyQuantity::test_handles_currency_conversion PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateBuyQuantity::test_rounds_down_to_whole_shares PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateBuyQuantity::test_handles_fractional_target_that_rounds_to_zero PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateBuyQuantity::test_calculates_lots_correctly PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateSellQuantity::test_rounds_down_to_lot_boundary PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateSellQuantity::test_respects_min_lot_constraint PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateSellQuantity::test_caps_at_current_holdings PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateSellQuantity::test_caps_at_current_holdings_with_lots PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateSellQuantity::test_handles_zero_current_holdings PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestCalculateSellQuantity::test_handles_min_lot_of_one PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestRoundToLots::test_rounds_down_to_lot_boundary PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestRoundToLots::test_handles_min_lot_of_one PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestRoundToLots::test_handles_exact_lot_multiple PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestRoundToLots::test_handles_quantity_less_than_lot PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestEdgeCases::test_handles_zero_price PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestEdgeCases::test_handles_zero_target_value PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestEdgeCases::test_handles_negative_price PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestEdgeCases::test_handles_very_small_target_value PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestEdgeCases::test_handles_very_high_price PASSED [ 48%]
tests/unit/domain/services/test_trade_sizing_service.py::TestEdgeCases::test_handles_min_lot_greater_than_calculated_quantity PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestDomainError::test_domain_error_is_exception PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestDomainError::test_domain_error_can_have_message PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestDomainError::test_domain_error_can_be_raised PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestValidationError::test_validation_error_is_domain_error PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestValidationError::test_validation_error_stores_message PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestValidationError::test_validation_error_can_be_raised PASSED [ 48%]
tests/unit/domain/test_exceptions.py::TestValidationError::test_validation_error_inherits_from_domain_error PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_apply_buy_order PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_apply_sell_order PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_apply_multiple_orders FAILED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_apply_sell_order_removes_position_if_zero PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_skip_invalid_orders PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_case_insensitive_symbols PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGeneratePortfolioHash::test_generate_hash_with_positions PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGeneratePortfolioHash::test_generate_hash_with_stocks_universe PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGeneratePortfolioHash::test_generate_hash_with_cash_balances PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGeneratePortfolioHash::test_generate_hash_with_pending_orders PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGeneratePortfolioHash::test_generate_hash_excludes_zero_cash PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGeneratePortfolioHash::test_generate_hash_deterministic_ordering PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateSettingsHash::test_generate_hash_with_settings PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateSettingsHash::test_generate_hash_with_missing_settings PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateSettingsHash::test_generate_hash_changes_with_settings PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateAllocationsHash::test_generate_hash_with_allocations PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateAllocationsHash::test_generate_hash_empty_allocations PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateAllocationsHash::test_generate_hash_deterministic_ordering PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateAllocationsHash::test_generate_hash_changes_with_allocations PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateRecommendationCacheKey::test_generate_cache_key PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateRecommendationCacheKey::test_generate_cache_key_with_optional_parameters PASSED [ 49%]
tests/unit/domain/test_portfolio_hash.py::TestGenerateRecommendationCacheKey::test_generate_cache_key_changes_with_portfolio PASSED [ 49%]
tests/unit/domain/test_priority_calculator.py::TestPriorityCalculator::test_parse_industries PASSED [ 49%]
tests/unit/domain/test_priority_calculator.py::TestPriorityCalculator::test_calculate_priority_basic PASSED [ 49%]
tests/unit/domain/test_priority_calculator.py::TestPriorityCalculator::test_calculate_priority_with_multiplier PASSED [ 49%]
tests/unit/domain/test_priority_calculator.py::TestPriorityCalculator::test_calculate_priorities_sorts_by_priority PASSED [ 49%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_currency_enum_values PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_from_string_with_valid_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_from_string_case_insensitive PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_from_string_with_invalid_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_from_string_with_none PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_currency_str_representation PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_currency_equality PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_is_valid_with_valid_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_is_valid_with_invalid_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_currency.py::TestCurrency::test_default_returns_eur PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_create_money_with_amount_and_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_create_money_with_default_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_create_money_with_int_amount PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_raises_error_for_non_numeric_amount PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_add_money_same_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_add_money_different_currencies_raises_error PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_subtract_money_same_currency PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_subtract_money_different_currencies_raises_error PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_multiply_money_by_scalar PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_multiply_money_by_int_scalar PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_right_multiply_scalar_by_money PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_divide_money_by_scalar PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_divide_money_by_int_scalar PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_immutability PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_equality PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_negative_amount_allowed PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_zero_amount_allowed PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_divide_money_by_zero_raises_error PASSED [ 50%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_compare_money_same_currency PASSED [ 51%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_compare_money_different_currencies_raises_error PASSED [ 51%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_abs_money PASSED [ 51%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_round_money PASSED [ 51%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_round_money_to_zero_decimals PASSED [ 51%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_str_representation PASSED [ 51%]
tests/unit/domain/value_objects/test_money.py::TestMoney::test_money_repr_representation PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_create_price_with_amount_and_currency PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_create_price_with_default_currency PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_create_price_with_int_amount PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_raises_error_for_non_numeric_amount PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_raises_error_for_zero_amount PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_raises_error_for_negative_amount PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_multiply_price_by_quantity PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_multiply_price_by_int_quantity PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_right_multiply_quantity_by_price PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_multiply_price_by_zero_quantity PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_multiply_price_by_negative_quantity_raises_error PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_round_price PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_round_price_to_zero_decimals PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_from_money_with_positive_amount PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_from_money_with_zero_amount_raises_error PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_from_money_with_negative_amount_raises_error PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_immutability PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_equality PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_str_representation PASSED [ 51%]
tests/unit/domain/value_objects/test_price.py::TestPrice::test_price_repr_representation PASSED [ 51%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_equity_detection PASSED [ 51%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etf_detection PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_mutual_fund_detection PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_gold PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_silver PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_oil PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_aluminium PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_copper PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_platinum PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_palladium PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_from_natural_gas PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etc_detection_case_insensitive PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etf_overrides_etc_heuristic_when_quote_type_is_etf PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_etf_detection_from_name_with_etf PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_unknown_quote_type PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_none_quote_type PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_empty_product_name PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeFromYahooQuoteType::test_mutual_fund_without_etc_indicators PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeStringConversion::test_value_property PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeStringConversion::test_name_property PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeStringConversion::test_repr_conversion PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeEquality::test_equality PASSED [ 52%]
tests/unit/domain/value_objects/test_product_type.py::TestProductTypeEquality::test_identity PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_recommendation_status_enum_values PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_from_string_with_valid_status PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_from_string_case_insensitive PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_from_string_with_invalid_status PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_from_string_with_none PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_can_transition_to_from_pending PASSED [ 52%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_can_transition_to_from_executed PASSED [ 53%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_can_transition_to_from_dismissed PASSED [ 53%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_recommendation_status_str_representation PASSED [ 53%]
tests/unit/domain/value_objects/test_recommendation_status.py::TestRecommendationStatus::test_recommendation_status_equality PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_create_default_settings PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_create_custom_settings PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_validation_target_annual_return PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_validation_min_security_score PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_validation_optimizer_blend PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_validation_optimizer_target_return PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_validation_min_cash_reserve PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_from_dict PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_from_dict_with_missing_keys PASSED [ 53%]
tests/unit/domain/value_objects/test_settings.py::TestSettings::test_settings_to_dict PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_trade_side_enum_values PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_from_string_with_valid_side PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_from_string_case_insensitive PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_from_string_with_invalid_side PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_from_string_with_none PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_is_buy PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_is_sell PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_trade_side_str_representation PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_trade_side_equality PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_is_valid_with_valid_side PASSED [ 53%]
tests/unit/domain/value_objects/test_trade_side.py::TestTradeSide::test_is_valid_with_invalid_side PASSED [ 53%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_init_creates_empty_cache PASSED [ 53%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_set_stores_value FAILED [ 53%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_get_returns_stored_value PASSED [ 53%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_get_returns_none_for_missing_key PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_get_with_default_not_supported PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_invalidate_removes_key PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_invalidate_nonexistent_key_does_not_error PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_invalidate_prefix_removes_matching_keys PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_invalidate_prefix_with_no_matches PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_clear_removes_all_keys PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_overwrite_existing_key PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_store_various_data_types PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_invalidate_prefix_with_empty_string PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_multiple_caches_are_independent PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_ttl_expiration PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_custom_ttl PASSED [ 54%]
tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_expired_key_is_removed PASSED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_init_with_cache PASSED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_trade_caches FAILED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_recommendation_caches FAILED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_portfolio_caches PASSED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_all_trade_related FAILED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestGetCacheInvalidationService::test_get_cache_invalidation_service_with_default_cache FAILED [ 54%]
tests/unit/infrastructure/test_cache_invalidation.py::TestGetCacheInvalidationService::test_get_cache_invalidation_service_with_custom_cache PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_closed_state_success PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_opens_after_threshold PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_blocks_calls_when_open PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_half_open_transition PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_half_open_allows_one_request PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_half_open_failure_reopens PASSED [ 54%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_reset PASSED [ 55%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_registry PASSED [ 55%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_success_resets_failure_count PASSED [ 55%]
tests/unit/infrastructure/test_circuit_breaker.py::test_circuit_breaker_half_open_success_count PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetStartOfDayValue::test_returns_previous_day_value PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetStartOfDayValue::test_returns_today_fallback PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetStartOfDayValue::test_returns_none_when_no_snapshots PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetCurrentValue::test_returns_sum_of_positions PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetCurrentValue::test_returns_zero_when_no_positions PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetDailyPnL::test_calculates_positive_pnl PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetDailyPnL::test_calculates_negative_pnl PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetDailyPnL::test_returns_cached_value PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetDailyPnL::test_returns_none_when_no_start_value PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerCanBuy::test_allows_buy_in_normal_trading PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerCanBuy::test_allows_buy_during_moderate_drawdown PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerCanBuy::test_blocks_buy_during_severe_crash PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerCanSell::test_allows_sell_in_normal_trading PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerCanSell::test_blocks_sell_during_moderate_drawdown PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetTradingStatus::test_normal_status PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestDailyPnLTrackerGetTradingStatus::test_unknown_status PASSED [ 55%]
tests/unit/infrastructure/test_daily_pnl.py::TestGetDailyPnLTracker::test_returns_same_instance PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_execute_runs_query FAILED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_execute_with_parameters PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_fetchone_returns_single_row PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_fetchone_returns_none_when_no_results PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_fetchall_returns_all_rows PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_fetchall_returns_empty_list_when_no_results PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_commit_commits_transaction PASSED [ 55%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_transaction_context_manager PASSED [ 56%]
tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_transaction_rolls_back_on_exception PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseInit::test_init_sets_path PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseInit::test_init_readonly PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseInit::test_name_property PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseConnect::test_connect_creates_directory PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseConnect::test_connect_readonly_uses_uri PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseConnect::test_connect_configures_pragmas PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseConnect::test_connect_returns_same_connection PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseClose::test_close_closes_connection PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseClose::test_close_when_not_connected PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseTransaction::test_transaction_commits_on_success PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseTransaction::test_transaction_rollback_on_error PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_execute PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_executemany PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_executescript PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_commit PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_fetchone PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_fetchall PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_integrity_check PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_integrity_check_no_result PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseOperations::test_checkpoint PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManager::test_init_creates_databases PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerHistory::test_history_creates_database PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerHistory::test_history_caches_database PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerHistory::test_history_sanitizes_symbol PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerCloseAll::test_close_all_closes_core_databases PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerCloseAll::test_close_all_closes_history_databases PASSED [ 56%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerIntegrityCheck::test_integrity_check_all PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerIntegrityCheck::test_integrity_check_handles_errors PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerIntegrityCheck::test_integrity_check_includes_history PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerCheckpointAll::test_checkpoint_all PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerCheckpointAll::test_checkpoint_all_includes_history PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerGetHistorySymbols::test_get_history_symbols_no_directory PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestDatabaseManagerGetHistorySymbols::test_get_history_symbols_with_files PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestGetDbManager::test_raises_when_not_initialized PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestInitDatabases::test_initializes_manager PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestShutdownDatabases::test_shutdown_closes_and_clears_manager PASSED [ 57%]
tests/unit/infrastructure/test_database_manager.py::TestShutdownDatabases::test_shutdown_when_not_initialized PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestPriority::test_priority_ordering PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestPriority::test_priority_values PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueuedOperation::test_creates_operation_with_defaults PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueuedOperation::test_operations_order_by_priority PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueuedOperation::test_operations_order_by_timestamp_when_same_priority PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueInit::test_init_with_defaults PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueInit::test_init_with_custom_values PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueStartStop::test_start_sets_running PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueStartStop::test_start_idempotent PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueStartStop::test_stop_clears_running PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueStartStop::test_stop_idempotent PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueEnqueue::test_enqueue_executes_function PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueEnqueue::test_enqueue_returns_function_result PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueEnqueue::test_enqueue_propagates_exception PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueEnqueueNowait::test_enqueue_nowait_returns_future PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueRetry::test_retries_on_failure PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueRetry::test_fails_after_max_retries PASSED [ 57%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueuePriority::test_processes_higher_priority_first PASSED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueMetrics::test_queue_size PASSED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueMetrics::test_is_running PASSED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestQueryQueueMetrics::test_get_metrics PASSED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestGetQueryQueue::test_raises_when_not_initialized FAILED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestInitQueryQueue::test_initializes_and_starts_queue FAILED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestShutdownQueryQueue::test_stops_and_clears_queue FAILED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestShutdownQueryQueue::test_handles_none_queue FAILED [ 58%]
tests/unit/infrastructure/test_database_queue.py::TestEnqueueConvenienceFunction::test_enqueue_uses_global_queue FAILED [ 58%]
tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_set_text_emits_event FAILED [ 58%]
tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_get_current_text_returns_latest PASSED [ 58%]
tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_set_led3_emits_event FAILED [ 58%]
tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_set_led4_emits_event FAILED [ 58%]
tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_get_led3_returns_value PASSED [ 58%]
tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_get_led4_returns_value PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_emit_publishes_event PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_subscribe_adds_handler PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_multiple_handlers_for_same_event PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_handler_receives_event_and_kwargs PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_different_events_are_separate PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_handler_called_for_each_emit PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_emit_without_subscribers_does_not_error PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_subscribe_multiple_times_same_handler PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_emit_with_no_kwargs PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_unsubscribe_removes_handler PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_unsubscribe_nonexistent_handler_does_not_error PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_clear_all_listeners_removes_all_handlers PASSED [ 58%]
tests/unit/infrastructure/test_events.py::TestEventSystem::test_listener_exceptions_are_caught PASSED [ 58%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_acquires_and_releases_lock PASSED [ 59%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_prevents_concurrent_execution FAILED [ 59%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_handles_timeout_gracefully FAILED [ 59%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_allows_sequential_execution PASSED [ 59%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_uses_different_locks_for_different_names PASSED [ 59%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_handles_exceptions_and_releases_lock PASSED [ 59%]
tests/unit/infrastructure/test_locking.py::TestFileLock::test_timeout_error_includes_lock_name FAILED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationID::test_get_correlation_id_returns_none_initially PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationID::test_set_correlation_id_generates_uuid_when_none PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationID::test_set_correlation_id_uses_provided_value PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationID::test_clear_correlation_id_removes_id PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationID::test_multiple_sets_overwrite_previous PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationIDFilter::test_filter_adds_correlation_id_to_record PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestCorrelationIDFilter::test_filter_uses_none_when_no_correlation_id PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestSetupCorrelationLogging::test_setup_adds_filter_to_root_logger PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestSetupCorrelationLogging::test_setup_idempotent PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestGetLogger::test_get_logger_returns_logger PASSED [ 59%]
tests/unit/infrastructure/test_logging_context.py::TestGetLogger::test_get_logger_sets_up_correlation_logging PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestGetCalendar::test_returns_calendar_for_exchange PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestGetCalendar::test_returns_calendar_for_nasdaq PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestGetCalendar::test_returns_default_for_unknown PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestGetCalendar::test_caches_calendars PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_market_closed_on_weekend PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_market_closed_on_holiday PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_us_market_open_during_trading_hours PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_us_market_closed_before_open PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_us_market_closed_after_close PASSED [ 59%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_eu_market_open_during_trading_hours PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestIsMarketOpen::test_asia_market_open_during_trading_hours PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGetOpenMarkets::test_returns_empty_list_on_weekend PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGetOpenMarkets::test_returns_open_markets PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGetMarketStatus::test_returns_status_for_all_markets PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGetMarketStatus::test_includes_next_event_time PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestFilterStocksByOpenMarkets::test_filters_stocks_to_open_markets_only PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestFilterStocksByOpenMarkets::test_returns_all_stocks_when_all_markets_open PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestRequiresStrictMarketHours::test_identifies_strict_market_hours_exchanges PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestRequiresStrictMarketHours::test_identifies_flexible_hours_exchanges PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestShouldCheckMarketHours::test_sell_orders_always_require_check PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestShouldCheckMarketHours::test_buy_orders_flexible_hours_markets PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestShouldCheckMarketHours::test_buy_orders_strict_hours_markets PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestShouldCheckMarketHours::test_unknown_side_defaults_to_check PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGroupStocksByExchange::test_groups_stocks_correctly PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGroupStocksByExchange::test_handles_empty_list PASSED [ 60%]
tests/unit/infrastructure/test_market_hours.py::TestGroupStocksByExchange::test_handles_unknown_exchange PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_allows_requests_within_limit PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_blocks_requests_exceeding_limit PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_trade_endpoints_have_stricter_limits PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_skips_rate_limiting_for_internal_endpoints PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_skips_rate_limiting_for_static_files PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_rate_limit_resets_after_window PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_different_ips_have_separate_limits PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_cleanup_old_entries PASSED [ 60%]
tests/unit/infrastructure/test_rate_limit.py::TestRateLimitMiddleware::test_handles_request_without_client PASSED [ 60%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetRecommendations::test_returns_cached_data PASSED [ 60%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetRecommendations::test_returns_none_when_not_cached PASSED [ 60%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetRecommendations::test_returns_none_on_invalid_json PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheSetRecommendations::test_stores_data PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheSetRecommendations::test_uses_custom_ttl PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetAnalytics::test_returns_cached_analytics PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetAnalytics::test_returns_none_when_not_cached PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheSetAnalytics::test_stores_analytics PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheInvalidatePortfolioHash::test_deletes_cache_entries PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheInvalidateAllRecommendations::test_deletes_all_recommendations PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheCleanupExpired::test_cleans_expired_entries PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetCacheStats::test_returns_stats PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestRecommendationCacheGetCacheStats::test_handles_empty_cache PASSED [ 61%]
tests/unit/infrastructure/test_recommendation_cache.py::TestGetRecommendationCache::test_returns_same_instance PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_success_on_first_attempt PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_success_after_failures PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_exhausted_after_max_attempts PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_exponential_backoff PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_with_jitter PASSED   [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_max_delay PASSED     [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_decorator PASSED     [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_only_retries_specified_exceptions PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_with_stats PASSED    [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_with_stats_failure PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_handler_registry PASSED [ 61%]
tests/unit/infrastructure/test_retry.py::test_retry_reset_stats PASSED   [ 61%]
tests/unit/infrastructure/test_service_locator.py::test_service_locator_initialization PASSED [ 61%]
tests/unit/infrastructure/test_service_locator.py::test_service_locator_env_override PASSED [ 61%]
tests/unit/infrastructure/test_service_locator.py::test_get_service_location_local PASSED [ 61%]
tests/unit/infrastructure/test_service_locator.py::test_get_service_location_remote PASSED [ 61%]
tests/unit/infrastructure/test_service_locator.py::test_get_service_location_not_found PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_get_service_location_device_not_found PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_load_tls_config_disabled PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_load_tls_config_enabled PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_load_tls_config_mtls PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_resolve_cert_path_relative PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_resolve_cert_path_absolute PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_is_service_local PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_get_all_local_services PASSED [ 62%]
tests/unit/infrastructure/test_service_locator.py::test_singleton_pattern PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetAnalystData::test_returns_analyst_data PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetAnalystData::test_calculates_upside_percentage PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetAnalystData::test_handles_missing_data PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetAnalystData::test_uses_yahoo_symbol_override PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetAnalystData::test_returns_none_on_exception PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetAnalystData::test_uses_regular_market_price_as_fallback PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetFundamentalData::test_returns_fundamental_data PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetFundamentalData::test_returns_none_on_exception PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetFundamentalData::test_uses_yahoo_symbol_override PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetHistoricalPrices::test_returns_historical_prices PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetHistoricalPrices::test_returns_empty_list_on_exception PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetHistoricalPrices::test_uses_custom_period PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetCurrentPrice::test_returns_current_price PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetCurrentPrice::test_uses_regular_market_price_fallback PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetCurrentPrice::test_retries_on_invalid_price PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetCurrentPrice::test_returns_none_after_max_retries PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetCurrentPrice::test_retries_on_exception PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_technology_industry PASSED [ 62%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_healthcare_industry PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_finance_industry PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_consumer_industry PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_industrial_industry PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_energy_industry PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_falls_back_to_sector PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_original_if_no_match PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetStockIndustry::test_returns_none_on_exception PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetBatchQuotes::test_returns_batch_quotes_single_symbol PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetBatchQuotes::test_returns_batch_quotes_multiple_symbols PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetBatchQuotes::test_handles_empty_data PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetBatchQuotes::test_handles_exception PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestGetBatchQuotes::test_uses_yahoo_symbol_override PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestLedApiCall::test_emits_events PASSED [ 63%]
tests/unit/infrastructure/test_yahoo_data_fetchers.py::TestLedApiCall::test_emits_end_event_on_exception PASSED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_runs_script_successfully FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_missing_script FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_script_failure FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_logs_script_output_on_success FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_logs_error_on_script_failure FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_exception_during_execution FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_empty_stdout_on_success FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_empty_stderr_on_failure FAILED [ 63%]
tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_uses_correct_script_path FAILED [ 63%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_skips_when_not_connected FAILED [ 63%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_handles_empty_transactions FAILED [ 63%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_syncs_new_transactions FAILED [ 63%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_skips_existing_transactions FAILED [ 64%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_handles_exception FAILED [ 64%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_uses_amount_fallback_for_eur FAILED [ 64%]
tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlows::test_uses_file_lock PASSED [ 64%]
tests/unit/jobs/test_cash_flow_sync.py::TestDividendRecordCreation::test_creates_dividend_record_from_dividend_cash_flow FAILED [ 64%]
tests/unit/jobs/test_cash_flow_sync.py::TestDividendRecordCreation::test_links_dividend_record_to_cash_flow_id FAILED [ 64%]
tests/unit/jobs/test_cash_flow_sync.py::TestDividendRecordCreation::test_skips_existing_dividend_records FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestExtractQuotesList::test_extracts_from_list PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestExtractQuotesList::test_extracts_from_dict_with_result PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestExtractQuotesList::test_extracts_from_dict_with_q PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestExtractQuotesList::test_returns_empty_for_empty_dict PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestExtractQuotesList::test_returns_empty_for_other_types PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestCalculateCashBalanceEur::test_calculates_eur_only PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestCalculateCashBalanceEur::test_converts_usd_to_eur PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestCalculateCashBalanceEur::test_handles_multiple_currencies PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestCalculateCashBalanceEur::test_skips_zero_or_negative_amounts PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestDetermineCountry::test_returns_country_from_db PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestDetermineCountry::test_infers_country_from_suffix_legacy PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestDetermineCountry::test_returns_none_for_unknown PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPortfolioInternal::test_skips_when_not_connected FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPortfolioInternal::test_syncs_positions_successfully FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPricesInternal::test_skips_when_no_stocks FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPricesInternal::test_syncs_prices_from_yahoo FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPricesInternal::test_handles_price_sync_error FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncStockCurrencies::test_skips_when_not_connected FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncStockCurrencies::test_skips_when_no_stocks FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncStockCurrencies::test_syncs_currencies_from_tradernet FAILED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPortfolio::test_uses_file_lock PASSED [ 64%]
tests/unit/jobs/test_daily_sync.py::TestSyncPrices::test_uses_file_lock PASSED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestDividendGrouping::test_groups_multiple_dividends_by_symbol FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestDividendGrouping::test_sums_amounts_correctly_when_grouping FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestReinvestmentExecution::test_executes_trade_when_grouped_total_exceeds_min_trade_size FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestReinvestmentExecution::test_skips_trade_when_grouped_total_below_min_trade_size FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestReinvestmentExecution::test_exactly_at_min_trade_size_executes FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestDividendMarking::test_marks_all_dividend_records_reinvested_after_trade FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestPendingBonus::test_sets_pending_bonus_for_small_ungrouped_dividends FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_zero_dividends_handles_gracefully FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_api_failure_does_not_crash_job FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_invalid_price_skips_symbol_continues_others FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_trade_execution_failure_marks_dividends_unreinvested FAILED [ 65%]
tests/unit/jobs/test_dividend_reinvestment.py::TestStateVerification::test_verify_no_duplicate_reinvestment FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_returns_false_when_no_negative_balances FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_triggers_rebalancing_with_negative_balance FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_triggers_rebalancing_with_currency_below_minimum FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_dismisses_stale_emergency_recommendations FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_tradernet_not_connected FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_tradernet_connection_failure FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_errors_gracefully FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_uses_file_lock_to_prevent_concurrent_execution FAILED [ 65%]
tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_no_trading_currencies FAILED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestWaitForPlanningCompletion::test_waits_until_all_sequences_evaluated FAILED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestWaitForPlanningCompletion::test_generates_sequences_if_not_exist FAILED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestWaitForPlanningCompletion::test_timeout_after_max_iterations FAILED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestGetOptimalRecommendation::test_returns_recommendation_from_best_result FAILED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestGetOptimalRecommendation::test_returns_none_if_no_best_result FAILED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestCanExecuteTrade::test_allows_trade_when_market_hours_not_required PASSED [ 65%]
tests/unit/jobs/test_event_based_trading.py::TestCanExecuteTrade::test_allows_trade_when_market_open PASSED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestCanExecuteTrade::test_blocks_trade_when_market_closed PASSED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestCanExecuteTrade::test_allows_trade_when_stock_not_found PASSED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestMonitorPortfolioForChanges::test_detects_hash_change_in_phase_1 FAILED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestMonitorPortfolioForChanges::test_detects_hash_change_in_phase_2 FAILED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestMonitorPortfolioForChanges::test_returns_false_when_no_hash_change PASSED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestEventBasedTradingLoop::test_loop_continues_when_no_recommendation PASSED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestEventBasedTradingLoop::test_loop_skips_trade_when_conditions_not_met PASSED [ 66%]
tests/unit/jobs/test_event_based_trading.py::TestEventBasedTradingLoop::test_loop_executes_trade_when_all_conditions_met PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckDatabaseIntegrity::test_returns_ok_for_healthy_db PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckDatabaseIntegrity::test_returns_error_for_corrupted_db PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckDatabaseIntegrity::test_returns_exception_message_on_error PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckCoreDatabases::test_checks_all_core_databases PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckCoreDatabases::test_reports_corrupted_database PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckHistoryDatabases::test_checks_history_databases PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckHistoryDatabases::test_skips_when_no_history_dir PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRunHealthCheckInternal::test_completes_successfully_when_healthy PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRunHealthCheckInternal::test_reports_issues_when_found PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestReportIssues::test_logs_recovered_issues PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestReportIssues::test_logs_critical_issues PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestGetDatabaseStats::test_returns_database_statistics PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRunHealthCheck::test_calls_internal_function PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckWalStatus::test_checks_wal_files PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestCheckWalStatus::test_handles_missing_wal PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRebuildCacheDb::test_rebuilds_cache_database PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRebuildCacheDb::test_handles_rebuild_failure PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRebuildSymbolHistory::test_rebuilds_history_database PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestRebuildSymbolHistory::test_handles_history_rebuild_failure PASSED [ 66%]
tests/unit/jobs/test_health_check.py::TestHistoryDatabasesWithIssues::test_reports_and_rebuilds_corrupted_history PASSED [ 67%]
tests/unit/jobs/test_health_check.py::TestCoreDatabasesWithCacheRebuild::test_rebuilds_corrupted_cache PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncHistoricalData::test_uses_file_lock PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncHistoricalDataInternal::test_emits_sync_events FAILED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncHistoricalDataInternal::test_handles_sync_error FAILED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncStockPriceHistory::test_skips_when_no_active_stocks PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncStockPriceHistory::test_processes_active_stocks PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncStockPriceHistory::test_fetches_prices_when_data_outdated PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestSyncStockPriceHistory::test_handles_stock_sync_error PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestFetchAndStorePrices::test_uses_1y_period_when_monthly_exists PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestFetchAndStorePrices::test_uses_10y_period_for_initial_seed PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestFetchAndStorePrices::test_handles_no_data_from_yahoo PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestFetchAndStorePrices::test_stores_ohlc_data PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestFetchAndStorePrices::test_raises_on_fetch_error PASSED [ 67%]
tests/unit/jobs/test_historical_data_sync.py::TestAggregateToMonthly::test_executes_aggregation_query PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestBackupDatabase::test_backs_up_database PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCreateBackupInternal::test_creates_backup_directory FAILED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCreateBackupInternal::test_handles_backup_error FAILED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCheckpointWalInternal::test_checkpoints_all_databases PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCheckpointWalInternal::test_handles_checkpoint_error PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestIntegrityCheckInternal::test_passes_when_all_ok FAILED [ 67%]
tests/unit/jobs/test_maintenance.py::TestIntegrityCheckInternal::test_reports_failure FAILED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCleanupOldDailyPricesInternal::test_cleans_old_prices PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCleanupExpiredCachesInternal::test_cleans_caches PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCleanupExpiredCachesInternal::test_handles_cleanup_error_silently PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCleanupOldSnapshotsInternal::test_cleans_old_snapshots PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCleanupOldSnapshotsInternal::test_skips_when_no_old_snapshots PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCreateBackup::test_calls_internal_function PASSED [ 67%]
tests/unit/jobs/test_maintenance.py::TestCleanupOldBackups::test_removes_old_backup_files PASSED [ 68%]
tests/unit/jobs/test_maintenance.py::TestCheckpointWal::test_calls_internal_function PASSED [ 68%]
tests/unit/jobs/test_maintenance.py::TestIntegrityCheck::test_calls_internal_function PASSED [ 68%]
tests/unit/jobs/test_maintenance.py::TestCleanupExpiredCaches::test_calls_internal_function PASSED [ 68%]
tests/unit/jobs/test_maintenance.py::TestRunDailyMaintenance::test_runs_all_daily_tasks PASSED [ 68%]
tests/unit/jobs/test_maintenance.py::TestRunWeeklyMaintenance::test_runs_weekly_tasks PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateTechnicalIndicators::test_counts_all_calculated_metrics PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateTechnicalIndicators::test_handles_none_values_gracefully PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateCagrMetrics::test_returns_zero_for_insufficient_data PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateCagrMetrics::test_calculates_5y_cagr PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateMomentumMetrics::test_returns_zero_for_short_data PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateMomentumMetrics::test_calculates_30d_momentum PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateMomentumMetrics::test_calculates_90d_momentum_if_enough_data PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateDistanceMetrics::test_calculates_distance_from_52w_high PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateDistanceMetrics::test_calculates_distance_from_ema PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateDistanceMetrics::test_calculates_both_metrics PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateBollingerPosition::test_returns_zero_for_no_bands PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateBollingerPosition::test_calculates_position_in_band PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateBollingerPosition::test_clamps_position_to_0_1 PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateAllMetricsForSymbol::test_returns_zero_for_insufficient_data PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateAllMetricsForSymbol::test_handles_exceptions_gracefully PASSED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateMetricsForAllStocks::test_processes_all_active_stocks FAILED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateMetricsForAllStocks::test_counts_errors FAILED [ 68%]
tests/unit/jobs/test_metrics_calculation.py::TestCalculateMetricsForAllStocks::test_returns_empty_stats_for_no_stocks FAILED [ 68%]
tests/unit/jobs/test_planner_batch.py::TestTriggerNextBatchViaApi::test_triggers_api_endpoint FAILED [ 68%]
tests/unit/jobs/test_planner_batch.py::TestTriggerNextBatchViaApi::test_handles_api_failure_gracefully FAILED [ 68%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_generates_portfolio_hash_when_not_provided FAILED [ 68%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_skips_scheduled_job_when_api_batches_active FAILED [ 69%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_uses_small_batch_size_in_api_driven_mode FAILED [ 69%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_uses_large_batch_size_in_scheduled_mode FAILED [ 69%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_self_triggers_next_batch_in_api_driven_mode FAILED [ 69%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_stops_self_triggering_at_max_depth FAILED [ 69%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_emits_planner_batch_complete_event FAILED [ 69%]
tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_handles_errors_gracefully FAILED [ 69%]
tests/unit/jobs/test_scheduler.py::TestGetJobSettings::test_returns_default_settings PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestGetJobSettings::test_returns_custom_settings PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestGetJobSettings::test_converts_floats_to_ints PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_tracks_job_failures PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_accumulates_multiple_failures PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_prunes_old_failures_outside_window PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_logs_warning_before_threshold PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_logs_error_at_threshold PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_clears_failures_on_success PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestJobListener::test_does_not_clear_other_job_failures PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_creates_scheduler_instance PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_adds_event_listener PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_schedules_sync_cycle_job PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_schedules_stocks_data_sync_job FAILED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_schedules_daily_maintenance_job PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_schedules_weekly_maintenance_job PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_logs_initialization_info FAILED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_replaces_existing_jobs FAILED [ 69%]
tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_handles_maintenance_hour_overflow PASSED [ 69%]
tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_reschedules_sync_cycle_with_new_interval FAILED [ 69%]
tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_reschedules_maintenance_jobs FAILED [ 69%]
tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_logs_reschedule_info FAILED [ 70%]
tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_warns_when_scheduler_not_initialized PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestStartScheduler::test_starts_scheduler_when_not_running PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestStartScheduler::test_does_not_start_when_already_running PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestStartScheduler::test_does_nothing_when_scheduler_is_none PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestStopScheduler::test_stops_scheduler_when_running PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestStopScheduler::test_does_not_stop_when_not_running PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestStopScheduler::test_does_nothing_when_scheduler_is_none PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetScheduler::test_returns_scheduler_instance PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetScheduler::test_returns_none_when_not_initialized PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_returns_empty_dict_when_scheduler_not_initialized PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_returns_status_for_all_jobs PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_includes_failure_count PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_marks_job_unhealthy_when_threshold_reached PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_marks_job_healthy_when_below_threshold PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_includes_next_run_time PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestGetJobHealthStatus::test_handles_none_next_run_time PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestEdgeCases::test_init_scheduler_with_zero_interval PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestEdgeCases::test_reschedule_all_jobs_multiple_times FAILED [ 70%]
tests/unit/jobs/test_scheduler.py::TestEdgeCases::test_job_listener_with_no_exception_attribute PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestEdgeCases::test_multiple_concurrent_failures_same_job PASSED [ 70%]
tests/unit/jobs/test_scheduler.py::TestEdgeCases::test_init_scheduler_sets_global_reference PASSED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestRefreshAllScores::test_uses_file_lock FAILED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_handles_no_active_stocks FAILED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_emits_events FAILED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_skips_stocks_with_insufficient_data FAILED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_handles_scoring_errors_gracefully FAILED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestBuildPortfolioContext::test_builds_context_with_positions FAILED [ 70%]
tests/unit/jobs/test_score_refresh.py::TestBuildPortfolioContext::test_builds_context_with_allocation_targets FAILED [ 71%]
tests/unit/jobs/test_score_refresh.py::TestGetDailyPrices::test_returns_local_data_if_sufficient FAILED [ 71%]
tests/unit/jobs/test_score_refresh.py::TestGetDailyPrices::test_fetches_from_yahoo_if_insufficient FAILED [ 71%]
tests/unit/jobs/test_score_refresh.py::TestGetMonthlyPrices::test_returns_local_data_if_sufficient FAILED [ 71%]
tests/unit/jobs/test_score_refresh.py::TestGetMonthlyPrices::test_aggregates_from_yahoo_if_insufficient FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestStocksDataSync::test_processes_only_stale_stocks FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestStocksDataSync::test_processes_stocks_sequentially FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestStocksDataSync::test_skips_all_when_all_stocks_fresh FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestProcessSingleStock::test_runs_all_steps_for_stock FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestProcessSingleStock::test_updates_last_synced_on_success FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestProcessSingleStock::test_does_not_update_last_synced_on_error FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestDisplayUpdates::test_shows_updating_message FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestDisplayUpdates::test_clears_processing_after_completion FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestForceRefresh::test_force_refresh_bypasses_last_synced FAILED [ 71%]
tests/unit/jobs/test_securities_data_sync.py::TestForceRefresh::test_force_refresh_returns_error_on_failure FAILED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestSyncCycle::test_runs_all_steps_in_order FAILED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestSyncCycle::test_skips_trade_execution_when_halted FAILED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepSyncPrices::test_only_fetches_prices_for_open_markets FAILED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepSyncPrices::test_skips_all_when_no_markets_open FAILED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepExecuteTrade::test_skips_buy_order_when_strict_market_closed SKIPPED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepExecuteTrade::test_allows_buy_order_when_flexible_market_closed SKIPPED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepExecuteTrade::test_skips_sell_order_when_market_closed SKIPPED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepExecuteTrade::test_executes_trade_when_market_open SKIPPED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepGetRecommendation::test_considers_all_markets FAILED [ 71%]
tests/unit/jobs/test_sync_cycle.py::TestStepUpdateDisplay::test_updates_ticker_text FAILED [ 71%]
tests/unit/jobs/test_sync_trades.py::TestGetExistingOrderIds::test_returns_set_of_order_ids PASSED [ 71%]
tests/unit/jobs/test_sync_trades.py::TestGetExistingOrderIds::test_returns_empty_set_when_no_orders PASSED [ 71%]
tests/unit/jobs/test_sync_trades.py::TestGetValidSymbols::test_returns_set_of_symbols PASSED [ 71%]
tests/unit/jobs/test_sync_trades.py::TestValidateTrade::test_rejects_missing_order_id PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestValidateTrade::test_rejects_duplicate_order_id PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestValidateTrade::test_rejects_invalid_symbol PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestValidateTrade::test_rejects_invalid_side PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestValidateTrade::test_accepts_valid_buy_trade PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestValidateTrade::test_accepts_valid_sell_trade PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestInsertTrade::test_inserts_trade_successfully PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestInsertTrade::test_returns_false_on_error PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestInsertTrade::test_uses_current_time_if_no_executed_at PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestSyncTrades::test_uses_file_lock PASSED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_skips_when_not_connected FAILED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_handles_no_trades_returned FAILED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_inserts_valid_trades FAILED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_handles_errors_gracefully FAILED [ 72%]
tests/unit/jobs/test_sync_trades.py::TestClearAndResyncTrades::test_clears_trades_table PASSED [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_name_property PASSED [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_default_params PASSED [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_with_empty_context PASSED [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_security_without_position ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_security_when_buy_not_allowed ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_that_is_up ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_down_too_much ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_low_quality_security ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_creates_opportunity_for_quality_dip ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_priority_based_on_quality_and_drop ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_respects_priority_weight_param ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_respects_security_priority_multiplier ERROR [ 72%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_uses_default_quality_when_scores_not_provided ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_with_zero_current_price ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_with_zero_avg_price ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_respects_base_trade_amount_param ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_repr PASSED [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_name_property PASSED [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_default_params PASSED [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_with_empty_context PASSED [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_without_security PASSED [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_when_sell_not_allowed ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_with_zero_value ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_creates_opportunity_for_windfall_position ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_without_windfall ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_respects_priority_weight_param ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_respects_security_priority_multiplier ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_handles_eur_currency_without_exchange_service ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_handles_missing_current_price ERROR [ 73%]
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_repr PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_initialization PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_from_config PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_instantiate_modules_without_config PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_instantiate_calculators PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_instantiate_patterns PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_get_methods PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_get_params PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_from_config_file PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_create_planner_from_config_convenience PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_with_default_config PASSED [ 73%]
tests/unit/planning/domain/config/test_factory.py::test_factory_with_conservative_config PASSED [ 74%]
tests/unit/planning/domain/config/test_factory.py::test_factory_with_aggressive_config PASSED [ 74%]
tests/unit/planning/domain/config/test_factory.py::test_factory_module_instances_are_reused PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_module_config_defaults PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_module_config_with_params PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_planner_configuration_defaults PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_planner_configuration_custom_values PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_enabled_calculators_all_enabled PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_enabled_calculators_selective PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_enabled_patterns_all_enabled PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_enabled_patterns_selective PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_enabled_generators FAILED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_enabled_filters FAILED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_calculator_params PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_pattern_params PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_generator_params PASSED [ 74%]
tests/unit/planning/domain/config/test_models.py::test_get_filter_params PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_string_minimal PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_string_with_global_settings PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_string_with_calculator_config PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_string_with_pattern_config PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_string_with_generator_config PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_string_with_filter_config PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_file PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_from_nonexistent_file PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_invalid_toml PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_empty_config PASSED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_conservative_example FAILED [ 74%]
tests/unit/planning/domain/config/test_parser.py::test_load_aggressive_example PASSED [ 75%]
tests/unit/planning/domain/config/test_parser.py::test_load_default_example PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestValidateToml::test_valid_toml PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestValidateToml::test_invalid_toml_syntax PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestValidateToml::test_invalid_toml_structure FAILED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestCreate::test_create_success PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestCreate::test_create_invalid_toml PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestCreate::test_create_template_no_bucket PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestUpdate::test_update_success PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestUpdate::test_update_invalid_toml PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestUpdate::test_update_not_found PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestUpdate::test_update_name_only FAILED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestDelete::test_delete_success PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestDelete::test_delete_not_found PASSED [ 75%]
tests/unit/planning/test_planner_config_service.py::TestGetHistory::test_get_history PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_get_all_returns_dict PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_get_all_empty PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_get_by_type_country_group PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_get_by_type_industry_group PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_get_country_group_targets PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_get_industry_group_targets PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_upsert_target PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_delete_target PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_init_with_raw_connection PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_init_with_database_instance PASSED [ 75%]
tests/unit/repositories/test_allocation.py::TestAllocationRepository::test_init_without_db PASSED [ 75%]
tests/unit/repositories/test_base.py::TestSafeGet::test_gets_value_from_dict PASSED [ 75%]
tests/unit/repositories/test_base.py::TestSafeGet::test_returns_default_when_key_missing PASSED [ 75%]
tests/unit/repositories/test_base.py::TestSafeGet::test_handles_row_with_keys_method PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGet::test_handles_row_without_keys_but_with_getitem PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGet::test_returns_default_for_non_subscriptable PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGet::test_handles_keyerror PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGet::test_handles_indexerror PASSED [ 76%]
tests/unit/repositories/test_base.py::TestTransactionContext::test_uses_transaction_method_if_available PASSED [ 76%]
tests/unit/repositories/test_base.py::TestTransactionContext::test_uses_raw_connection_when_no_transaction_method PASSED [ 76%]
tests/unit/repositories/test_base.py::TestTransactionContext::test_rollback_on_exception_for_raw_connection PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetDatetime::test_returns_none_for_missing_key PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetDatetime::test_returns_datetime_directly PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetDatetime::test_parses_iso_format_string PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetDatetime::test_returns_none_for_invalid_string PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetDatetime::test_returns_none_for_empty_value PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetDatetime::test_returns_none_for_none_value PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetBool::test_returns_bool_directly PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetBool::test_converts_int_to_bool PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetBool::test_converts_string_to_bool PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetBool::test_returns_default_for_missing_key PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetBool::test_handles_none_value PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetFloat::test_returns_float_directly PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetFloat::test_converts_int_to_float PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetFloat::test_converts_string_to_float PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetFloat::test_returns_default_for_invalid_string PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetFloat::test_returns_default_for_missing_key PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetFloat::test_returns_default_for_none_value PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_returns_int_directly PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_converts_float_to_int PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_converts_string_to_int PASSED [ 76%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_converts_float_string_to_int PASSED [ 77%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_returns_default_for_invalid_string PASSED [ 77%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_returns_default_for_missing_key PASSED [ 77%]
tests/unit/repositories/test_base.py::TestSafeGetInt::test_returns_default_for_none_value PASSED [ 77%]
tests/unit/repositories/test_base.py::TestDatabaseAdapter::test_fetchone_executes_and_returns PASSED [ 77%]
tests/unit/repositories/test_base.py::TestDatabaseAdapter::test_fetchall_executes_and_returns PASSED [ 77%]
tests/unit/repositories/test_base.py::TestDatabaseAdapter::test_execute_runs_sql PASSED [ 77%]
tests/unit/repositories/test_base.py::TestDatabaseAdapter::test_commit_commits_connection PASSED [ 77%]
tests/unit/repositories/test_base.py::TestDatabaseAdapter::test_transaction_yields_connection_and_commits PASSED [ 77%]
tests/unit/repositories/test_base.py::TestDatabaseAdapter::test_transaction_rollback_on_exception PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_metric_returns_value_when_found PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_metric_returns_none_when_not_found PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_metric_uppercases_symbol PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_set_metric_stores_value PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_set_metric_with_ttl_override PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_set_metric_with_source PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_metrics_batch PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_metrics_returns_none_for_missing PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_set_metrics_batch PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_set_metrics_with_ttl_override PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_all_metrics PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_all_metrics_empty PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_delete_expired PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_delete_expired_zero PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_ttl_for_metric_known PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_get_ttl_for_metric_default PASSED [ 77%]
tests/unit/repositories/test_calculations.py::TestCalculationsRepository::test_private_get_ttl_for_metric PASSED [ 77%]
tests/unit/repositories/test_planner_repository.py::TestAreAllSequencesEvaluated::test_returns_true_when_all_sequences_evaluated PASSED [ 78%]
tests/unit/repositories/test_planner_repository.py::TestAreAllSequencesEvaluated::test_returns_false_when_not_all_sequences_evaluated PASSED [ 78%]
tests/unit/repositories/test_planner_repository.py::TestAreAllSequencesEvaluated::test_returns_false_when_no_sequences PASSED [ 78%]
tests/unit/repositories/test_planner_repository.py::TestAreAllSequencesEvaluated::test_returns_false_when_row_is_none PASSED [ 78%]
tests/unit/repositories/test_planner_repository.py::TestAreAllSequencesEvaluated::test_handles_partial_evaluation PASSED [ 78%]
tests/unit/repositories/test_planner_repository.py::TestAreAllSequencesEvaluated::test_uses_correct_portfolio_hash PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_by_date_returns_snapshot PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_by_date_returns_none_when_not_found PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_latest PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_latest_returns_none_when_empty PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_latest_cash_balance PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_latest_cash_balance_returns_zero_when_empty PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_history PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_history_empty PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_range PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_upsert_snapshot PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_delete_before PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_delete_before_none_to_delete PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_value_change_with_data PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_value_change_insufficient_data PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_get_value_change_zero_start_value PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_row_to_snapshot_with_valid_data PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_row_to_snapshot_with_missing_fields PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_init_with_raw_connection PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_init_with_database_instance PASSED [ 78%]
tests/unit/repositories/test_portfolio.py::TestPortfolioRepository::test_init_without_db PASSED [ 78%]
tests/unit/repositories/test_position.py::TestPositionRepositoryInit::test_init_with_db PASSED [ 78%]
tests/unit/repositories/test_position.py::TestPositionRepositoryInit::test_init_wraps_raw_connection PASSED [ 78%]
tests/unit/repositories/test_position.py::TestPositionRepositoryQueries::test_get_by_symbol_found PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryQueries::test_get_by_symbol_not_found PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryQueries::test_get_all PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryUpsert::test_upsert_position PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryDelete::test_delete_all PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryDelete::test_delete_by_symbol PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryUpdatePrice::test_update_price PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryUpdatePrice::test_update_last_sold_at PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryGetTotalValue::test_get_total_value PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryGetTotalValue::test_get_total_value_no_positions PASSED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryGetWithStockInfo::test_get_with_stock_info_empty FAILED [ 79%]
tests/unit/repositories/test_position.py::TestPositionRepositoryGetWithStockInfo::test_get_with_stock_info_merges_data FAILED [ 79%]
tests/unit/repositories/test_position.py::TestRowToPosition::test_converts_valid_row PASSED [ 79%]
tests/unit/repositories/test_position.py::TestRowToPosition::test_handles_null_values PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_get_by_symbol_returns_score PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_get_by_symbol_returns_none_when_not_found PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_get_by_symbol_uppercases PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_get_all PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_get_all_empty PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_get_top PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_upsert_score PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_upsert_score_with_string_calculated_at PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_upsert_score_none_calculated_at PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_delete PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_delete_all PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_row_to_score_with_valid_data PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_row_to_score_with_invalid_date PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_row_to_score_with_missing_fields PASSED [ 79%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_init_with_raw_connection PASSED [ 80%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_init_with_database_instance PASSED [ 80%]
tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_init_without_db FAILED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryInit::test_init_with_db PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryInit::test_init_wraps_raw_connection PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_by_symbol_found FAILED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_by_symbol_not_found PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_all_active FAILED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_all FAILED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryCreate::test_creates_stock PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryCreate::test_create_with_portfolio_targets PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryCreate::test_create_with_null_portfolio_targets PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryUpdate::test_updates_stock PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryUpdate::test_update_no_changes PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryUpdate::test_update_converts_booleans PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryUpdate::test_update_with_portfolio_targets PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryUpdate::test_update_clearing_portfolio_targets PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryDelete::test_delete_sets_inactive PASSED [ 80%]
tests/unit/repositories/test_security.py::TestSecurityRepositoryGetWithScores::test_merges_stock_score_position_data FAILED [ 80%]
tests/unit/repositories/test_security.py::TestRowToStock::test_converts_valid_row FAILED [ 80%]
tests/unit/repositories/test_security.py::TestRowToStock::test_handles_null_priority_multiplier FAILED [ 80%]
tests/unit/repositories/test_security.py::TestRowToStock::test_row_to_stock_maps_portfolio_targets FAILED [ 80%]
tests/unit/repositories/test_security.py::TestRowToStock::test_row_to_stock_handles_null_portfolio_targets FAILED [ 80%]
tests/unit/repositories/test_security.py::TestRowToStock::test_row_to_stock_handles_missing_portfolio_target_columns FAILED [ 80%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryGet::test_get_existing_key PASSED [ 80%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryGet::test_get_nonexistent_key PASSED [ 80%]
tests/unit/repositories/test_settings.py::TestSettingsRepositorySet::test_set_with_description PASSED [ 80%]
tests/unit/repositories/test_settings.py::TestSettingsRepositorySet::test_set_without_description PASSED [ 80%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryGetAll::test_get_all PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_float_valid PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_float_default PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_float_invalid PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_int_valid PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_int_from_float_string PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_int_default PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_int_invalid PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_bool_true_values PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_bool_false_values PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedGetters::test_get_bool_default PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedSetters::test_set_float PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedSetters::test_set_int PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedSetters::test_set_bool_true PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryTypedSetters::test_set_bool_false PASSED [ 81%]
tests/unit/repositories/test_settings.py::TestSettingsRepositoryDelete::test_delete PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryHelperFunctions::test_process_pre_start_trades_buy PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryHelperFunctions::test_process_pre_start_trades_sell PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryHelperFunctions::test_process_pre_start_trades_negative_clipped PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryHelperFunctions::test_build_initial_positions PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryHelperFunctions::test_build_positions_by_date PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryCreate::test_creates_trade PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_by_order_id_found PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_by_order_id_not_found PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_exists_true PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_exists_false PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_history PASSED [ 81%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_by_symbol PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_recently_bought_symbols PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_recently_sold_symbols PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_has_recent_sell_order_true PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_has_recent_sell_order_false PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_first_buy_date PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_last_buy_date PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_last_sell_date PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryQueries::test_get_trade_dates PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestTradeRepositoryPositionHistory::test_get_position_history PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestRowToTrade::test_converts_valid_row PASSED [ 82%]
tests/unit/repositories/test_trade.py::TestRowToTrade::test_handles_invalid_executed_at PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_full_aggression_at_target PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_full_aggression_above_target PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_reduced_aggression_at_90_percent PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_conservative_at_70_percent PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_very_conservative_at_50_percent PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_hibernation_below_40_percent PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_drawdown_10_percent_full_aggression PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_drawdown_20_percent_reduced PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_drawdown_30_percent_minimal PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_drawdown_40_percent_hibernation PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_most_conservative_wins PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_no_high_water_mark PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestCalculateAggression::test_zero_target_value PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestShouldHibernate::test_should_hibernate_when_aggression_zero PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestShouldHibernate::test_should_not_hibernate_when_aggressive PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestScalePositionSize::test_scale_full_aggression PASSED [ 82%]
tests/unit/satellites/test_aggression_calculator.py::TestScalePositionSize::test_scale_80_percent PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestScalePositionSize::test_scale_50_percent PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestScalePositionSize::test_scale_hibernation PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestGetAggressionDescription::test_description_full_aggression PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestGetAggressionDescription::test_description_partial_funding PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestGetAggressionDescription::test_description_with_drawdown PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestGetAggressionDescription::test_description_hibernation_allocation PASSED [ 83%]
tests/unit/satellites/test_aggression_calculator.py::TestGetAggressionDescription::test_description_hibernation_drawdown PASSED [ 83%]
tests/unit/satellites/test_balance_service.py::TestBalanceService::test_record_trade_settlement_buy PASSED [ 83%]
tests/unit/satellites/test_balance_service.py::TestBalanceService::test_record_trade_settlement_sell PASSED [ 83%]
tests/unit/satellites/test_balance_service.py::TestBalanceService::test_transfer_insufficient_funds PASSED [ 83%]
tests/unit/satellites/test_balance_service.py::TestBalanceService::test_record_dividend PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucket::test_create_core_bucket PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucket::test_create_satellite_bucket PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucket::test_bucket_default_values PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucket::test_bucket_status_values PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucketBalance::test_create_balance PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucketBalance::test_balance_multiple_currencies PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucketTransaction::test_create_deposit_transaction PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucketTransaction::test_create_trade_transaction PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestBucketTransaction::test_transaction_types PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_create_default_settings PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_create_custom_settings PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_validate_valid_settings PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_validate_slider_out_of_range PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_validate_negative_slider PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_validate_invalid_dividend_handling PASSED [ 83%]
tests/unit/satellites/test_domain_models.py::TestSatelliteSettings::test_valid_dividend_handling_options PASSED [ 83%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_minimum_risk_appetite PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_maximum_risk_appetite PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_minimum_hold_duration PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_maximum_hold_duration PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_dip_buyer_entry_style PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_breakout_buyer_entry_style PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_minimum_position_spread PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_maximum_position_spread PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_minimum_profit_taking PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_maximum_profit_taking PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_toggles_correctly PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestMapSettingsToParameters::test_maps_dividend_handling PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_get_position_size_pct PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_get_stop_loss_pct PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_get_target_hold_days PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_get_max_positions PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_get_take_profit_threshold PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_is_dip_buyer PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestHelperFunctions::test_is_breakout_buyer PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestDescribeParameters::test_describe_parameters_returns_string PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestDescribeParameters::test_describe_identifies_dip_buyer PASSED [ 84%]
tests/unit/satellites/test_parameter_mapper.py::TestDescribeParameters::test_describe_identifies_breakout_buyer PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_check_invariant_reconciled PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_check_invariant_not_reconciled PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_check_invariant_allows_small_difference PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_reconcile_already_reconciled PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_reconcile_auto_correct_small_difference PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_reconcile_large_difference_not_auto_corrected PASSED [ 84%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationService::test_reconcile_custom_threshold PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationServiceBulk::test_reconcile_all PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationServiceBulk::test_initialize_from_brokerage PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestForceReconciliation::test_force_reconcile_to_core PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestDiagnoseDiscrepancy::test_diagnose_discrepancy PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationResult::test_difference_pct_calculation PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationResult::test_difference_pct_zero_actual PASSED [ 85%]
tests/unit/satellites/test_reconciliation_service.py::TestReconciliationResult::test_difference_pct_both_zero PASSED [ 85%]
tests/unit/satellites/test_satellite_planner_integration.py::test_uses_custom_planner_when_config_exists ERROR [ 85%]
tests/unit/satellites/test_satellite_planner_integration.py::test_fallback_when_no_custom_config ERROR [ 85%]
tests/unit/satellites/test_satellite_planner_integration.py::test_fallback_when_factory_has_no_config ERROR [ 85%]
tests/unit/satellites/test_satellite_planner_integration.py::test_custom_config_receives_correct_parameters ERROR [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestStrategyPresets::test_momentum_hunter_values PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestStrategyPresets::test_steady_eddy_values PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestStrategyPresets::test_dip_buyer_values PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestStrategyPresets::test_dividend_catcher_values PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestStrategyPresets::test_all_presets_registered PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestStrategyPresets::test_all_sliders_in_range PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPreset::test_get_preset_returns_copy PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPreset::test_get_preset_unknown_raises PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPreset::test_get_preset_all_valid PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestListPresets::test_list_presets_returns_all PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPresetDescription::test_get_description_all_presets PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPresetDescription::test_get_description_momentum_hunter PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPresetDescription::test_get_description_steady_eddy PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPresetDescription::test_get_description_dip_buyer PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPresetDescription::test_get_description_dividend_catcher PASSED [ 85%]
tests/unit/satellites/test_strategy_presets.py::TestGetPresetDescription::test_get_description_unknown_raises PASSED [ 85%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintsManagerInitialization::test_default_initialization PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintsManagerInitialization::test_custom_initialization PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_unconstrained_stock_gets_default_bounds PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_allow_buy_false_caps_upper_bound_at_current_weight PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_allow_sell_false_sets_lower_bound_to_current_weight PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_locked_position_both_bounds_equal_current_weight PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_min_lot_constraint_at_minimum_prevents_partial_sell PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_min_lot_constraint_above_minimum_allows_sell_to_min_lot PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_constraint_conflict_resolved_to_current_weight PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_new_position_zero_current_weight PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_zero_portfolio_value_handled_gracefully PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_missing_current_price_handled PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_none_market_value_eur_treated_as_zero PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsCalculation::test_multiple_stocks_with_various_constraints PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_geography_constraints_basic PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_industry_constraints_basic PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_none_country_grouped_as_other PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_none_industry_grouped_as_other PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_zero_target_excluded_from_constraints PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_missing_target_treated_as_zero PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_bounds_clamped_to_hard_caps PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_lower_bound_not_negative PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_multiple_stocks_same_sector PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintsBuilding::test_mixed_sectors_multiple_constraints PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_empty_constraints_summary PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_locked_position_identified PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_buy_only_position_identified PASSED [ 86%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_sell_blocked_position_identified PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_unconstrained_position_not_in_lists PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_sector_constraints_included_in_summary PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestConstraintSummary::test_multiple_constrained_positions_summary PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsDataClass::test_weight_bounds_creation PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestWeightBoundsDataClass::test_weight_bounds_optional_reason PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestSectorConstraintDataClass::test_sector_constraint_creation PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_empty_stocks_list PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_empty_targets PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_negative_portfolio_value PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_very_large_min_lot PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_conflicting_min_lot_and_allow_sell PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_target_exceeds_one FAILED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_very_small_portfolio_value PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_zero_price_with_min_lot PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_min_portfolio_target_applies_as_lower_bound PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_max_portfolio_target_applies_as_upper_bound PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_targets_override_defaults PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_targets_interact_with_allow_buy PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_targets_interact_with_allow_sell PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_targets_interact_with_min_lot PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_none_portfolio_targets_dont_affect_bounds PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_target_edge_case_min_zero PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_target_edge_case_min_equals_max PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_portfolio_target_constraint_conflict_resolution PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_industry_targets_normalized_when_sum_exceeds_100 FAILED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_country_targets_normalized_when_sum_exceeds_100 FAILED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_targets_not_normalized_when_sum_equals_100 PASSED [ 87%]
tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_normalization_only_applies_to_active_industries FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_normalization_only_applies_to_active_countries FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_single_industry_gets_70_percent_cap FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_two_industries_get_50_percent_cap_each FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_three_plus_industries_get_default_30_percent_cap FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_industry_cap_adjustment_allows_higher_total_allocation FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryMinimumBoundScaling::test_industry_minimum_bounds_scaled_when_sum_exceeds_100 FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryMinimumBoundScaling::test_industry_minimum_bounds_scaled_when_combined_with_country_exceeds_70 PASSED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestIndustryMinimumBoundScaling::test_industry_minimum_bounds_not_scaled_when_combined_below_70 FAILED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestMinLotInfeasibleBounds::test_min_lot_ignored_when_exceeds_upper_bound PASSED [ 88%]
tests/unit/services/optimization/test_constraints_manager.py::TestMinLotInfeasibleBounds::test_min_lot_applied_when_within_bounds PASSED [ 88%]
tests/unit/services/optimization/test_expected_returns.py::TestExpectedReturnsCalculator::test_calculates_returns_with_cagr_and_score PASSED [ 88%]
tests/unit/services/optimization/test_expected_returns.py::TestExpectedReturnsCalculator::test_handles_missing_cagr_data PASSED [ 88%]
tests/unit/services/optimization/test_expected_returns.py::TestExpectedReturnsCalculator::test_handles_empty_symbols_list PASSED [ 88%]
tests/unit/services/optimization/test_expected_returns.py::TestExpectedReturnsCalculator::test_applies_regime_adjustment PASSED [ 88%]
tests/unit/services/optimization/test_expected_returns.py::TestExpectedReturnsCalculator::test_applies_dividend_bonus PASSED [ 88%]
tests/unit/services/optimization/test_expected_returns.py::TestExpectedReturnsCalculator::test_get_symbols_with_data PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightBlending::test_blend_weights_pure_mv_when_blend_is_zero PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightBlending::test_blend_weights_pure_hrp_when_blend_is_one PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightBlending::test_blend_weights_fifty_fifty PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightBlending::test_blend_weights_handles_different_symbol_sets PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightNormalization::test_normalize_weights_to_one PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightNormalization::test_normalize_weights_to_target_sum PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightNormalization::test_normalize_weights_handles_zero_sum PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightChanges::test_calculate_weight_changes_basic PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightChanges::test_calculate_weight_changes_new_position PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightChanges::test_calculate_weight_changes_position_to_close PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerWeightChanges::test_calculate_weight_changes_ignores_tiny_changes PASSED [ 88%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerErrorHandling::test_optimize_returns_error_when_no_stocks PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerErrorHandling::test_optimize_returns_error_when_no_expected_returns PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerErrorHandling::test_optimize_returns_error_when_insufficient_history PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerHRP::test_hrp_requires_at_least_two_symbols PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerHRP::test_hrp_with_valid_data PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerIntegration::test_full_optimization_flow PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerIntegration::test_optimization_respects_cash_reserve PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerBoundsClamping::test_clamp_weights_to_bounds_respects_max PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerBoundsClamping::test_clamp_weights_to_bounds_respects_min PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerBoundsClamping::test_clamp_weights_to_bounds_within_bounds_unchanged PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerBoundsClamping::test_clamp_weights_to_bounds_handles_missing_symbols PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerBoundsClamping::test_clamp_weights_to_bounds_edge_cases PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerBoundsClamping::test_clamp_weights_after_normalization PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerSectorConstraints::test_add_sector_constraints_called_with_country_constraints PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerSectorConstraints::test_add_sector_constraints_called_with_industry_constraints PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerSectorConstraints::test_sector_constraints_applied_to_both_optimization_attempts PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerSectorConstraints::test_sector_mappers_built_correctly_from_constraints PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerSectorConstraints::test_sector_bounds_built_correctly_from_constraints PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerRetirementFallbacks::test_fallback_to_min_volatility_when_efficient_return_fails PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerRetirementFallbacks::test_fallback_to_efficient_risk_when_min_volatility_fails PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerRetirementFallbacks::test_fallback_to_max_sharpe_when_efficient_risk_fails PASSED [ 89%]
tests/unit/services/optimization/test_portfolio_optimizer.py::TestPortfolioOptimizerRetirementFallbacks::test_returns_none_when_all_fallbacks_fail PASSED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_builds_covariance_matrix_from_prices FAILED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_handles_empty_price_data PASSED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_handles_insufficient_history PASSED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_handles_empty_symbols_list PASSED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_filters_valid_symbols FAILED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_get_correlations PASSED [ 89%]
tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_get_correlations_empty_dataframe PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_high_score_gets_larger_position PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_high_volatility_reduces_position PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_none_volatility_uses_default PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_never_exceeds_maximum PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_never_below_minimum PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_score_adjustment_is_bounded PASSED [ 90%]
tests/unit/services/test_allocator.py::TestCalculatePositionSize::test_extreme_volatility_respects_floor PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_single_industry PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_multiple_industries PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_extra_whitespace_is_trimmed PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_empty_string_returns_empty_list PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_none_returns_empty_list PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_trailing_comma_ignored PASSED [ 90%]
tests/unit/services/test_allocator.py::TestParseIndustries::test_multiple_commas_ignored PASSED [ 90%]
tests/unit/services/test_allocator.py::TestGetMaxTrades::test_zero_cash_returns_zero PASSED [ 90%]
tests/unit/services/test_allocator.py::TestGetMaxTrades::test_insufficient_cash_returns_zero PASSED [ 90%]
tests/unit/services/test_allocator.py::TestGetMaxTrades::test_negative_cash_returns_zero PASSED [ 90%]
tests/unit/services/test_cache_invalidation.py::test_invalidate_trade_caches PASSED [ 90%]
tests/unit/services/test_cache_invalidation.py::test_invalidate_recommendation_caches PASSED [ 90%]
tests/unit/services/test_cache_invalidation.py::test_invalidate_portfolio_caches PASSED [ 90%]
tests/unit/services/test_cache_invalidation.py::test_invalidate_all_trade_related PASSED [ 90%]
tests/unit/services/test_cache_invalidation.py::test_get_cache_invalidation_service PASSED [ 90%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_detects_country_concentration PASSED [ 90%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_detects_sector_concentration PASSED [ 90%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_detects_position_concentration PASSED [ 90%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_returns_empty_list_when_no_concentration PASSED [ 90%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_handles_empty_portfolio PASSED [ 91%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_detects_multiple_alerts PASSED [ 91%]
tests/unit/services/test_concentration_alerts.py::TestDetectAlerts::test_alerts_have_correct_structure PASSED [ 91%]
tests/unit/services/test_concentration_alerts.py::TestCalculateSeverity::test_returns_critical_for_high_percentage PASSED [ 91%]
tests/unit/services/test_concentration_alerts.py::TestCalculateSeverity::test_returns_warning_for_moderate_percentage PASSED [ 91%]
tests/unit/services/test_concentration_alerts.py::TestCalculateSeverity::test_returns_warning_for_zero_limit PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestFindRateSymbol::test_finds_direct_symbol PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestFindRateSymbol::test_finds_inverse_symbol PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestFindRateSymbol::test_returns_none_for_unknown_pair PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestGetRateViaPath::test_single_step_path PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestGetRateViaPath::test_single_step_path_zero_price PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestGetRateViaPath::test_two_step_path PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestGetRateViaPath::test_returns_none_for_empty_path PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_init_sets_client PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_conversion_path_direct PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_conversion_path_same_currency PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_conversion_path_via_eur PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_rate_direct_pair PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_rate_inverse_pair PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_rate_same_currency PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestCurrencyExchangeService::test_get_available_currencies PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestExchangeDataClasses::test_exchange_rate_dataclass PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestExchangeDataClasses::test_conversion_step_dataclass PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestValidateExchangeRequest::test_returns_false_for_same_currency PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestValidateExchangeRequest::test_returns_false_for_negative_amount PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestValidateExchangeRequest::test_returns_false_for_zero_amount PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestValidateExchangeRequest::test_returns_false_when_disconnected PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestValidateExchangeRequest::test_returns_true_for_valid_request PASSED [ 91%]
tests/unit/services/test_currency_exchange_service.py::TestEnsureBalance::test_returns_true_when_balance_sufficient PASSED [ 92%]
tests/unit/services/test_currency_exchange_service.py::TestEnsureBalance::test_returns_false_when_insufficient_source PASSED [ 92%]
tests/unit/services/test_currency_exchange_service.py::TestDirectPairs::test_eur_usd_pair PASSED [ 92%]
tests/unit/services/test_currency_exchange_service.py::TestDirectPairs::test_eur_gbp_pair PASSED [ 92%]
tests/unit/services/test_currency_exchange_service.py::TestDirectPairs::test_hkd_pairs PASSED [ 92%]
tests/unit/services/test_negative_balance_rebalancer.py::TestNegativeBalanceRebalancer::test_get_trading_currencies PASSED [ 92%]
tests/unit/services/test_negative_balance_rebalancer.py::TestNegativeBalanceRebalancer::test_check_currency_minimums_all_above_minimum PASSED [ 92%]
tests/unit/services/test_negative_balance_rebalancer.py::TestNegativeBalanceRebalancer::test_check_currency_minimums_below_minimum PASSED [ 92%]
tests/unit/services/test_negative_balance_rebalancer.py::TestNegativeBalanceRebalancer::test_check_currency_minimums_negative_balance PASSED [ 92%]
tests/unit/services/test_negative_balance_rebalancer.py::TestNegativeBalanceRebalancer::test_rebalance_negative_balances_no_shortfalls PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_increases_weight_for_positive_attribution PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_decreases_weight_for_negative_attribution FAILED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_handles_zero_attribution PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_preserves_total_weight_approximately PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_handles_missing_attribution_entries PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_handles_zero_avg_return PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustIndWeights::test_increases_weight_for_positive_attribution PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustIndWeights::test_decreases_weight_for_negative_attribution FAILED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustIndWeights::test_preserves_total_weight_approximately PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustIndWeights::test_handles_missing_attribution_entries PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestGetPerformanceAdjustedWeights::test_returns_adjusted_weights_with_attribution PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestGetPerformanceAdjustedWeights::test_returns_base_weights_when_no_attribution PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestGetPerformanceAdjustedWeights::test_handles_empty_attribution_data PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestGetPerformanceAdjustedWeights::test_uses_portfolio_hash_when_provided PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestGetPerformanceAdjustedWeights::test_handles_missing_avg_return_in_attribution PASSED [ 92%]
tests/unit/services/test_performance_adjustment_calculator.py::TestGetPerformanceAdjustedWeights::test_applies_adjustments_proportionally PASSED [ 92%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_builds_context_with_positions PASSED [ 92%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_builds_context_with_allocation_targets PASSED [ 92%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_builds_country_to_group_mapping PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_builds_industry_to_group_mapping PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_includes_stock_scores PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_handles_empty_positions PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_defaults_total_value_to_one_if_zero PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_includes_stock_countries_and_industries PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_handles_stocks_without_country_or_industry PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_handles_empty_allocation_targets PASSED [ 93%]
tests/unit/services/test_portfolio_context_builder.py::TestBuildPortfolioContext::test_handles_scores_with_none_quality_score PASSED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_single_country_100_percent FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_multiple_countries_split_correctly FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_multi_industry_splits_value_equally FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_empty_portfolio_returns_zero PASSED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_missing_country_handled FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_missing_industry_handled FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_fallback_to_price_calculation_when_no_eur_value FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_cash_balance_included FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_deviation_calculated_correctly FAILED [ 93%]
tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_values_rounded_correctly FAILED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateMinTradeAmount::test_calculates_minimum_for_standard_fees PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateMinTradeAmount::test_returns_high_minimum_when_percent_exceeds_max_ratio PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateMinTradeAmount::test_handles_zero_fixed_cost PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateMinTradeAmount::test_handles_different_max_cost_ratios PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateRebalanceTrades::test_returns_empty_when_cash_below_minimum PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateRebalanceTrades::test_returns_empty_when_no_recommendations PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateRebalanceTrades::test_returns_empty_when_no_buy_recommendations PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateRebalanceTrades::test_converts_multistep_to_recommendation PASSED [ 93%]
tests/unit/services/test_rebalancing_service.py::TestCalculateRebalanceTrades::test_filters_invalid_recommendations PASSED [ 93%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_converts_with_all_group_scores PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_converts_with_only_long_term_score PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_converts_with_only_fundamentals_score PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_converts_with_no_group_scores PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_converts_with_empty_group_scores PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_history_years_calculated_from_cagr PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestToDomainScore::test_history_years_none_without_cagr PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoringServiceInit::test_init_sets_dependencies PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestGetPriceData::test_fetches_daily_and_monthly_prices PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestGetPriceData::test_handles_empty_results PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_successful_calculation_and_save PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_uses_symbol_as_yahoo_symbol_fallback PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_returns_none_when_insufficient_daily_data PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_returns_none_when_insufficient_monthly_data PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_returns_none_when_calculation_fails PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_handles_exception_gracefully PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestCalculateAndSaveScore::test_uses_default_country_and_industry PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoreAllStocks::test_scores_all_active_stocks PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoreAllStocks::test_handles_no_active_stocks PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoreAllStocks::test_skips_failed_calculations PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoreAllStocks::test_processes_stocks_with_none_attributes PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoringServiceEdgeCases::test_empty_daily_prices_list PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoringServiceEdgeCases::test_score_with_zero_volatility PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoringServiceEdgeCases::test_score_with_negative_values PASSED [ 94%]
tests/unit/services/test_scoring_service.py::TestScoringServiceEdgeCases::test_score_with_very_high_values PASSED [ 94%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_adds_stock_by_tradernet_symbol PASSED [ 94%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_adds_stock_by_isin PASSED [ 94%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_raises_error_if_stock_already_exists PASSED [ 94%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_raises_error_if_identifier_empty PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_raises_error_if_yahoo_format_provided PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_normalizes_identifier_to_uppercase PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_handles_historical_data_fetch_failure PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_handles_score_calculation_failure PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_publishes_stock_added_event PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_uses_custom_min_lot PASSED [ 95%]
tests/unit/services/test_security_setup_service.py::TestSecuritySetupService::test_uses_custom_allow_buy_sell PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_large_loss_returns_zero_score_blocks_sell PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_exactly_20_percent_loss_blocks_sell PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_moderate_loss_gets_high_sell_score PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_ideal_return_range_gets_low_score PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_exceeding_target_gets_moderate_score PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_invalid_avg_price_returns_neutral PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateUnderperformanceScore::test_invalid_days_returns_neutral PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateTimeHeldScore::test_under_90_days_returns_zero_blocks_sell PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateTimeHeldScore::test_exactly_90_days_is_allowed PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateTimeHeldScore::test_long_hold_gets_highest_score PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateTimeHeldScore::test_none_date_returns_reasonable_default PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateTimeHeldScore::test_invalid_date_format_returns_default PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculateTimeHeldScore::test_future_date_handles_gracefully PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculatePortfolioBalanceScore::test_overweight_country_increases_score PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculatePortfolioBalanceScore::test_underweight_country_decreases_score PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculatePortfolioBalanceScore::test_high_concentration_single_position PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculatePortfolioBalanceScore::test_zero_portfolio_value_returns_neutral PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculatePortfolioBalanceScore::test_multi_industry_stock_averages PASSED [ 95%]
tests/unit/services/test_sell_scorer.py::TestCalculatePortfolioBalanceScore::test_empty_industry_returns_neutral PASSED [ 95%]
tests/unit/services/test_technical_data_calculator.py::TestGetFallbackTechnicalData::test_returns_fallback_values PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateCurrentVolatility::test_returns_fallback_when_insufficient_data PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateCurrentVolatility::test_calculates_volatility_from_last_60_days PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateCurrentVolatility::test_returns_fallback_for_non_finite_values PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateCurrentVolatility::test_returns_fallback_for_negative_volatility PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateHistoricalVolatility::test_calculates_volatility_from_all_data PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateHistoricalVolatility::test_returns_fallback_for_non_finite_values PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateHistoricalVolatility::test_returns_fallback_for_negative_volatility PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateHistoricalVolatility::test_handles_single_price_point PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateEmaDistance::test_returns_zero_when_insufficient_data PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateEmaDistance::test_calculates_distance_when_sufficient_data PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateEmaDistance::test_uses_mean_fallback_when_ema_calculation_fails PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestCalculateEmaDistance::test_returns_zero_when_ema_value_is_zero PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestProcessSymbolTechnicalData::test_returns_fallback_when_insufficient_data PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestProcessSymbolTechnicalData::test_calculates_technical_data_when_sufficient_data PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestProcessSymbolTechnicalData::test_returns_fallback_for_zero_or_negative_prices PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestProcessSymbolTechnicalData::test_handles_value_error_gracefully PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestProcessSymbolTechnicalData::test_handles_zero_division_error_gracefully PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestProcessSymbolTechnicalData::test_handles_unexpected_errors_gracefully PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestGetTechnicalDataForPositions::test_processes_multiple_symbols PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestGetTechnicalDataForPositions::test_handles_empty_symbol_list PASSED [ 96%]
tests/unit/services/test_technical_data_calculator.py::TestGetTechnicalDataForPositions::test_each_symbol_gets_technical_data FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_buy_blocked_when_insufficient_balance FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_buy_blocked_when_negative_balance FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_buy_allowed_when_sufficient_balance FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_blocked_when_no_position FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_blocked_when_quantity_exceeds_position FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_allowed_when_quantity_within_position FAILED [ 96%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_broker_connection_failure_raises_error FAILED [ 97%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_multi_currency_validation FAILED [ 97%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_order_failure_recorded FAILED [ 97%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_no_validation_without_currency_balances FAILED [ 97%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_blocked_when_recent_order_in_database FAILED [ 97%]
tests/unit/services/test_trade_execution.py::TestTradeValidation::test_order_stored_immediately_after_placement FAILED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_allows_trade_when_limits_disabled PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_allows_trade_when_no_previous_trades PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_blocks_trade_when_too_soon_after_last PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_allows_trade_after_minimum_time PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_blocks_trade_when_daily_limit_reached PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_allows_trade_below_daily_limit PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_blocks_trade_when_weekly_limit_reached PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_allows_trade_below_weekly_limit PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_checks_all_limits_in_order PASSED [ 97%]
tests/unit/services/test_trade_frequency_service.py::TestTradeFrequencyService::test_handles_exception_gracefully PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_records_trade_successfully PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_skips_duplicate_order_id PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_skips_trade_without_order_id PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_skips_trade_with_empty_order_id PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_uses_estimated_price_when_price_zero PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_updates_position_after_sell PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_handles_currency_conversion PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_handles_exception_gracefully PASSED [ 97%]
tests/unit/services/test_trade_recorder.py::TestRecordTrade::test_publishes_trade_executed_event PASSED [ 97%]
tests/unit/services/test_trade_safety_service.py::test_check_pending_orders_no_pending PASSED [ 97%]
tests/unit/services/test_trade_safety_service.py::test_check_pending_orders_broker_has_pending PASSED [ 97%]
tests/unit/services/test_trade_safety_service.py::test_check_pending_orders_recent_sell_in_db PASSED [ 97%]
tests/unit/services/test_trade_safety_service.py::test_check_cooldown_not_in_cooldown PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_check_cooldown_in_cooldown PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_check_cooldown_ignores_sell PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_validate_sell_position_sufficient PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_validate_sell_position_insufficient PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_validate_sell_position_no_position PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_validate_trade_success PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_validate_trade_raises_on_error PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_check_minimum_hold_time_recent_buy_blocks_sell PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_check_minimum_hold_time_old_buy_allows_sell PASSED [ 98%]
tests/unit/services/test_trade_safety_service.py::test_validate_trade_sell_blocks_recent_buy FAILED [ 98%]
tests/unit/services/test_tradernet_connection.py::test_ensure_tradernet_connected_already_connected PASSED [ 98%]
tests/unit/services/test_tradernet_connection.py::test_ensure_tradernet_connected_connects_successfully PASSED [ 98%]
tests/unit/services/test_tradernet_connection.py::test_ensure_tradernet_connected_fails_raises_exception PASSED [ 98%]
tests/unit/services/test_tradernet_connection.py::test_ensure_tradernet_connected_fails_returns_none PASSED [ 98%]
tests/unit/services/test_tradernet_connection.py::test_ensure_tradernet_connected_uses_default_client PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_calculates_turnover_from_trades_and_snapshots PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_returns_none_when_no_trades PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_returns_none_when_no_snapshots PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_uses_value_eur_when_available PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_calculates_value_when_value_eur_missing PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_handles_both_buy_and_sell_trades PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_averages_snapshot_values PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestCalculateAnnualTurnover::test_returns_none_when_average_portfolio_value_zero PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestGetTurnoverStatus::test_returns_unknown_when_turnover_none PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestGetTurnoverStatus::test_returns_critical_for_high_turnover PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestGetTurnoverStatus::test_returns_warning_for_moderate_turnover PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestGetTurnoverStatus::test_returns_normal_for_low_turnover PASSED [ 98%]
tests/unit/services/test_turnover_tracker.py::TestGetTurnoverStatus::test_includes_turnover_display PASSED [ 99%]
tests/unit/test_main.py::TestCheckDatabaseHealth::test_returns_connected_when_healthy PASSED [ 99%]
tests/unit/test_main.py::TestCheckDatabaseHealth::test_returns_error_on_exception PASSED [ 99%]
tests/unit/test_main.py::TestCheckTradernetHealth::test_returns_connected_when_already_connected PASSED [ 99%]
tests/unit/test_main.py::TestCheckTradernetHealth::test_returns_connected_when_connect_succeeds PASSED [ 99%]
tests/unit/test_main.py::TestCheckTradernetHealth::test_returns_disconnected_when_connect_fails PASSED [ 99%]
tests/unit/test_main.py::TestCheckTradernetHealth::test_returns_error_on_exception PASSED [ 99%]
tests/unit/test_main.py::TestCheckYahooFinanceHealth::test_returns_available_when_healthy PASSED [ 99%]
tests/unit/test_main.py::TestCheckYahooFinanceHealth::test_returns_unavailable_when_no_info PASSED [ 99%]
tests/unit/test_main.py::TestCheckYahooFinanceHealth::test_returns_error_on_exception PASSED [ 99%]
tests/unit/test_main.py::TestHealthEndpoint::test_returns_healthy_when_all_services_ok PASSED [ 99%]
tests/unit/test_main.py::TestHealthEndpoint::test_returns_degraded_on_database_error PASSED [ 99%]
tests/unit/test_main.py::TestHealthEndpoint::test_returns_degraded_on_tradernet_error PASSED [ 99%]
tests/unit/test_main.py::TestHealthEndpoint::test_returns_degraded_on_yahoo_error PASSED [ 99%]
tests/unit/test_main.py::TestRootEndpoint::test_returns_file_response PASSED [ 99%]
tests/unit/test_main.py::TestAppConfiguration::test_app_has_correct_title PASSED [ 99%]
tests/unit/test_main.py::TestAppConfiguration::test_app_has_routers PASSED [ 99%]
tests/unit/test_main.py::TestAppConfiguration::test_app_has_middleware PASSED [ 99%]
tests/unit/test_main.py::TestLoggingConfiguration::test_log_format_includes_correlation_id PASSED [ 99%]
tests/unit/test_main.py::TestLoggingConfiguration::test_console_handler_has_filter PASSED [ 99%]
tests/unit/test_main.py::TestLoggingConfiguration::test_file_handler_has_filter PASSED [ 99%]
tests/unit/test_main.py::TestLifespan::test_lifespan_raises_on_missing_credentials PASSED [ 99%]
tests/unit/test_main.py::TestLifespan::test_lifespan_initializes_components PASSED [ 99%]
tests/unit/test_main.py::TestLifespan::test_lifespan_cleans_up_lock_files PASSED [ 99%]
tests/unit/test_main.py::TestLifespan::test_lifespan_handles_tradernet_connection_failure PASSED [ 99%]
tests/unit/test_main.py::TestRequestContextMiddleware::test_middleware_sets_correlation_id PASSED [ 99%]
tests/unit/test_main.py::TestRequestContextMiddleware::test_middleware_emits_web_request_event PASSED [ 99%]
tests/unit/test_main.py::TestRequestContextMiddleware::test_middleware_skips_led_endpoint PASSED [100%]

==================================== ERRORS ====================================
_ ERROR at setup of TestOpportunityCalculatorRegistry.test_opportunity_buys_calculator _
tests/integration/planning/test_modular_components.py:61: in sample_opportunity_context
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
_ ERROR at setup of TestOpportunityCalculatorRegistry.test_profit_taking_calculator _
tests/integration/planning/test_modular_components.py:61: in sample_opportunity_context
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
____________ ERROR at setup of test_modular_planner_basic_execution ____________
tests/integration/planning/test_modular_planner_parity.py:82: in sample_securities
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
_______________ ERROR at setup of test_modular_adapter_execution _______________
tests/integration/planning/test_modular_planner_parity.py:82: in sample_securities
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
____________ ERROR at setup of test_modular_planner_empty_portfolio ____________
tests/integration/planning/test_modular_planner_parity.py:82: in sample_securities
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
________________ ERROR at setup of test_modular_planner_no_cash ________________
tests/integration/planning/test_modular_planner_parity.py:82: in sample_securities
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_security_without_position _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_security_when_buy_not_allowed _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_position_that_is_up _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_position_down_too_much _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_low_quality_security _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_creates_opportunity_for_quality_dip _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_priority_based_on_quality_and_drop _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_respects_priority_weight_param _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_respects_security_priority_multiplier _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_uses_default_quality_when_scores_not_provided _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_position_with_zero_current_price _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_skips_position_with_zero_avg_price _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestAveragingDownCalculator.test_calculate_respects_base_trade_amount_param _
tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_skips_position_when_sell_not_allowed _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_skips_position_with_zero_value _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_creates_opportunity_for_windfall_position _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_skips_position_without_windfall _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_respects_priority_weight_param _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_respects_security_priority_multiplier _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_handles_eur_currency_without_exchange_service _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
_ ERROR at setup of TestProfitTakingCalculator.test_calculate_handles_missing_current_price _
tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py:28: in basic_security
    return Security(
E   TypeError: Security.__init__() got an unexpected keyword argument 'id'
________ ERROR at setup of test_uses_custom_planner_when_config_exists _________
tests/unit/satellites/test_satellite_planner_integration.py:25: in mock_bucket
    return Bucket(
E   TypeError: Bucket.__init__() got an unexpected keyword argument 'target_allocation_pct'
____________ ERROR at setup of test_fallback_when_no_custom_config _____________
tests/unit/satellites/test_satellite_planner_integration.py:25: in mock_bucket
    return Bucket(
E   TypeError: Bucket.__init__() got an unexpected keyword argument 'target_allocation_pct'
__________ ERROR at setup of test_fallback_when_factory_has_no_config __________
tests/unit/satellites/test_satellite_planner_integration.py:25: in mock_bucket
    return Bucket(
E   TypeError: Bucket.__init__() got an unexpected keyword argument 'target_allocation_pct'
_______ ERROR at setup of test_custom_config_receives_correct_parameters _______
tests/unit/satellites/test_satellite_planner_integration.py:25: in mock_bucket
    return Bucket(
E   TypeError: Bucket.__init__() got an unexpected keyword argument 'target_allocation_pct'
=================================== FAILURES ===================================
_____________ TestPatternGeneratorRegistry.test_direct_buy_pattern _____________
tests/integration/planning/test_modular_components.py:196: in test_direct_buy_pattern
    sequences = await pattern.generate(
E   TypeError: object list can't be used in 'await' expression
____________ TestPatternGeneratorRegistry.test_single_best_pattern _____________
tests/integration/planning/test_modular_components.py:246: in test_single_best_pattern
    sequences = await pattern.generate(opportunities_by_category, params={})
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: object list can't be used in 'await' expression
________ TestSequenceGeneratorRegistry.test_partial_execution_generator ________
tests/integration/planning/test_modular_components.py:292: in test_partial_execution_generator
    sequences = await generator.generate(
app/modules/planning/domain/calculations/sequences/partial_execution.py:79: in generate
    partial_quantity = int(opp.quantity * fill_pct)
                           ^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'quantity'
_______________________ test_end_to_end_module_pipeline ________________________
tests/integration/planning/test_modular_components.py:394: in test_end_to_end_module_pipeline
    Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL must have product_type set. Run backfill script or set manually via API.
__________________________ test_create_planner_config __________________________
tests/integration/planning/test_planner_config_api.py:49: in test_create_planner_config
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
_______________________ test_create_planner_invalid_toml _______________________
tests/integration/planning/test_planner_config_api.py:69: in test_create_planner_invalid_toml
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
______________________________ test_list_planners ______________________________
tests/integration/planning/test_planner_config_api.py:86: in test_list_planners
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
____________________________ test_get_planner_by_id ____________________________
tests/integration/planning/test_planner_config_api.py:110: in test_get_planner_by_id
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
_________________________ test_get_nonexistent_planner _________________________
tests/integration/planning/test_planner_config_api.py:134: in test_get_nonexistent_planner
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
_____________________________ test_update_planner ______________________________
tests/integration/planning/test_planner_config_api.py:142: in test_update_planner
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
________________________ test_update_planner_name_only _________________________
tests/integration/planning/test_planner_config_api.py:169: in test_update_planner_name_only
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
_______________________ test_update_planner_invalid_toml _______________________
tests/integration/planning/test_planner_config_api.py:196: in test_update_planner_invalid_toml
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
_____________________________ test_delete_planner ______________________________
tests/integration/planning/test_planner_config_api.py:220: in test_delete_planner
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
___________________________ test_validate_toml_valid ___________________________
tests/integration/planning/test_planner_config_api.py:245: in test_validate_toml_valid
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
__________________________ test_validate_toml_invalid __________________________
tests/integration/planning/test_planner_config_api.py:259: in test_validate_toml_invalid
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
___________________________ test_get_planner_history ___________________________
tests/integration/planning/test_planner_config_api.py:274: in test_get_planner_history
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
______________________ test_apply_planner_without_bucket _______________________
tests/integration/planning/test_planner_config_api.py:307: in test_apply_planner_without_bucket
    async with AsyncClient(app=app, base_url="http://test") as client:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AsyncClient.__init__() got an unexpected keyword argument 'app'
___________ TestGetOptimizerStatus.test_calculates_min_trade_amount ____________
tests/unit/api/test_optimizer.py:212: in test_calculates_min_trade_amount
    mock_calc.assert_called_once_with(2.0, 0.002)
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:991: in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:979: in assert_called_with
    raise AssertionError(_error_message()) from cause
E   AssertionError: expected call not found.
E   Expected: calculate_min_trade_amount(2.0, 0.002)
E     Actual: calculate_min_trade_amount(transaction_cost_fixed=2.0, transaction_cost_percent=0.002)
__________________ TestSettingDefaults.test_has_min_hold_days __________________
tests/unit/api/test_settings.py:30: in test_has_min_hold_days
    assert "min_hold_days" in SETTING_DEFAULTS
E   AssertionError: assert 'min_hold_days' in {'event_driven_rebalancing_enabled': 1.0, 'job_auto_deploy_minutes': 5.0, 'job_maintenance_hour': 3.0, 'job_sync_cycle_minutes': 15.0, ...}
____________ TestSettingDefaults.test_has_transaction_cost_settings ____________
tests/unit/api/test_settings.py:45: in test_has_transaction_cost_settings
    assert "transaction_cost_fixed" in SETTING_DEFAULTS
E   AssertionError: assert 'transaction_cost_fixed' in {'event_driven_rebalancing_enabled': 1.0, 'job_auto_deploy_minutes': 5.0, 'job_maintenance_hour': 3.0, 'job_sync_cycle_minutes': 15.0, ...}
___________ TestGetSettingValue.test_returns_default_when_not_in_db ____________
tests/unit/api/test_settings.py:166: in test_returns_default_when_not_in_db
    assert result == SETTING_DEFAULTS["min_hold_days"]
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'min_hold_days'
_____________ TestGetAllSettingsEndpoint.test_returns_all_settings _____________
tests/unit/api/test_settings.py:305: in test_returns_all_settings
    assert "min_hold_days" in result
E   AssertionError: assert 'min_hold_days' in {'event_driven_rebalancing_enabled': 1.0, 'job_auto_deploy_minutes': 5.0, 'job_maintenance_hour': 3.0, 'job_sync_cycle_minutes': 15.0, ...}
____________ TestUpdateSettingEndpoint.test_updates_numeric_setting ____________
tests/unit/api/test_settings.py:342: in test_updates_numeric_setting
    result = await update_setting_value(
app/api/settings.py:202: in update_setting_value
    raise HTTPException(status_code=400, detail=f"Unknown setting: {key}")
E   fastapi.exceptions.HTTPException: 400: Unknown setting: min_hold_days
_____________ TestGetStatus.test_returns_healthy_status_with_data ______________
tests/unit/api/test_status.py:85: in test_returns_healthy_status_with_data
    assert result["security_universe_count"] == 2
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'security_universe_count'
------------------------------ Captured log call -------------------------------
WARNING  app.modules.system.api.status:status.py:72 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
_____ TestCheckRebalanceTriggers.test_no_trigger_when_cash_below_threshold _____
tests/unit/domain/services/test_rebalancing_triggers.py:147: in test_no_trigger_when_cash_below_threshold
    assert should_rebalance is False
E   assert True is False
________ TestCheckRebalanceTriggers.test_handles_missing_settings_repo _________
tests/unit/domain/services/test_rebalancing_triggers.py:210: in test_handles_missing_settings_repo
    should_rebalance, reason = await check_rebalance_triggers(
app/modules/rebalancing/domain/rebalancing_triggers.py:41: in check_rebalance_triggers
    settings_repo = SettingsRepository()
                    ^^^^^^^^^^^^^^^^^^^^
app/repositories/settings.py:14: in __init__
    self._db = get_db_manager().config
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_________ TestSettingsService.test_get_settings_loads_from_repository __________
tests/unit/domain/services/test_settings_service.py:35: in test_get_settings_loads_from_repository
    assert settings.min_hold_days == 120
           ^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'Settings' object has no attribute 'min_hold_days'
________ TestSettingsService.test_get_settings_uses_defaults_when_empty ________
tests/unit/domain/services/test_settings_service.py:50: in test_get_settings_uses_defaults_when_empty
    assert settings.min_hold_days == 90  # Default
           ^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'Settings' object has no attribute 'min_hold_days'
_________ TestApplyPendingOrdersToPortfolio.test_apply_multiple_orders _________
tests/unit/domain/test_portfolio_hash.py:109: in test_apply_multiple_orders
    assert adjusted_cash["USD"] == -100.0  # Can go negative in hypothetical state
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 0.0 == -100.0
____________________ TestSimpleCache.test_set_stores_value _____________________
tests/unit/infrastructure/test_cache.py:28: in test_set_stores_value
    assert cache._cache["key1"] == "value1"
E   AssertionError: assert ('value1', 1767285502.122844) == 'value1'
__________ TestCacheInvalidationService.test_invalidate_trade_caches ___________
tests/unit/infrastructure/test_cache_invalidation.py:30: in test_invalidate_trade_caches
    with patch("app.infrastructure.cache_invalidation.emit"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.infrastructure.cache_invalidation' from '/Users/aristath/arduino-trader/app/infrastructure/cache_invalidation.py'> does not have the attribute 'emit'
______ TestCacheInvalidationService.test_invalidate_recommendation_caches ______
tests/unit/infrastructure/test_cache_invalidation.py:41: in test_invalidate_recommendation_caches
    with patch("app.infrastructure.cache_invalidation.emit"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.infrastructure.cache_invalidation' from '/Users/aristath/arduino-trader/app/infrastructure/cache_invalidation.py'> does not have the attribute 'emit'
________ TestCacheInvalidationService.test_invalidate_all_trade_related ________
tests/unit/infrastructure/test_cache_invalidation.py:63: in test_invalidate_all_trade_related
    with patch("app.infrastructure.cache_invalidation.emit"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.infrastructure.cache_invalidation' from '/Users/aristath/arduino-trader/app/infrastructure/cache_invalidation.py'> does not have the attribute 'emit'
_ TestGetCacheInvalidationService.test_get_cache_invalidation_service_with_default_cache _
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1423: in patched
    with self.decoration_helper(patched,
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1405: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.infrastructure.cache_invalidation' from '/Users/aristath/arduino-trader/app/infrastructure/cache_invalidation.py'> does not have the attribute 'cache'
_________________ TestDatabaseAdapter.test_execute_runs_query __________________
tests/unit/infrastructure/test_database_adapter.py:37: in test_execute_runs_query
    mock_connection.commit.assert_called_once()
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:958: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected 'commit' to have been called once. Called 0 times.
______________ TestGetQueryQueue.test_raises_when_not_initialized ______________
tests/unit/infrastructure/test_database_queue.py:334: in test_raises_when_not_initialized
    import app.infrastructure.database.queue as module
E   ModuleNotFoundError: No module named 'app.infrastructure.database'
_____________ TestInitQueryQueue.test_initializes_and_starts_queue _____________
tests/unit/infrastructure/test_database_queue.py:354: in test_initializes_and_starts_queue
    import app.infrastructure.database.queue as module
E   ModuleNotFoundError: No module named 'app.infrastructure.database'
______________ TestShutdownQueryQueue.test_stops_and_clears_queue ______________
tests/unit/infrastructure/test_database_queue.py:378: in test_stops_and_clears_queue
    import app.infrastructure.database.queue as module
E   ModuleNotFoundError: No module named 'app.infrastructure.database'
________________ TestShutdownQueryQueue.test_handles_none_queue ________________
tests/unit/infrastructure/test_database_queue.py:395: in test_handles_none_queue
    import app.infrastructure.database.queue as module
E   ModuleNotFoundError: No module named 'app.infrastructure.database'
________ TestEnqueueConvenienceFunction.test_enqueue_uses_global_queue _________
tests/unit/infrastructure/test_database_queue.py:415: in test_enqueue_uses_global_queue
    import app.infrastructure.database.queue as module
E   ModuleNotFoundError: No module named 'app.infrastructure.database'
________ TestDisplayStateManagerEventEmission.test_set_text_emits_event ________
tests/unit/infrastructure/test_display_service.py:19: in test_set_text_emits_event
    with patch("app.infrastructure.hardware.display_service.emit") as mock_emit:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.infrastructure.hardware' has no attribute 'display_service'
________ TestDisplayStateManagerEventEmission.test_set_led3_emits_event ________
tests/unit/infrastructure/test_display_service.py:40: in test_set_led3_emits_event
    with patch("app.infrastructure.hardware.display_service.emit") as mock_emit:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.infrastructure.hardware' has no attribute 'display_service'
________ TestDisplayStateManagerEventEmission.test_set_led4_emits_event ________
tests/unit/infrastructure/test_display_service.py:51: in test_set_led4_emits_event
    with patch("app.infrastructure.hardware.display_service.emit") as mock_emit:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.infrastructure.hardware' has no attribute 'display_service'
_______________ TestFileLock.test_prevents_concurrent_execution ________________
tests/unit/infrastructure/test_locking.py:60: in test_prevents_concurrent_execution
    assert "task2_timeout" in execution_order
E   AssertionError: assert 'task2_timeout' in ['task1_start', 'task1_end', 'task2_start', 'task2_end']
_________________ TestFileLock.test_handles_timeout_gracefully _________________
tests/unit/infrastructure/test_locking.py:88: in test_handles_timeout_gracefully
    assert timed_out
E   assert False
______________ TestFileLock.test_timeout_error_includes_lock_name ______________
tests/unit/infrastructure/test_locking.py:184: in test_timeout_error_includes_lock_name
    assert error_message is not None
E   assert None is not None
_______________ TestRunAutoDeploy.test_runs_script_successfully ________________
tests/unit/jobs/test_auto_deploy.py:28: in test_runs_script_successfully
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
________________ TestRunAutoDeploy.test_handles_missing_script _________________
tests/unit/jobs/test_auto_deploy.py:49: in test_handles_missing_script
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
________________ TestRunAutoDeploy.test_handles_script_failure _________________
tests/unit/jobs/test_auto_deploy.py:66: in test_handles_script_failure
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
_____________ TestRunAutoDeploy.test_logs_script_output_on_success _____________
tests/unit/jobs/test_auto_deploy.py:84: in test_logs_script_output_on_success
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
_____________ TestRunAutoDeploy.test_logs_error_on_script_failure ______________
tests/unit/jobs/test_auto_deploy.py:103: in test_logs_error_on_script_failure
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
__________ TestRunAutoDeploy.test_handles_exception_during_execution ___________
tests/unit/jobs/test_auto_deploy.py:119: in test_handles_exception_during_execution
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
____________ TestRunAutoDeploy.test_handles_empty_stdout_on_success ____________
tests/unit/jobs/test_auto_deploy.py:141: in test_handles_empty_stdout_on_success
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
____________ TestRunAutoDeploy.test_handles_empty_stderr_on_failure ____________
tests/unit/jobs/test_auto_deploy.py:157: in test_handles_empty_stderr_on_failure
    with patch("app.jobs.auto_deploy.AUTO_DEPLOY_SCRIPT", mock_script_path):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.auto_deploy' from '/Users/aristath/arduino-trader/app/jobs/auto_deploy.py'> does not have the attribute 'AUTO_DEPLOY_SCRIPT'
_______________ TestRunAutoDeploy.test_uses_correct_script_path ________________
tests/unit/jobs/test_auto_deploy.py:173: in test_uses_correct_script_path
    from app.jobs.auto_deploy import AUTO_DEPLOY_SCRIPT, run_auto_deploy
E   ImportError: cannot import name 'AUTO_DEPLOY_SCRIPT' from 'app.jobs.auto_deploy' (/Users/aristath/arduino-trader/app/jobs/auto_deploy.py)
___________ TestSyncCashFlowsInternal.test_skips_when_not_connected ____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:25: in test_skips_when_not_connected
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
__________ TestSyncCashFlowsInternal.test_handles_empty_transactions ___________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:46: in test_handles_empty_transactions
    patch("pass  # LED cleared") as mock_clear,
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
____________ TestSyncCashFlowsInternal.test_syncs_new_transactions _____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:98: in test_syncs_new_transactions
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
__________ TestSyncCashFlowsInternal.test_skips_existing_transactions __________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:136: in test_skips_existing_transactions
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_______________ TestSyncCashFlowsInternal.test_handles_exception _______________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:160: in test_handles_exception
    patch("pass  # LED cleared") as mock_clear,
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_________ TestSyncCashFlowsInternal.test_uses_amount_fallback_for_eur __________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:204: in test_uses_amount_fallback_for_eur
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_ TestDividendRecordCreation.test_creates_dividend_record_from_dividend_cash_flow _
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:299: in test_creates_dividend_record_from_dividend_cash_flow
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
____ TestDividendRecordCreation.test_links_dividend_record_to_cash_flow_id _____
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:362: in test_links_dividend_record_to_cash_flow_id
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_______ TestDividendRecordCreation.test_skips_existing_dividend_records ________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_cash_flow_sync.py:424: in test_skips_existing_dividend_records
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
___________ TestSyncPortfolioInternal.test_skips_when_not_connected ____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_daily_sync.py:216: in test_skips_when_not_connected
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_________ TestSyncPortfolioInternal.test_syncs_positions_successfully __________
tests/unit/jobs/test_daily_sync.py:272: in test_syncs_positions_successfully
    patch("app.jobs.daily_sync.sync_stock_currencies"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.daily_sync' from '/Users/aristath/arduino-trader/app/jobs/daily_sync.py'> does not have the attribute 'sync_stock_currencies'
_______________ TestSyncPricesInternal.test_skips_when_no_stocks _______________
tests/unit/jobs/test_daily_sync.py:321: in test_skips_when_no_stocks
    await _sync_prices_internal()
app/jobs/daily_sync.py:446: in _sync_prices_internal
    security_repo = SecurityRepository()
                    ^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:31: in __init__
    self._db = get_db_manager().config
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.daily_sync:daily_sync.py:497 Price sync failed: Database manager not initialized. Call init_databases() first.
_____________ TestSyncPricesInternal.test_syncs_prices_from_yahoo ______________
tests/unit/jobs/test_daily_sync.py:363: in test_syncs_prices_from_yahoo
    await _sync_prices_internal()
app/jobs/daily_sync.py:446: in _sync_prices_internal
    security_repo = SecurityRepository()
                    ^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:31: in __init__
    self._db = get_db_manager().config
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.daily_sync:daily_sync.py:497 Price sync failed: Database manager not initialized. Call init_databases() first.
_____________ TestSyncPricesInternal.test_handles_price_sync_error _____________
tests/unit/jobs/test_daily_sync.py:390: in test_handles_price_sync_error
    await _sync_prices_internal()
app/jobs/daily_sync.py:446: in _sync_prices_internal
    security_repo = SecurityRepository()
                    ^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:31: in __init__
    self._db = get_db_manager().config
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_daily_sync.py:389: in test_handles_price_sync_error
    with pytest.raises(Exception, match="Yahoo error"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Regex pattern did not match.
E     Expected regex: 'Yahoo error'
E     Actual message: 'Database manager not initialized. Call init_databases() first.'
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.daily_sync:daily_sync.py:497 Price sync failed: Database manager not initialized. Call init_databases() first.
____________ TestSyncStockCurrencies.test_skips_when_not_connected _____________
tests/unit/jobs/test_daily_sync.py:401: in test_skips_when_not_connected
    from app.jobs.daily_sync import sync_stock_currencies
E   ImportError: cannot import name 'sync_stock_currencies' from 'app.jobs.daily_sync' (/Users/aristath/arduino-trader/app/jobs/daily_sync.py)
______________ TestSyncStockCurrencies.test_skips_when_no_stocks _______________
tests/unit/jobs/test_daily_sync.py:421: in test_skips_when_no_stocks
    from app.jobs.daily_sync import sync_stock_currencies
E   ImportError: cannot import name 'sync_stock_currencies' from 'app.jobs.daily_sync' (/Users/aristath/arduino-trader/app/jobs/daily_sync.py)
_________ TestSyncStockCurrencies.test_syncs_currencies_from_tradernet _________
tests/unit/jobs/test_daily_sync.py:443: in test_syncs_currencies_from_tradernet
    from app.jobs.daily_sync import sync_stock_currencies
E   ImportError: cannot import name 'sync_stock_currencies' from 'app.jobs.daily_sync' (/Users/aristath/arduino-trader/app/jobs/daily_sync.py)
________ TestDividendGrouping.test_groups_multiple_dividends_by_symbol _________
tests/unit/jobs/test_dividend_reinvestment.py:202: in test_groups_multiple_dividends_by_symbol
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
________ TestDividendGrouping.test_sums_amounts_correctly_when_grouping ________
tests/unit/jobs/test_dividend_reinvestment.py:259: in test_sums_amounts_correctly_when_grouping
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
_ TestReinvestmentExecution.test_executes_trade_when_grouped_total_exceeds_min_trade_size _
tests/unit/jobs/test_dividend_reinvestment.py:306: in test_executes_trade_when_grouped_total_exceeds_min_trade_size
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
_ TestReinvestmentExecution.test_skips_trade_when_grouped_total_below_min_trade_size _
tests/unit/jobs/test_dividend_reinvestment.py:342: in test_skips_trade_when_grouped_total_below_min_trade_size
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
______ TestReinvestmentExecution.test_exactly_at_min_trade_size_executes _______
tests/unit/jobs/test_dividend_reinvestment.py:385: in test_exactly_at_min_trade_size_executes
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
__ TestDividendMarking.test_marks_all_dividend_records_reinvested_after_trade __
tests/unit/jobs/test_dividend_reinvestment.py:433: in test_marks_all_dividend_records_reinvested_after_trade
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
____ TestPendingBonus.test_sets_pending_bonus_for_small_ungrouped_dividends ____
tests/unit/jobs/test_dividend_reinvestment.py:479: in test_sets_pending_bonus_for_small_ungrouped_dividends
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
___________ TestErrorHandling.test_zero_dividends_handles_gracefully ___________
tests/unit/jobs/test_dividend_reinvestment.py:515: in test_zero_dividends_handles_gracefully
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
____________ TestErrorHandling.test_api_failure_does_not_crash_job _____________
tests/unit/jobs/test_dividend_reinvestment.py:550: in test_api_failure_does_not_crash_job
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
______ TestErrorHandling.test_invalid_price_skips_symbol_continues_others ______
tests/unit/jobs/test_dividend_reinvestment.py:602: in test_invalid_price_skips_symbol_continues_others
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
_ TestErrorHandling.test_trade_execution_failure_marks_dividends_unreinvested __
tests/unit/jobs/test_dividend_reinvestment.py:646: in test_trade_execution_failure_marks_dividends_unreinvested
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
_________ TestStateVerification.test_verify_no_duplicate_reinvestment __________
tests/unit/jobs/test_dividend_reinvestment.py:690: in test_verify_no_duplicate_reinvestment
    with mock_dividend_reinvestment_dependencies(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
tests/unit/jobs/test_dividend_reinvestment.py:101: in mock_dividend_reinvestment_dependencies
    patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.jobs' has no attribute 'dividend_reinvestment'
_ TestCheckAndRebalanceImmediately.test_returns_false_when_no_negative_balances _
tests/unit/jobs/test_emergency_rebalance.py:52: in test_returns_false_when_no_negative_balances
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
_ TestCheckAndRebalanceImmediately.test_triggers_rebalancing_with_negative_balance _
tests/unit/jobs/test_emergency_rebalance.py:107: in test_triggers_rebalancing_with_negative_balance
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
_ TestCheckAndRebalanceImmediately.test_triggers_rebalancing_with_currency_below_minimum _
tests/unit/jobs/test_emergency_rebalance.py:166: in test_triggers_rebalancing_with_currency_below_minimum
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
_ TestCheckAndRebalanceImmediately.test_dismisses_stale_emergency_recommendations _
tests/unit/jobs/test_emergency_rebalance.py:246: in test_dismisses_stale_emergency_recommendations
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
____ TestCheckAndRebalanceImmediately.test_handles_tradernet_not_connected _____
tests/unit/jobs/test_emergency_rebalance.py:302: in test_handles_tradernet_not_connected
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
__ TestCheckAndRebalanceImmediately.test_handles_tradernet_connection_failure __
tests/unit/jobs/test_emergency_rebalance.py:323: in test_handles_tradernet_connection_failure
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
_______ TestCheckAndRebalanceImmediately.test_handles_errors_gracefully ________
tests/unit/jobs/test_emergency_rebalance.py:343: in test_handles_errors_gracefully
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
_ TestCheckAndRebalanceImmediately.test_uses_file_lock_to_prevent_concurrent_execution _
tests/unit/jobs/test_emergency_rebalance.py:365: in test_uses_file_lock_to_prevent_concurrent_execution
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
_____ TestCheckAndRebalanceImmediately.test_handles_no_trading_currencies ______
tests/unit/jobs/test_emergency_rebalance.py:394: in test_handles_no_trading_currencies
    from app.jobs.emergency_rebalance import check_and_rebalance_immediately
E   ModuleNotFoundError: No module named 'app.jobs.emergency_rebalance'
____ TestWaitForPlanningCompletion.test_waits_until_all_sequences_evaluated ____
tests/unit/jobs/test_event_based_trading.py:64: in test_waits_until_all_sequences_evaluated
    await _wait_for_planning_completion()
app/jobs/event_based_trading.py:220: in _wait_for_planning_completion
    if not await planner_repo.has_sequences(portfolio_hash):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:340: in has_sequences
    db = await self._get_db()
         ^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:23: in _get_db
    self._db_manager = get_db_manager()
                       ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_____ TestWaitForPlanningCompletion.test_generates_sequences_if_not_exist ______
tests/unit/jobs/test_event_based_trading.py:109: in test_generates_sequences_if_not_exist
    await _wait_for_planning_completion()
app/jobs/event_based_trading.py:220: in _wait_for_planning_completion
    if not await planner_repo.has_sequences(portfolio_hash):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:340: in has_sequences
    db = await self._get_db()
         ^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:23: in _get_db
    self._db_manager = get_db_manager()
                       ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_______ TestWaitForPlanningCompletion.test_timeout_after_max_iterations ________
tests/unit/jobs/test_event_based_trading.py:150: in test_timeout_after_max_iterations
    await _wait_for_planning_completion()
app/jobs/event_based_trading.py:220: in _wait_for_planning_completion
    if not await planner_repo.has_sequences(portfolio_hash):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:340: in has_sequences
    db = await self._get_db()
         ^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:23: in _get_db
    self._db_manager = get_db_manager()
                       ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
__ TestGetOptimalRecommendation.test_returns_recommendation_from_best_result ___
tests/unit/jobs/test_event_based_trading.py:222: in test_returns_recommendation_from_best_result
    recommendation = await _get_optimal_recommendation()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/jobs/event_based_trading.py:531: in _get_optimal_recommendation
    best_result = await planner_repo.get_best_result(portfolio_hash)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:254: in get_best_result
    db = await self._get_db()
         ^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:23: in _get_db
    self._db_manager = get_db_manager()
                       ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_______ TestGetOptimalRecommendation.test_returns_none_if_no_best_result _______
tests/unit/jobs/test_event_based_trading.py:256: in test_returns_none_if_no_best_result
    recommendation = await _get_optimal_recommendation()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/jobs/event_based_trading.py:531: in _get_optimal_recommendation
    best_result = await planner_repo.get_best_result(portfolio_hash)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:254: in get_best_result
    db = await self._get_db()
         ^^^^^^^^^^^^^^^^^^^^
app/modules/planning/database/planner_repository.py:23: in _get_db
    self._db_manager = get_db_manager()
                       ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
______ TestMonitorPortfolioForChanges.test_detects_hash_change_in_phase_1 ______
tests/unit/jobs/test_event_based_trading.py:450: in test_detects_hash_change_in_phase_1
    assert result is True
E   assert False is True
______ TestMonitorPortfolioForChanges.test_detects_hash_change_in_phase_2 ______
tests/unit/jobs/test_event_based_trading.py:494: in test_detects_hash_change_in_phase_2
    assert result is True
E   assert False is True
____________ TestSyncHistoricalDataInternal.test_emits_sync_events _____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_historical_data_sync.py:49: in test_emits_sync_events
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
____________ TestSyncHistoricalDataInternal.test_handles_sync_error ____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_historical_data_sync.py:69: in test_handles_sync_error
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
____________ TestCreateBackupInternal.test_creates_backup_directory ____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_maintenance.py:54: in test_creates_backup_directory
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
______________ TestCreateBackupInternal.test_handles_backup_error ______________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_maintenance.py:76: in test_handles_backup_error
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
______________ TestIntegrityCheckInternal.test_passes_when_all_ok ______________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_maintenance.py:162: in test_passes_when_all_ok
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_______________ TestIntegrityCheckInternal.test_reports_failure ________________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_maintenance.py:191: in test_reports_failure
    patch("pass  # LED cleared"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
______ TestCalculateMetricsForAllStocks.test_processes_all_active_stocks _______
tests/unit/jobs/test_metrics_calculation.py:342: in test_processes_all_active_stocks
    with patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.metrics_calculation' from '/Users/aristath/arduino-trader/app/jobs/metrics_calculation.py'> does not have the attribute 'SecurityRepository'
_____________ TestCalculateMetricsForAllStocks.test_counts_errors ______________
tests/unit/jobs/test_metrics_calculation.py:368: in test_counts_errors
    with patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.metrics_calculation' from '/Users/aristath/arduino-trader/app/jobs/metrics_calculation.py'> does not have the attribute 'SecurityRepository'
___ TestCalculateMetricsForAllStocks.test_returns_empty_stats_for_no_stocks ____
tests/unit/jobs/test_metrics_calculation.py:390: in test_returns_empty_stats_for_no_stocks
    with patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1467: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.jobs.metrics_calculation' from '/Users/aristath/arduino-trader/app/jobs/metrics_calculation.py'> does not have the attribute 'SecurityRepository'
____________ TestTriggerNextBatchViaApi.test_triggers_api_endpoint _____________
tests/unit/jobs/test_planner_batch.py:67: in test_triggers_api_endpoint
    from app.jobs.planner_batch import _trigger_next_batch_via_api
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
________ TestTriggerNextBatchViaApi.test_handles_api_failure_gracefully ________
tests/unit/jobs/test_planner_batch.py:88: in test_handles_api_failure_gracefully
    from app.jobs.planner_batch import _trigger_next_batch_via_api
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
__ TestProcessPlannerBatchJob.test_generates_portfolio_hash_when_not_provided __
tests/unit/jobs/test_planner_batch.py:111: in test_generates_portfolio_hash_when_not_provided
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
_ TestProcessPlannerBatchJob.test_skips_scheduled_job_when_api_batches_active __
tests/unit/jobs/test_planner_batch.py:203: in test_skips_scheduled_job_when_api_batches_active
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
___ TestProcessPlannerBatchJob.test_uses_small_batch_size_in_api_driven_mode ___
tests/unit/jobs/test_planner_batch.py:253: in test_uses_small_batch_size_in_api_driven_mode
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
___ TestProcessPlannerBatchJob.test_uses_large_batch_size_in_scheduled_mode ____
tests/unit/jobs/test_planner_batch.py:339: in test_uses_large_batch_size_in_scheduled_mode
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
_ TestProcessPlannerBatchJob.test_self_triggers_next_batch_in_api_driven_mode __
tests/unit/jobs/test_planner_batch.py:425: in test_self_triggers_next_batch_in_api_driven_mode
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
______ TestProcessPlannerBatchJob.test_stops_self_triggering_at_max_depth ______
tests/unit/jobs/test_planner_batch.py:514: in test_stops_self_triggering_at_max_depth
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
______ TestProcessPlannerBatchJob.test_emits_planner_batch_complete_event ______
tests/unit/jobs/test_planner_batch.py:606: in test_emits_planner_batch_complete_event
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
__________ TestProcessPlannerBatchJob.test_handles_errors_gracefully ___________
tests/unit/jobs/test_planner_batch.py:728: in test_handles_errors_gracefully
    from app.jobs.planner_batch import process_planner_batch_job
E   ModuleNotFoundError: No module named 'app.jobs.planner_batch'
____________ TestInitScheduler.test_schedules_stocks_data_sync_job _____________
tests/unit/jobs/test_scheduler.py:373: in test_schedules_stocks_data_sync_job
    assert pipeline_job is not None
E   assert None is not None
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
_______________ TestInitScheduler.test_logs_initialization_info ________________
tests/unit/jobs/test_scheduler.py:462: in test_logs_initialization_info
    mock_logger.info.assert_called_once()
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:958: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected 'info' to have been called once. Called 3 times.
E   Calls: [call('Bucket reconciliation job added to scheduler'),
E    call('Started event-based trading loop as background task'),
E    call('Scheduler initialized with 9 scheduled jobs + 1 background task - sync_cycle:5m, securities_data_sync:1h, maintenance:3:00, dividend_reinvestment:3:30, bucket_reconciliation:3:45, planner_batch:30m (fallback), display_ticker_update:10s, auto_deploy:5m, event_based_trading:background')].
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
________________ TestInitScheduler.test_replaces_existing_jobs _________________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2324: in _execute_mock_call
    result = next(effect)
             ^^^^^^^^^^^^
E   StopIteration

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_scheduler.py:493: in test_replaces_existing_jobs
    await init_scheduler()
app/jobs/scheduler.py:143: in init_scheduler
    job_settings = await _get_job_settings()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
app/jobs/scheduler.py:82: in _get_job_settings
    await settings_repo.get_float("job_sync_cycle_minutes", 5.0)
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2328: in _execute_mock_call
    raise StopAsyncIteration
E   StopAsyncIteration
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
_____ TestRescheduleAllJobs.test_reschedules_sync_cycle_with_new_interval ______
tests/unit/jobs/test_scheduler.py:564: in test_reschedules_sync_cycle_with_new_interval
    assert len(jobs) == 8
E   assert 9 == 8
E    +  where 9 = len([<Job (id=sync_cycle name=Sync Cycle)>, <Job (id=securities_data_sync name=Securities Data Sync)>, <Job (id=planner_batch name=Planner Batch (Fallback))>, <Job (id=daily_maintenance name=Daily Maintenance)>, <Job (id=weekly_maintenance name=Weekly Maintenance)>, <Job (id=dividend_reinvestment name=Dividend Reinvestment)>, ...])
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
___________ TestRescheduleAllJobs.test_reschedules_maintenance_jobs ____________
tests/unit/jobs/test_scheduler.py:602: in test_reschedules_maintenance_jobs
    assert len(jobs) == 8
E   assert 9 == 8
E    +  where 9 = len([<Job (id=sync_cycle name=Sync Cycle)>, <Job (id=securities_data_sync name=Securities Data Sync)>, <Job (id=planner_batch name=Planner Batch (Fallback))>, <Job (id=daily_maintenance name=Daily Maintenance)>, <Job (id=weekly_maintenance name=Weekly Maintenance)>, <Job (id=dividend_reinvestment name=Dividend Reinvestment)>, ...])
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
_______________ TestRescheduleAllJobs.test_logs_reschedule_info ________________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2324: in _execute_mock_call
    result = next(effect)
             ^^^^^^^^^^^^
E   StopIteration

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_scheduler.py:628: in test_logs_reschedule_info
    await reschedule_all_jobs()
app/jobs/scheduler.py:374: in reschedule_all_jobs
    job_settings = await _get_job_settings()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
app/jobs/scheduler.py:82: in _get_job_settings
    await settings_repo.get_float("job_sync_cycle_minutes", 5.0)
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2328: in _execute_mock_call
    raise StopAsyncIteration
E   StopAsyncIteration
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
____________ TestEdgeCases.test_reschedule_all_jobs_multiple_times _____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2324: in _execute_mock_call
    result = next(effect)
             ^^^^^^^^^^^^
E   StopIteration

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_scheduler.py:992: in test_reschedule_all_jobs_multiple_times
    await reschedule_all_jobs()
app/jobs/scheduler.py:374: in reschedule_all_jobs
    job_settings = await _get_job_settings()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^
app/jobs/scheduler.py:85: in _get_job_settings
    await settings_repo.get_float("job_maintenance_hour", 3.0)
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2328: in _execute_mock_call
    raise StopAsyncIteration
E   StopAsyncIteration
------------------------------ Captured log call -------------------------------
ERROR    app.jobs.event_based_trading:event_based_trading.py:153 Event-based trading loop failed: Database manager not initialized. Call init_databases() first.
Traceback (most recent call last):
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 60, in _run_event_based_trading_loop_internal
    await _wait_for_planning_completion()
  File "/Users/aristath/arduino-trader/app/jobs/event_based_trading.py", line 186, in _wait_for_planning_completion
    position_repo = PositionRepository()
  File "/Users/aristath/arduino-trader/app/modules/portfolio/database/position_repository.py", line 31, in __init__
    self._manager = get_db_manager()
                    ~~~~~~~~~~~~~~^^
  File "/Users/aristath/arduino-trader/app/core/database/manager.py", line 371, in get_db_manager
    raise RuntimeError(
        "Database manager not initialized. Call init_databases() first."
    )
RuntimeError: Database manager not initialized. Call init_databases() first.
___________________ TestRefreshAllScores.test_uses_file_lock ___________________
tests/unit/jobs/test_score_refresh.py:18: in test_uses_file_lock
    from app.jobs.score_refresh import refresh_all_scores
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
__________ TestRefreshAllScoresInternal.test_handles_no_active_stocks __________
tests/unit/jobs/test_score_refresh.py:38: in test_handles_no_active_stocks
    from app.jobs.score_refresh import _refresh_all_scores_internal
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
________________ TestRefreshAllScoresInternal.test_emits_events ________________
tests/unit/jobs/test_score_refresh.py:56: in test_emits_events
    from app.jobs.score_refresh import _refresh_all_scores_internal
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
____ TestRefreshAllScoresInternal.test_skips_stocks_with_insufficient_data _____
tests/unit/jobs/test_score_refresh.py:75: in test_skips_stocks_with_insufficient_data
    from app.jobs.score_refresh import _refresh_all_scores_internal
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
_____ TestRefreshAllScoresInternal.test_handles_scoring_errors_gracefully ______
tests/unit/jobs/test_score_refresh.py:108: in test_handles_scoring_errors_gracefully
    from app.jobs.score_refresh import _refresh_all_scores_internal
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
_________ TestBuildPortfolioContext.test_builds_context_with_positions _________
tests/unit/jobs/test_score_refresh.py:140: in test_builds_context_with_positions
    from app.jobs.score_refresh import _build_portfolio_context
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
____ TestBuildPortfolioContext.test_builds_context_with_allocation_targets _____
tests/unit/jobs/test_score_refresh.py:200: in test_builds_context_with_allocation_targets
    from app.jobs.score_refresh import _build_portfolio_context
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
___________ TestGetDailyPrices.test_returns_local_data_if_sufficient ___________
tests/unit/jobs/test_score_refresh.py:278: in test_returns_local_data_if_sufficient
    from app.jobs.score_refresh import _get_daily_prices
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
__________ TestGetDailyPrices.test_fetches_from_yahoo_if_insufficient __________
tests/unit/jobs/test_score_refresh.py:297: in test_fetches_from_yahoo_if_insufficient
    from app.jobs.score_refresh import _get_daily_prices
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
__________ TestGetMonthlyPrices.test_returns_local_data_if_sufficient __________
tests/unit/jobs/test_score_refresh.py:337: in test_returns_local_data_if_sufficient
    from app.jobs.score_refresh import _get_monthly_prices
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
_______ TestGetMonthlyPrices.test_aggregates_from_yahoo_if_insufficient ________
tests/unit/jobs/test_score_refresh.py:355: in test_aggregates_from_yahoo_if_insufficient
    from app.jobs.score_refresh import _get_monthly_prices
E   ModuleNotFoundError: No module named 'app.jobs.score_refresh'
_____________ TestStocksDataSync.test_processes_only_stale_stocks ______________
tests/unit/jobs/test_securities_data_sync.py:22: in test_processes_only_stale_stocks
    from app.jobs.securities_data_sync import _get_stocks_needing_sync
E   ImportError: cannot import name '_get_stocks_needing_sync' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
____________ TestStocksDataSync.test_processes_stocks_sequentially _____________
tests/unit/jobs/test_securities_data_sync.py:50: in test_processes_stocks_sequentially
    from app.jobs.securities_data_sync import run_stocks_data_sync
E   ImportError: cannot import name 'run_stocks_data_sync' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
___________ TestStocksDataSync.test_skips_all_when_all_stocks_fresh ____________
tests/unit/jobs/test_securities_data_sync.py:88: in test_skips_all_when_all_stocks_fresh
    from app.jobs.securities_data_sync import run_stocks_data_sync
E   ImportError: cannot import name 'run_stocks_data_sync' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
_____________ TestProcessSingleStock.test_runs_all_steps_for_stock _____________
tests/unit/jobs/test_securities_data_sync.py:124: in test_runs_all_steps_for_stock
    from app.jobs.securities_data_sync import _process_single_stock
E   ImportError: cannot import name '_process_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
__________ TestProcessSingleStock.test_updates_last_synced_on_success __________
tests/unit/jobs/test_securities_data_sync.py:179: in test_updates_last_synced_on_success
    from app.jobs.securities_data_sync import _process_single_stock
E   ImportError: cannot import name '_process_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
_______ TestProcessSingleStock.test_does_not_update_last_synced_on_error _______
tests/unit/jobs/test_securities_data_sync.py:223: in test_does_not_update_last_synced_on_error
    from app.jobs.securities_data_sync import _process_single_stock
E   ImportError: cannot import name '_process_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
________________ TestDisplayUpdates.test_shows_updating_message ________________
tests/unit/jobs/test_securities_data_sync.py:270: in test_shows_updating_message
    from app.jobs.securities_data_sync import _process_single_stock
E   ImportError: cannot import name '_process_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
__________ TestDisplayUpdates.test_clears_processing_after_completion __________
tests/unit/jobs/test_securities_data_sync.py:317: in test_clears_processing_after_completion
    from app.jobs.securities_data_sync import _process_single_stock
E   ImportError: cannot import name '_process_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
___________ TestForceRefresh.test_force_refresh_bypasses_last_synced ___________
tests/unit/jobs/test_securities_data_sync.py:367: in test_force_refresh_bypasses_last_synced
    from app.jobs.securities_data_sync import refresh_single_stock
E   ImportError: cannot import name 'refresh_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
_________ TestForceRefresh.test_force_refresh_returns_error_on_failure _________
tests/unit/jobs/test_securities_data_sync.py:424: in test_force_refresh_returns_error_on_failure
    from app.jobs.securities_data_sync import refresh_single_stock
E   ImportError: cannot import name 'refresh_single_stock' from 'app.jobs.securities_data_sync' (/Users/aristath/arduino-trader/app/jobs/securities_data_sync.py)
__________________ TestSyncCycle.test_runs_all_steps_in_order __________________
tests/unit/jobs/test_sync_cycle.py:25: in test_runs_all_steps_in_order
    from app.jobs.sync_cycle import run_sync_cycle
E   ModuleNotFoundError: No module named 'app.jobs.sync_cycle'
_____________ TestSyncCycle.test_skips_trade_execution_when_halted _____________
tests/unit/jobs/test_sync_cycle.py:99: in test_skips_trade_execution_when_halted
    from app.jobs.sync_cycle import run_sync_cycle
E   ModuleNotFoundError: No module named 'app.jobs.sync_cycle'
_________ TestStepSyncPrices.test_only_fetches_prices_for_open_markets _________
tests/unit/jobs/test_sync_cycle.py:146: in test_only_fetches_prices_for_open_markets
    from app.jobs.sync_cycle import _step_sync_prices
E   ModuleNotFoundError: No module named 'app.jobs.sync_cycle'
____________ TestStepSyncPrices.test_skips_all_when_no_markets_open ____________
tests/unit/jobs/test_sync_cycle.py:202: in test_skips_all_when_no_markets_open
    from app.jobs.sync_cycle import _step_sync_prices
E   ModuleNotFoundError: No module named 'app.jobs.sync_cycle'
_____________ TestStepGetRecommendation.test_considers_all_markets _____________
tests/unit/jobs/test_sync_cycle.py:405: in test_considers_all_markets
    from app.jobs.sync_cycle import _step_get_recommendation
E   ModuleNotFoundError: No module named 'app.jobs.sync_cycle'
________________ TestStepUpdateDisplay.test_updates_ticker_text ________________
tests/unit/jobs/test_sync_cycle.py:431: in test_updates_ticker_text
    from app.jobs.sync_cycle import _step_update_display
E   ModuleNotFoundError: No module named 'app.jobs.sync_cycle'
_____________ TestSyncTradesInternal.test_skips_when_not_connected _____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_sync_trades.py:246: in test_skips_when_not_connected
    with patch("pass  # LED cleared"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
____________ TestSyncTradesInternal.test_handles_no_trades_returned ____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_sync_trades.py:266: in test_handles_no_trades_returned
    with patch("pass  # LED cleared"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_______________ TestSyncTradesInternal.test_inserts_valid_trades _______________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_sync_trades.py:308: in test_inserts_valid_trades
    with patch("pass  # LED cleared"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
____________ TestSyncTradesInternal.test_handles_errors_gracefully _____________
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1673: in _get_target
    target, attribute = target.rsplit('.', 1)
    ^^^^^^^^^^^^^^^^^
E   ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:
tests/unit/jobs/test_sync_trades.py:328: in test_handles_errors_gracefully
    with patch("pass  # LED cleared"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1833: in patch
    getter, attribute = _get_target(target)
                        ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1675: in _get_target
    raise TypeError(
E   TypeError: Need a valid target to patch. You supplied: 'pass  # LED cleared'
_________________________ test_get_enabled_generators __________________________
tests/unit/planning/domain/config/test_models.py:137: in test_get_enabled_generators
    assert len(enabled) == 1
E   AssertionError: assert 3 == 1
E    +  where 3 = len(['enhanced_combinatorial', 'partial_execution', 'constraint_relaxation'])
___________________________ test_get_enabled_filters ___________________________
tests/unit/planning/domain/config/test_models.py:148: in test_get_enabled_filters
    assert len(enabled) == 1
E   AssertionError: assert 4 == 1
E    +  where 4 = len(['correlation_aware', 'diversity', 'eligibility', 'recently_traded'])
________________________ test_load_conservative_example ________________________
tests/unit/planning/domain/config/test_parser.py:226: in test_load_conservative_example
    assert "rebalance" not in enabled_patterns  # Should be disabled
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: assert 'rebalance' not in ['direct_buy', 'profit_taking', 'rebalance', 'single_best', 'opportunity_first', 'cash_generation', ...]
_________________ TestValidateToml.test_invalid_toml_structure _________________
tests/unit/planning/test_planner_config_service.py:101: in test_invalid_toml_structure
    assert result["valid"] is False
E   assert True is False
_______________________ TestUpdate.test_update_name_only _______________________
tests/unit/planning/test_planner_config_service.py:230: in test_update_name_only
    mock_repository.update.assert_called_once_with(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:991: in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:979: in assert_called_with
    raise AssertionError(_error_message()) from cause
E   AssertionError: expected call not found.
E   Expected: update('test-id', name='New Name Only', toml_config=None, create_backup=True)
E     Actual: update('test-id', name='New Name Only', toml_config=None, bucket_id=None, create_backup=True)
____ TestPositionRepositoryGetWithStockInfo.test_get_with_stock_info_empty _____
tests/unit/repositories/test_position.py:301: in test_get_with_stock_info_empty
    result = await repo.get_with_stock_info()
                   ^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'PositionRepository' object has no attribute 'get_with_stock_info'. Did you mean: 'get_with_security_info'?
_ TestPositionRepositoryGetWithStockInfo.test_get_with_stock_info_merges_data __
tests/unit/repositories/test_position.py:362: in test_get_with_stock_info_merges_data
    result = await repo.get_with_stock_info()
                   ^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'PositionRepository' object has no attribute 'get_with_stock_info'. Did you mean: 'get_with_security_info'?
___________________ TestScoreRepository.test_init_without_db ___________________
tests/unit/repositories/test_score_repository.py:328: in test_init_without_db
    assert repo._db == mock_state
E   AssertionError: assert <MagicMock na...='4726334400'> == <MagicMock na...='4726340112'>
E
E     Full diff:
E     - <MagicMock name='get_db_manager().state' id='4726340112'>
E     ?                                   ^^  ^             ^^^
E     + <MagicMock name='get_db_manager().calculations' id='4726334400'>
E     ?                                   ^^^^^^  ^^^^           ++  ^
____________ TestSecurityRepositoryQueries.test_get_by_symbol_found ____________
tests/unit/repositories/test_security.py:69: in test_get_by_symbol_found
    result = await repo.get_by_symbol("AAPL.US")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:40: in get_by_symbol
    return self._row_to_security(row)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:284: in _row_to_security
    return Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL.US must have product_type set. Run backfill script or set manually via API.
______________ TestSecurityRepositoryQueries.test_get_all_active _______________
tests/unit/repositories/test_security.py:128: in test_get_all_active
    result = await repo.get_all_active()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:77: in get_all_active
    return [self._row_to_security(row) for row in rows]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:284: in _row_to_security
    return Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL.US must have product_type set. Run backfill script or set manually via API.
__________________ TestSecurityRepositoryQueries.test_get_all __________________
tests/unit/repositories/test_security.py:159: in test_get_all
    result = await repo.get_all()
             ^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:82: in get_all
    return [self._row_to_security(row) for row in rows]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/universe/database/security_repository.py:284: in _row_to_security
    return Security(
<string>:21: in __init__
    ???
app/domain/models.py:97: in __post_init__
    raise ValidationError(
E   app.domain.exceptions.ValidationError: Validation error: Active security AAPL.US must have product_type set. Run backfill script or set manually via API.
__ TestSecurityRepositoryGetWithScores.test_merges_stock_score_position_data ___
tests/unit/repositories/test_security.py:460: in test_merges_stock_score_position_data
    with patch(
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:1481: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.modules.universe.database' has no attribute 'stock_repository'
____________________ TestRowToStock.test_converts_valid_row ____________________
tests/unit/repositories/test_security.py:499: in test_converts_valid_row
    result = repo._row_to_stock(row_mock)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SecurityRepository' object has no attribute '_row_to_stock'
_____________ TestRowToStock.test_handles_null_priority_multiplier _____________
tests/unit/repositories/test_security.py:532: in test_handles_null_priority_multiplier
    result = repo._row_to_stock(row_mock)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SecurityRepository' object has no attribute '_row_to_stock'
___________ TestRowToStock.test_row_to_stock_maps_portfolio_targets ____________
tests/unit/repositories/test_security.py:566: in test_row_to_stock_maps_portfolio_targets
    result = repo._row_to_stock(row_mock)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SecurityRepository' object has no attribute '_row_to_stock'
_______ TestRowToStock.test_row_to_stock_handles_null_portfolio_targets ________
tests/unit/repositories/test_security.py:598: in test_row_to_stock_handles_null_portfolio_targets
    result = repo._row_to_stock(row_mock)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SecurityRepository' object has no attribute '_row_to_stock'
__ TestRowToStock.test_row_to_stock_handles_missing_portfolio_target_columns ___
tests/unit/repositories/test_security.py:628: in test_row_to_stock_handles_missing_portfolio_target_columns
    result = repo._row_to_stock(row_mock)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SecurityRepository' object has no attribute '_row_to_stock'
____________________ TestEdgeCases.test_target_exceeds_one _____________________
tests/unit/services/optimization/test_constraints_manager.py:958: in test_target_exceeds_one
    assert len(country_constraints) == 1
E   assert 0 == 1
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestTargetNormalization.test_industry_targets_normalized_when_sum_exceeds_100 _
tests/unit/services/optimization/test_constraints_manager.py:1215: in test_industry_targets_normalized_when_sum_exceeds_100
    assert tech_constraint.target == pytest.approx(0.8 / 1.5, abs=0.001)
E   assert 0.8 == 0.5333333333333333  0.001
E
E     comparison failed
E     Obtained: 0.8
E     Expected: 0.5333333333333333  0.001
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:428 Industry constraint minimum bounds sum to 120.00% > 100%, scaling down proportionally to 100%
_ TestTargetNormalization.test_country_targets_normalized_when_sum_exceeds_100 _
tests/unit/services/optimization/test_constraints_manager.py:1256: in test_country_targets_normalized_when_sum_exceeds_100
    assert us_constraint.target == pytest.approx(0.8 / 1.2, abs=0.001)
E   assert 0.8 == 0.6666666666666667  0.001
E
E     comparison failed
E     Obtained: 0.8
E     Expected: 0.6666666666666667  0.001
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestTargetNormalization.test_normalization_only_applies_to_active_industries _
tests/unit/services/optimization/test_constraints_manager.py:1317: in test_normalization_only_applies_to_active_industries
    assert ind_constraints[0].target == pytest.approx(1.0, abs=0.001)
E   assert 0.8 == 1.0  0.001
E
E     comparison failed
E     Obtained: 0.8
E     Expected: 1.0  0.001
_ TestTargetNormalization.test_normalization_only_applies_to_active_countries __
tests/unit/services/optimization/test_constraints_manager.py:1350: in test_normalization_only_applies_to_active_countries
    assert country_constraints[0].target == pytest.approx(1.0, abs=0.001)
E   assert 0.8 == 1.0  0.001
E
E     comparison failed
E     Obtained: 0.8
E     Expected: 1.0  0.001
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestIndustryConcentrationCapAdjustment.test_single_industry_gets_70_percent_cap _
tests/unit/services/optimization/test_constraints_manager.py:1368: in test_single_industry_gets_70_percent_cap
    assert len(ind_constraints) == 1
E   assert 0 == 1
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestIndustryConcentrationCapAdjustment.test_two_industries_get_50_percent_cap_each _
tests/unit/services/optimization/test_constraints_manager.py:1390: in test_two_industries_get_50_percent_cap_each
    assert len(ind_constraints) == 2
E   assert 0 == 2
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestIndustryConcentrationCapAdjustment.test_three_plus_industries_get_default_30_percent_cap _
tests/unit/services/optimization/test_constraints_manager.py:1414: in test_three_plus_industries_get_default_30_percent_cap
    assert len(ind_constraints) == 3
E   assert 0 == 3
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestIndustryConcentrationCapAdjustment.test_industry_cap_adjustment_allows_higher_total_allocation _
tests/unit/services/optimization/test_constraints_manager.py:1438: in test_industry_cap_adjustment_allows_higher_total_allocation
    assert total_max == pytest.approx(1.0, abs=0.001)
E   assert 0 == 1.0  0.001
E
E     comparison failed
E     Obtained: 0
E     Expected: 1.0  0.001
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestIndustryMinimumBoundScaling.test_industry_minimum_bounds_scaled_when_sum_exceeds_100 _
tests/unit/services/optimization/test_constraints_manager.py:1461: in test_industry_minimum_bounds_scaled_when_sum_exceeds_100
    assert len(ind_constraints) == 2
E   assert 0 == 2
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
_ TestIndustryMinimumBoundScaling.test_industry_minimum_bounds_not_scaled_when_combined_below_70 _
tests/unit/services/optimization/test_constraints_manager.py:1518: in test_industry_minimum_bounds_not_scaled_when_combined_below_70
    assert country_min_sum == pytest.approx(0.2, abs=0.01)
E   assert 0 == 0.2  0.01
E
E     comparison failed
E     Obtained: 0
E     Expected: 0.2  0.01
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.constraints_manager:constraints_manager.py:234 No grouping repository available - no industry groups will be used
________ TestRiskModelBuilder.test_builds_covariance_matrix_from_prices ________
tests/unit/services/optimization/test_risk_models.py:78: in test_builds_covariance_matrix_from_prices
    assert cov_matrix is not None
E   assert None is not None
------------------------------ Captured log call -------------------------------
WARNING  app.modules.optimization.services.risk_models:risk_models.py:55 Only 0 symbols have sufficient history
_______________ TestRiskModelBuilder.test_filters_valid_symbols ________________
tests/unit/services/optimization/test_risk_models.py:179: in test_filters_valid_symbols
    cov_matrix, returns_df = await builder.build_covariance_matrix(symbols)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/optimization/services/risk_models.py:46: in build_covariance_matrix
    prices_df = await self._fetch_prices(symbols, lookback_days)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/modules/optimization/services/risk_models.py:113: in _fetch_prices
    df.index = pd.to_datetime(df.index)
               ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/tools/datetimes.py:1081: in to_datetime
    result = convert_listlike(arg, format, name=arg.name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/tools/datetimes.py:435: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/tools/datetimes.py:469: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pandas/_libs/tslibs/strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
pandas/_libs/tslibs/strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
pandas/_libs/tslibs/strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%Y-%m-%d": "2", at position 31. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
___ TestAdjustCountryWeights.test_decreases_weight_for_negative_attribution ____
tests/unit/services/test_performance_adjustment_calculator.py:88: in test_decreases_weight_for_negative_attribution
    assert adjusted["EU"] > base_weights["EU"]
E   assert 0.36000000000000004 > 0.4
_____ TestAdjustIndWeights.test_decreases_weight_for_negative_attribution ______
tests/unit/services/test_performance_adjustment_calculator.py:187: in test_decreases_weight_for_negative_attribution
    assert adjusted["Finance"] > base_weights["Finance"]
E   assert 0.18000000000000002 > 0.2
_______ TestPortfolioServiceCalculations.test_single_country_100_percent _______
tests/unit/services/test_portfolio_service.py:63: in test_single_country_100_percent
    assert summary.total_value == 1000
E   assert 0.0 == 1000
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=0.0, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
___ TestPortfolioServiceCalculations.test_multiple_countries_split_correctly ___
tests/unit/services/test_portfolio_service.py:96: in test_multiple_countries_split_correctly
    assert summary.total_value == 1000
E   assert 0.0 == 1000
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=0.0, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
__ TestPortfolioServiceCalculations.test_multi_industry_splits_value_equally ___
tests/unit/services/test_portfolio_service.py:133: in test_multi_industry_splits_value_equally
    assert ind_by_name["Technology"].current_value == pytest.approx(500, abs=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'Technology'
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
________ TestPortfolioServiceCalculations.test_missing_country_handled _________
tests/unit/services/test_portfolio_service.py:179: in test_missing_country_handled
    assert summary.total_value == 1000
E   assert 0.0 == 1000
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=0.0, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
________ TestPortfolioServiceCalculations.test_missing_industry_handled ________
tests/unit/services/test_portfolio_service.py:205: in test_missing_industry_handled
    assert summary.total_value == 1000
E   assert 0.0 == 1000
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=0.0, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
_ TestPortfolioServiceCalculations.test_fallback_to_price_calculation_when_no_eur_value _
tests/unit/services/test_portfolio_service.py:233: in test_fallback_to_price_calculation_when_no_eur_value
    assert summary.total_value == 500
E   assert 0.0 == 500
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=0.0, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
_________ TestPortfolioServiceCalculations.test_cash_balance_included __________
tests/unit/services/test_portfolio_service.py:259: in test_cash_balance_included
    assert summary.total_value == 1000  # Cash not included in total_value
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 0.0 == 1000
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=5000.5, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
_____ TestPortfolioServiceCalculations.test_deviation_calculated_correctly _____
tests/unit/services/test_portfolio_service.py:296: in test_deviation_calculated_correctly
    assert country_by_name["Germany"].current_pct == pytest.approx(0.7, abs=0.01)
E   assert 0 == 0.7  0.01
E
E     comparison failed
E     Obtained: 0
E     Expected: 0.7  0.01
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
________ TestPortfolioServiceCalculations.test_values_rounded_correctly ________
tests/unit/services/test_portfolio_service.py:329: in test_values_rounded_correctly
    assert summary.total_value == 1000.0  # Rounded to 2 decimal places
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 0.0 == 1000.0
E    +  where 0.0 = PortfolioSummary(total_value=0.0, cash_balance=0.0, country_allocations=[], industry_allocations=[]).total_value
------------------------------ Captured log call -------------------------------
WARNING  app.modules.portfolio.services.portfolio_service:portfolio_service.py:186 Failed to get cash balance from Tradernet: Database manager not initialized. Call init_databases() first., using snapshot
____ TestGetTechnicalDataForPositions.test_each_symbol_gets_technical_data _____
tests/unit/services/test_technical_data_calculator.py:440: in test_each_symbol_gets_technical_data
    assert result["AAPL"] != result["MSFT"]
E   assert TechnicalData(current_volatility=0.16, historical_volatility=0.21, distance_from_ma_200=0.08) != TechnicalData(current_volatility=0.16, historical_volatility=0.21, distance_from_ma_200=0.08)
________ TestTradeValidation.test_buy_blocked_when_insufficient_balance ________
tests/unit/services/test_trade_execution.py:124: in test_buy_blocked_when_insufficient_balance
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
__________ TestTradeValidation.test_buy_blocked_when_negative_balance __________
tests/unit/services/test_trade_execution.py:163: in test_buy_blocked_when_negative_balance
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_________ TestTradeValidation.test_buy_allowed_when_sufficient_balance _________
tests/unit/services/test_trade_execution.py:202: in test_buy_allowed_when_sufficient_balance
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
____________ TestTradeValidation.test_sell_blocked_when_no_position ____________
tests/unit/services/test_trade_execution.py:243: in test_sell_blocked_when_no_position
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_____ TestTradeValidation.test_sell_blocked_when_quantity_exceeds_position _____
tests/unit/services/test_trade_execution.py:281: in test_sell_blocked_when_quantity_exceeds_position
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_____ TestTradeValidation.test_sell_allowed_when_quantity_within_position ______
tests/unit/services/test_trade_execution.py:320: in test_sell_allowed_when_quantity_within_position
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_______ TestTradeValidation.test_broker_connection_failure_raises_error ________
tests/unit/services/test_trade_execution.py:356: in test_broker_connection_failure_raises_error
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
______________ TestTradeValidation.test_multi_currency_validation ______________
tests/unit/services/test_trade_execution.py:384: in test_multi_currency_validation
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_______________ TestTradeValidation.test_order_failure_recorded ________________
tests/unit/services/test_trade_execution.py:431: in test_order_failure_recorded
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_______ TestTradeValidation.test_no_validation_without_currency_balances _______
tests/unit/services/test_trade_execution.py:463: in test_no_validation_without_currency_balances
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
_____ TestTradeValidation.test_sell_blocked_when_recent_order_in_database ______
tests/unit/services/test_trade_execution.py:508: in test_sell_blocked_when_recent_order_in_database
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
______ TestTradeValidation.test_order_stored_immediately_after_placement _______
tests/unit/services/test_trade_execution.py:542: in test_order_stored_immediately_after_placement
    service = TradeExecutionService(
app/modules/trading/services/trade_execution_service.py:678: in __init__
    self._balance_service = BalanceService() if BALANCE_SERVICE_AVAILABLE else None
                            ^^^^^^^^^^^^^^^^
app/modules/satellites/services/balance_service.py:32: in __init__
    self._balance_repo = balance_repo or BalanceRepository()
                                         ^^^^^^^^^^^^^^^^^^^
app/modules/satellites/database/balance_repository.py:19: in __init__
    self._db = get_db_manager().satellites
               ^^^^^^^^^^^^^^^^
app/core/database/manager.py:371: in get_db_manager
    raise RuntimeError(
E   RuntimeError: Database manager not initialized. Call init_databases() first.
__________________ test_validate_trade_sell_blocks_recent_buy __________________
tests/unit/services/test_trade_safety_service.py:236: in test_validate_trade_sell_blocks_recent_buy
    assert "held only" in error.lower() or "minimum" in error.lower()
E   assert ('held only' in "market closed for <asyncmock name='mock.get_by_symbol().fullexchangename' id='4728152352'>" or 'minimum' in "market closed for <asyncmock name='mock.get_by_symbol().fullexchangename' id='4728152352'>")
E    +  where "market closed for <asyncmock name='mock.get_by_symbol().fullexchangename' id='4728152352'>" = <built-in method lower of str object at 0x11a57d8f0>()
E    +    where <built-in method lower of str object at 0x11a57d8f0> = "Market closed for <AsyncMock name='mock.get_by_symbol().fullExchangeName' id='4728152352'>".lower
E    +  and   "market closed for <asyncmock name='mock.get_by_symbol().fullexchangename' id='4728152352'>" = <built-in method lower of str object at 0x11a57d8f0>()
E    +    where <built-in method lower of str object at 0x11a57d8f0> = "Market closed for <AsyncMock name='mock.get_by_symbol().fullExchangeName' id='4728152352'>".lower
=============================== warnings summary ===============================
app/modules/satellites/api/satellites.py:86
  /Users/aristath/arduino-trader/app/modules/satellites/api/satellites.py:86: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class BucketResponse(BaseModel):

app/modules/satellites/api/satellites.py:130
  /Users/aristath/arduino-trader/app/modules/satellites/api/satellites.py:130: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SettingsResponse(BaseModel):

tests/integration/test_external_api_failures.py::test_portfolio_sync_handles_api_failure
  /Users/aristath/arduino-trader/app/infrastructure/external/tradernet/client.py:68: DeprecationWarning: TraderNetAPI is deprecated, use Tradernet instead
    client = TraderNetAPI(

tests/unit/api/test_portfolio.py::TestGetPortfolio::test_returns_positions_with_stock_info
  /opt/homebrew/Cellar/python@3.13/3.13.9/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:2247: RuntimeWarning: coroutine 'TestStreamPlannerStatus.test_handles_stream_errors.<locals>.mock_subscribe' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/api/test_portfolio.py::TestGetPortfolioAnalytics::test_returns_analytics
  /Users/aristath/arduino-trader/app/modules/portfolio/api/portfolio.py:62: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.
    monthly_returns = returns.resample("M").apply(lambda x: (1 + x).prod() - 1)

tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_portfolio_value
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_cash_balance
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_value_setting
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_none_snapshot
  /Users/aristath/arduino-trader/app/domain/value_objects/settings.py:72: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    target_annual_return=get_float("target_annual_return", 0.11),
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_portfolio_value
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_cash_balance
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_value_setting
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_none_snapshot
  /Users/aristath/arduino-trader/app/domain/value_objects/settings.py:73: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    min_security_score=get_float("min_security_score", 0.5),
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_portfolio_value
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_cash_balance
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_value_setting
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_none_snapshot
  /Users/aristath/arduino-trader/app/domain/value_objects/settings.py:74: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    optimizer_blend=get_float("optimizer_blend", 0.5),
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_portfolio_value
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_cash_balance
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_value_setting
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_none_snapshot
  /Users/aristath/arduino-trader/app/domain/value_objects/settings.py:75: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    optimizer_target_return=get_float("optimizer_target_return", 0.11),
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_portfolio_value
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_includes_cash_balance
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_respects_show_value_setting
tests/unit/domain/services/test_ticker_content_service.py::TestTickerContentService::test_generate_ticker_text_handles_none_snapshot
  /Users/aristath/arduino-trader/app/domain/value_objects/settings.py:76: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    min_cash_reserve=get_float("min_cash_reserve", 500.0),
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/integration/planning/test_modular_components.py::TestPatternGeneratorRegistry::test_direct_buy_pattern
FAILED tests/integration/planning/test_modular_components.py::TestPatternGeneratorRegistry::test_single_best_pattern
FAILED tests/integration/planning/test_modular_components.py::TestSequenceGeneratorRegistry::test_partial_execution_generator
FAILED tests/integration/planning/test_modular_components.py::test_end_to_end_module_pipeline
FAILED tests/integration/planning/test_planner_config_api.py::test_create_planner_config
FAILED tests/integration/planning/test_planner_config_api.py::test_create_planner_invalid_toml
FAILED tests/integration/planning/test_planner_config_api.py::test_list_planners
FAILED tests/integration/planning/test_planner_config_api.py::test_get_planner_by_id
FAILED tests/integration/planning/test_planner_config_api.py::test_get_nonexistent_planner
FAILED tests/integration/planning/test_planner_config_api.py::test_update_planner
FAILED tests/integration/planning/test_planner_config_api.py::test_update_planner_name_only
FAILED tests/integration/planning/test_planner_config_api.py::test_update_planner_invalid_toml
FAILED tests/integration/planning/test_planner_config_api.py::test_delete_planner
FAILED tests/integration/planning/test_planner_config_api.py::test_validate_toml_valid
FAILED tests/integration/planning/test_planner_config_api.py::test_validate_toml_invalid
FAILED tests/integration/planning/test_planner_config_api.py::test_get_planner_history
FAILED tests/integration/planning/test_planner_config_api.py::test_apply_planner_without_bucket
FAILED tests/unit/api/test_optimizer.py::TestGetOptimizerStatus::test_calculates_min_trade_amount
FAILED tests/unit/api/test_settings.py::TestSettingDefaults::test_has_min_hold_days
FAILED tests/unit/api/test_settings.py::TestSettingDefaults::test_has_transaction_cost_settings
FAILED tests/unit/api/test_settings.py::TestGetSettingValue::test_returns_default_when_not_in_db
FAILED tests/unit/api/test_settings.py::TestGetAllSettingsEndpoint::test_returns_all_settings
FAILED tests/unit/api/test_settings.py::TestUpdateSettingEndpoint::test_updates_numeric_setting
FAILED tests/unit/api/test_status.py::TestGetStatus::test_returns_healthy_status_with_data
FAILED tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_no_trigger_when_cash_below_threshold
FAILED tests/unit/domain/services/test_rebalancing_triggers.py::TestCheckRebalanceTriggers::test_handles_missing_settings_repo
FAILED tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_get_settings_loads_from_repository
FAILED tests/unit/domain/services/test_settings_service.py::TestSettingsService::test_get_settings_uses_defaults_when_empty
FAILED tests/unit/domain/test_portfolio_hash.py::TestApplyPendingOrdersToPortfolio::test_apply_multiple_orders
FAILED tests/unit/infrastructure/test_cache.py::TestSimpleCache::test_set_stores_value
FAILED tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_trade_caches
FAILED tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_recommendation_caches
FAILED tests/unit/infrastructure/test_cache_invalidation.py::TestCacheInvalidationService::test_invalidate_all_trade_related
FAILED tests/unit/infrastructure/test_cache_invalidation.py::TestGetCacheInvalidationService::test_get_cache_invalidation_service_with_default_cache
FAILED tests/unit/infrastructure/test_database_adapter.py::TestDatabaseAdapter::test_execute_runs_query
FAILED tests/unit/infrastructure/test_database_queue.py::TestGetQueryQueue::test_raises_when_not_initialized
FAILED tests/unit/infrastructure/test_database_queue.py::TestInitQueryQueue::test_initializes_and_starts_queue
FAILED tests/unit/infrastructure/test_database_queue.py::TestShutdownQueryQueue::test_stops_and_clears_queue
FAILED tests/unit/infrastructure/test_database_queue.py::TestShutdownQueryQueue::test_handles_none_queue
FAILED tests/unit/infrastructure/test_database_queue.py::TestEnqueueConvenienceFunction::test_enqueue_uses_global_queue
FAILED tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_set_text_emits_event
FAILED tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_set_led3_emits_event
FAILED tests/unit/infrastructure/test_display_service.py::TestDisplayStateManagerEventEmission::test_set_led4_emits_event
FAILED tests/unit/infrastructure/test_locking.py::TestFileLock::test_prevents_concurrent_execution
FAILED tests/unit/infrastructure/test_locking.py::TestFileLock::test_handles_timeout_gracefully
FAILED tests/unit/infrastructure/test_locking.py::TestFileLock::test_timeout_error_includes_lock_name
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_runs_script_successfully
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_missing_script
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_script_failure
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_logs_script_output_on_success
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_logs_error_on_script_failure
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_exception_during_execution
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_empty_stdout_on_success
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_handles_empty_stderr_on_failure
FAILED tests/unit/jobs/test_auto_deploy.py::TestRunAutoDeploy::test_uses_correct_script_path
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_skips_when_not_connected
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_handles_empty_transactions
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_syncs_new_transactions
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_skips_existing_transactions
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_handles_exception
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestSyncCashFlowsInternal::test_uses_amount_fallback_for_eur
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestDividendRecordCreation::test_creates_dividend_record_from_dividend_cash_flow
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestDividendRecordCreation::test_links_dividend_record_to_cash_flow_id
FAILED tests/unit/jobs/test_cash_flow_sync.py::TestDividendRecordCreation::test_skips_existing_dividend_records
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncPortfolioInternal::test_skips_when_not_connected
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncPortfolioInternal::test_syncs_positions_successfully
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncPricesInternal::test_skips_when_no_stocks
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncPricesInternal::test_syncs_prices_from_yahoo
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncPricesInternal::test_handles_price_sync_error
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncStockCurrencies::test_skips_when_not_connected
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncStockCurrencies::test_skips_when_no_stocks
FAILED tests/unit/jobs/test_daily_sync.py::TestSyncStockCurrencies::test_syncs_currencies_from_tradernet
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestDividendGrouping::test_groups_multiple_dividends_by_symbol
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestDividendGrouping::test_sums_amounts_correctly_when_grouping
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestReinvestmentExecution::test_executes_trade_when_grouped_total_exceeds_min_trade_size
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestReinvestmentExecution::test_skips_trade_when_grouped_total_below_min_trade_size
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestReinvestmentExecution::test_exactly_at_min_trade_size_executes
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestDividendMarking::test_marks_all_dividend_records_reinvested_after_trade
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestPendingBonus::test_sets_pending_bonus_for_small_ungrouped_dividends
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_zero_dividends_handles_gracefully
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_api_failure_does_not_crash_job
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_invalid_price_skips_symbol_continues_others
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestErrorHandling::test_trade_execution_failure_marks_dividends_unreinvested
FAILED tests/unit/jobs/test_dividend_reinvestment.py::TestStateVerification::test_verify_no_duplicate_reinvestment
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_returns_false_when_no_negative_balances
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_triggers_rebalancing_with_negative_balance
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_triggers_rebalancing_with_currency_below_minimum
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_dismisses_stale_emergency_recommendations
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_tradernet_not_connected
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_tradernet_connection_failure
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_errors_gracefully
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_uses_file_lock_to_prevent_concurrent_execution
FAILED tests/unit/jobs/test_emergency_rebalance.py::TestCheckAndRebalanceImmediately::test_handles_no_trading_currencies
FAILED tests/unit/jobs/test_event_based_trading.py::TestWaitForPlanningCompletion::test_waits_until_all_sequences_evaluated
FAILED tests/unit/jobs/test_event_based_trading.py::TestWaitForPlanningCompletion::test_generates_sequences_if_not_exist
FAILED tests/unit/jobs/test_event_based_trading.py::TestWaitForPlanningCompletion::test_timeout_after_max_iterations
FAILED tests/unit/jobs/test_event_based_trading.py::TestGetOptimalRecommendation::test_returns_recommendation_from_best_result
FAILED tests/unit/jobs/test_event_based_trading.py::TestGetOptimalRecommendation::test_returns_none_if_no_best_result
FAILED tests/unit/jobs/test_event_based_trading.py::TestMonitorPortfolioForChanges::test_detects_hash_change_in_phase_1
FAILED tests/unit/jobs/test_event_based_trading.py::TestMonitorPortfolioForChanges::test_detects_hash_change_in_phase_2
FAILED tests/unit/jobs/test_historical_data_sync.py::TestSyncHistoricalDataInternal::test_emits_sync_events
FAILED tests/unit/jobs/test_historical_data_sync.py::TestSyncHistoricalDataInternal::test_handles_sync_error
FAILED tests/unit/jobs/test_maintenance.py::TestCreateBackupInternal::test_creates_backup_directory
FAILED tests/unit/jobs/test_maintenance.py::TestCreateBackupInternal::test_handles_backup_error
FAILED tests/unit/jobs/test_maintenance.py::TestIntegrityCheckInternal::test_passes_when_all_ok
FAILED tests/unit/jobs/test_maintenance.py::TestIntegrityCheckInternal::test_reports_failure
FAILED tests/unit/jobs/test_metrics_calculation.py::TestCalculateMetricsForAllStocks::test_processes_all_active_stocks
FAILED tests/unit/jobs/test_metrics_calculation.py::TestCalculateMetricsForAllStocks::test_counts_errors
FAILED tests/unit/jobs/test_metrics_calculation.py::TestCalculateMetricsForAllStocks::test_returns_empty_stats_for_no_stocks
FAILED tests/unit/jobs/test_planner_batch.py::TestTriggerNextBatchViaApi::test_triggers_api_endpoint
FAILED tests/unit/jobs/test_planner_batch.py::TestTriggerNextBatchViaApi::test_handles_api_failure_gracefully
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_generates_portfolio_hash_when_not_provided
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_skips_scheduled_job_when_api_batches_active
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_uses_small_batch_size_in_api_driven_mode
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_uses_large_batch_size_in_scheduled_mode
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_self_triggers_next_batch_in_api_driven_mode
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_stops_self_triggering_at_max_depth
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_emits_planner_batch_complete_event
FAILED tests/unit/jobs/test_planner_batch.py::TestProcessPlannerBatchJob::test_handles_errors_gracefully
FAILED tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_schedules_stocks_data_sync_job
FAILED tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_logs_initialization_info
FAILED tests/unit/jobs/test_scheduler.py::TestInitScheduler::test_replaces_existing_jobs
FAILED tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_reschedules_sync_cycle_with_new_interval
FAILED tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_reschedules_maintenance_jobs
FAILED tests/unit/jobs/test_scheduler.py::TestRescheduleAllJobs::test_logs_reschedule_info
FAILED tests/unit/jobs/test_scheduler.py::TestEdgeCases::test_reschedule_all_jobs_multiple_times
FAILED tests/unit/jobs/test_score_refresh.py::TestRefreshAllScores::test_uses_file_lock
FAILED tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_handles_no_active_stocks
FAILED tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_emits_events
FAILED tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_skips_stocks_with_insufficient_data
FAILED tests/unit/jobs/test_score_refresh.py::TestRefreshAllScoresInternal::test_handles_scoring_errors_gracefully
FAILED tests/unit/jobs/test_score_refresh.py::TestBuildPortfolioContext::test_builds_context_with_positions
FAILED tests/unit/jobs/test_score_refresh.py::TestBuildPortfolioContext::test_builds_context_with_allocation_targets
FAILED tests/unit/jobs/test_score_refresh.py::TestGetDailyPrices::test_returns_local_data_if_sufficient
FAILED tests/unit/jobs/test_score_refresh.py::TestGetDailyPrices::test_fetches_from_yahoo_if_insufficient
FAILED tests/unit/jobs/test_score_refresh.py::TestGetMonthlyPrices::test_returns_local_data_if_sufficient
FAILED tests/unit/jobs/test_score_refresh.py::TestGetMonthlyPrices::test_aggregates_from_yahoo_if_insufficient
FAILED tests/unit/jobs/test_securities_data_sync.py::TestStocksDataSync::test_processes_only_stale_stocks
FAILED tests/unit/jobs/test_securities_data_sync.py::TestStocksDataSync::test_processes_stocks_sequentially
FAILED tests/unit/jobs/test_securities_data_sync.py::TestStocksDataSync::test_skips_all_when_all_stocks_fresh
FAILED tests/unit/jobs/test_securities_data_sync.py::TestProcessSingleStock::test_runs_all_steps_for_stock
FAILED tests/unit/jobs/test_securities_data_sync.py::TestProcessSingleStock::test_updates_last_synced_on_success
FAILED tests/unit/jobs/test_securities_data_sync.py::TestProcessSingleStock::test_does_not_update_last_synced_on_error
FAILED tests/unit/jobs/test_securities_data_sync.py::TestDisplayUpdates::test_shows_updating_message
FAILED tests/unit/jobs/test_securities_data_sync.py::TestDisplayUpdates::test_clears_processing_after_completion
FAILED tests/unit/jobs/test_securities_data_sync.py::TestForceRefresh::test_force_refresh_bypasses_last_synced
FAILED tests/unit/jobs/test_securities_data_sync.py::TestForceRefresh::test_force_refresh_returns_error_on_failure
FAILED tests/unit/jobs/test_sync_cycle.py::TestSyncCycle::test_runs_all_steps_in_order
FAILED tests/unit/jobs/test_sync_cycle.py::TestSyncCycle::test_skips_trade_execution_when_halted
FAILED tests/unit/jobs/test_sync_cycle.py::TestStepSyncPrices::test_only_fetches_prices_for_open_markets
FAILED tests/unit/jobs/test_sync_cycle.py::TestStepSyncPrices::test_skips_all_when_no_markets_open
FAILED tests/unit/jobs/test_sync_cycle.py::TestStepGetRecommendation::test_considers_all_markets
FAILED tests/unit/jobs/test_sync_cycle.py::TestStepUpdateDisplay::test_updates_ticker_text
FAILED tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_skips_when_not_connected
FAILED tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_handles_no_trades_returned
FAILED tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_inserts_valid_trades
FAILED tests/unit/jobs/test_sync_trades.py::TestSyncTradesInternal::test_handles_errors_gracefully
FAILED tests/unit/planning/domain/config/test_models.py::test_get_enabled_generators
FAILED tests/unit/planning/domain/config/test_models.py::test_get_enabled_filters
FAILED tests/unit/planning/domain/config/test_parser.py::test_load_conservative_example
FAILED tests/unit/planning/test_planner_config_service.py::TestValidateToml::test_invalid_toml_structure
FAILED tests/unit/planning/test_planner_config_service.py::TestUpdate::test_update_name_only
FAILED tests/unit/repositories/test_position.py::TestPositionRepositoryGetWithStockInfo::test_get_with_stock_info_empty
FAILED tests/unit/repositories/test_position.py::TestPositionRepositoryGetWithStockInfo::test_get_with_stock_info_merges_data
FAILED tests/unit/repositories/test_score_repository.py::TestScoreRepository::test_init_without_db
FAILED tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_by_symbol_found
FAILED tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_all_active
FAILED tests/unit/repositories/test_security.py::TestSecurityRepositoryQueries::test_get_all
FAILED tests/unit/repositories/test_security.py::TestSecurityRepositoryGetWithScores::test_merges_stock_score_position_data
FAILED tests/unit/repositories/test_security.py::TestRowToStock::test_converts_valid_row
FAILED tests/unit/repositories/test_security.py::TestRowToStock::test_handles_null_priority_multiplier
FAILED tests/unit/repositories/test_security.py::TestRowToStock::test_row_to_stock_maps_portfolio_targets
FAILED tests/unit/repositories/test_security.py::TestRowToStock::test_row_to_stock_handles_null_portfolio_targets
FAILED tests/unit/repositories/test_security.py::TestRowToStock::test_row_to_stock_handles_missing_portfolio_target_columns
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestEdgeCases::test_target_exceeds_one
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_industry_targets_normalized_when_sum_exceeds_100
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_country_targets_normalized_when_sum_exceeds_100
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_normalization_only_applies_to_active_industries
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestTargetNormalization::test_normalization_only_applies_to_active_countries
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_single_industry_gets_70_percent_cap
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_two_industries_get_50_percent_cap_each
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_three_plus_industries_get_default_30_percent_cap
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestIndustryConcentrationCapAdjustment::test_industry_cap_adjustment_allows_higher_total_allocation
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestIndustryMinimumBoundScaling::test_industry_minimum_bounds_scaled_when_sum_exceeds_100
FAILED tests/unit/services/optimization/test_constraints_manager.py::TestIndustryMinimumBoundScaling::test_industry_minimum_bounds_not_scaled_when_combined_below_70
FAILED tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_builds_covariance_matrix_from_prices
FAILED tests/unit/services/optimization/test_risk_models.py::TestRiskModelBuilder::test_filters_valid_symbols
FAILED tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustCountryWeights::test_decreases_weight_for_negative_attribution
FAILED tests/unit/services/test_performance_adjustment_calculator.py::TestAdjustIndWeights::test_decreases_weight_for_negative_attribution
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_single_country_100_percent
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_multiple_countries_split_correctly
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_multi_industry_splits_value_equally
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_missing_country_handled
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_missing_industry_handled
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_fallback_to_price_calculation_when_no_eur_value
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_cash_balance_included
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_deviation_calculated_correctly
FAILED tests/unit/services/test_portfolio_service.py::TestPortfolioServiceCalculations::test_values_rounded_correctly
FAILED tests/unit/services/test_technical_data_calculator.py::TestGetTechnicalDataForPositions::test_each_symbol_gets_technical_data
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_buy_blocked_when_insufficient_balance
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_buy_blocked_when_negative_balance
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_buy_allowed_when_sufficient_balance
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_blocked_when_no_position
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_blocked_when_quantity_exceeds_position
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_allowed_when_quantity_within_position
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_broker_connection_failure_raises_error
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_multi_currency_validation
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_order_failure_recorded
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_no_validation_without_currency_balances
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_sell_blocked_when_recent_order_in_database
FAILED tests/unit/services/test_trade_execution.py::TestTradeValidation::test_order_stored_immediately_after_placement
FAILED tests/unit/services/test_trade_safety_service.py::test_validate_trade_sell_blocks_recent_buy
ERROR tests/integration/planning/test_modular_components.py::TestOpportunityCalculatorRegistry::test_opportunity_buys_calculator
ERROR tests/integration/planning/test_modular_components.py::TestOpportunityCalculatorRegistry::test_profit_taking_calculator
ERROR tests/integration/planning/test_modular_planner_parity.py::test_modular_planner_basic_execution
ERROR tests/integration/planning/test_modular_planner_parity.py::test_modular_adapter_execution
ERROR tests/integration/planning/test_modular_planner_parity.py::test_modular_planner_empty_portfolio
ERROR tests/integration/planning/test_modular_planner_parity.py::test_modular_planner_no_cash
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_security_without_position
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_security_when_buy_not_allowed
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_that_is_up
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_down_too_much
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_low_quality_security
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_creates_opportunity_for_quality_dip
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_priority_based_on_quality_and_drop
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_respects_priority_weight_param
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_respects_security_priority_multiplier
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_uses_default_quality_when_scores_not_provided
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_with_zero_current_price
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_skips_position_with_zero_avg_price
ERROR tests/unit/planning/domain/calculations/opportunities/test_averaging_down.py::TestAveragingDownCalculator::test_calculate_respects_base_trade_amount_param
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_when_sell_not_allowed
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_with_zero_value
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_creates_opportunity_for_windfall_position
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_skips_position_without_windfall
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_respects_priority_weight_param
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_respects_security_priority_multiplier
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_handles_eur_currency_without_exchange_service
ERROR tests/unit/planning/domain/calculations/opportunities/test_profit_taking.py::TestProfitTakingCalculator::test_calculate_handles_missing_current_price
ERROR tests/unit/satellites/test_satellite_planner_integration.py::test_uses_custom_planner_when_config_exists
ERROR tests/unit/satellites/test_satellite_planner_integration.py::test_fallback_when_no_custom_config
ERROR tests/unit/satellites/test_satellite_planner_integration.py::test_fallback_when_factory_has_no_config
ERROR tests/unit/satellites/test_satellite_planner_integration.py::test_custom_config_receives_correct_parameters
= 212 failed, 2528 passed, 7 skipped, 25 warnings, 31 errors in 93.54s (0:01:33) =
